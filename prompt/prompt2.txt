- BaiVietCuaToiController.java:
package Controller.BaiVietCuaToi;

import java.io.IOException;
import java.util.ArrayList;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import Modal.BaiViet.BaiViet;
import Modal.BaiViet.BaiVietBO;
import Modal.TheLoai.TheLoai;
import Modal.TheLoai.TheLoaiBO;
import Modal.BinhLuan.BinhLuan;
import Modal.BinhLuan.BinhLuanBO;

@WebServlet("/BaiVietCuaToiController")
public class BaiVietCuaToiController extends HttpServlet {
	private static final long serialVersionUID = 1L;
	private BaiVietBO bvbo = new BaiVietBO();
	private TheLoaiBO tlbo = new TheLoaiBO();
	private BinhLuanBO blbo = new BinhLuanBO();
       
	public BaiVietCuaToiController() {
		super();
	}

	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// Set UTF-8 encoding
		request.setCharacterEncoding("UTF-8");
		response.setCharacterEncoding("UTF-8");
		response.setContentType("text/html; charset=UTF-8");
		
		HttpSession session = request.getSession();
		
		// Kiểm tra đăng nhập
		String account = (String) session.getAttribute("account");
		if(account == null || account.trim().isEmpty()) {
			response.sendRedirect(request.getContextPath() + "/DangNhapController");
			return;
		}
		
		try {
			// Lấy danh sách thể loại cho dropdown và filter
			ArrayList<TheLoai> dsTheLoai = tlbo.readDB2();
			request.setAttribute("dsTheLoai", dsTheLoai);
			
			// Lấy danh sách bài viết của tài khoản hiện tại
			ArrayList<BaiViet> dsBaiViet = bvbo.filterDB_taiKhoanTao(account);
			
			// Lấy tham số từ URL
			String maTheLoaiParam = request.getParameter("theloai");
			String sortParam = request.getParameter("sort");
			String searchParam = request.getParameter("search");
			
			// Lọc theo thể loại (nếu có)
			if(maTheLoaiParam != null && !maTheLoaiParam.trim().isEmpty()) {
				int maTheLoai = Integer.parseInt(maTheLoaiParam);
				ArrayList<BaiViet> dsBaiVietTheLoai = new ArrayList<>();
				for(BaiViet bv : dsBaiViet) {
					if(bv.getMaTheLoai() == maTheLoai) {
						dsBaiVietTheLoai.add(bv);
					}
				}
				dsBaiViet = dsBaiVietTheLoai;
				request.setAttribute("selectedTheLoai", maTheLoai);
			}
			
			// Tìm kiếm (nếu có)
			if(searchParam != null && !searchParam.trim().isEmpty()) {
				dsBaiViet = bvbo.findDB_user(dsBaiViet, searchParam.trim());
				request.setAttribute("searchKey", searchParam);
			}
			
			// Sắp xếp (nếu có)
			if(sortParam != null && !sortParam.trim().isEmpty()) {
				switch(sortParam) {
					case "danhGiaCao":
						dsBaiViet = bvbo.sortDB_danhGia_cao(dsBaiViet);
						break;
					case "danhGiaThap":
						dsBaiViet = bvbo.sortDB_danhGia_thap(dsBaiViet);
						break;
					case "taoGanNhat":
						dsBaiViet = bvbo.sortDB_thoiDiemTao_ganNhat(dsBaiViet);
						break;
					case "taoXaNhat":
						dsBaiViet = bvbo.sortDB_thoiDiemTao_xaNhat(dsBaiViet);
						break;
					case "capNhatGanNhat":
						dsBaiViet = bvbo.sortDB_thoiDiemCapNhat_ganNhat(dsBaiViet);
						break;
					case "capNhatXaNhat":
						dsBaiViet = bvbo.sortDB_thoiDiemCapNhat_xaNhat(dsBaiViet);
						break;
				}
				request.setAttribute("sortBy", sortParam);
			}
			
			// === PHÂN TRANG ===
			int itemsPerPage = 4;
			int currentPage = 1;
			
			String pageParam = request.getParameter("page");
			if(pageParam != null && !pageParam.trim().isEmpty()) {
				try {
					currentPage = Integer.parseInt(pageParam);
					if(currentPage < 1) currentPage = 1;
				} catch(NumberFormatException e) {
					currentPage = 1;
				}
			}
			
			int totalItems = dsBaiViet.size();
			int totalPages = (int) Math.ceil((double) totalItems / itemsPerPage);
			
			if(currentPage > totalPages && totalPages > 0) {
				currentPage = totalPages;
			}
			
			int startIndex = (currentPage - 1) * itemsPerPage;
			int endIndex = Math.min(startIndex + itemsPerPage, totalItems);
			
			ArrayList<BaiViet> dsBaiVietPhanTrang = new ArrayList<>();
			if(totalItems > 0) {
				dsBaiVietPhanTrang = new ArrayList<>(dsBaiViet.subList(startIndex, endIndex));
			}
			
			request.setAttribute("dsBaiViet", dsBaiVietPhanTrang);
			request.setAttribute("currentPage", currentPage);
			request.setAttribute("totalPages", totalPages);
			request.setAttribute("totalItems", totalItems);
			request.setAttribute("startIndex", startIndex);
			
			// Lấy danh sách bình luận cho mỗi bài viết
			for(BaiViet bv : dsBaiVietPhanTrang) {
				ArrayList<BinhLuan> binhLuanCuaBaiViet = blbo.filterDB_maBaiViet(bv.getMaBaiViet(), bv.getTrangThai());
				request.setAttribute("dsBinhLuan_" + bv.getMaBaiViet(), binhLuanCuaBaiViet);
			}
			
			// Lấy thông báo từ session (nếu có)
			String message = (String) session.getAttribute("message");
			String messageType = (String) session.getAttribute("messageType");
			
			if(message != null) {
				request.setAttribute("message", message);
				request.setAttribute("messageType", messageType);
				session.removeAttribute("message");
				session.removeAttribute("messageType");
			}
			
			// Forward đến trang MyPostPage
			request.getRequestDispatcher("/pages/mypost_page/MyPostPage.jsp").forward(request, response);
			
		} catch(Exception e) {
			e.printStackTrace();
			request.setAttribute("error", "Đã xảy ra lỗi khi tải dữ liệu. Vui lòng thử lại!");
			request.getRequestDispatcher("/pages/mypost_page/MyPostPage.jsp").forward(request, response);
		}
	}

	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		doGet(request, response);
	}
}
- XuLyBaiVietCuaToiController.java:
package Controller.BaiVietCuaToi;

import java.io.IOException;
import java.math.BigDecimal;

import javax.servlet.ServletException;
import javax.servlet.annotation.MultipartConfig;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import Modal.BaiViet.BaiViet;
import Modal.BaiViet.BaiVietBO;
import Modal.BaiViet.BaiVietDAO;

@WebServlet("/XuLyBaiVietCuaToiController")
@MultipartConfig
public class XuLyBaiVietCuaToiController extends HttpServlet {
	private static final long serialVersionUID = 1L;
	private BaiVietBO bvbo = new BaiVietBO();
	private BaiVietDAO bvdao = new BaiVietDAO();
       
	public XuLyBaiVietCuaToiController() {
		super();
	}

	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// Set UTF-8 encoding
		request.setCharacterEncoding("UTF-8");
		response.setCharacterEncoding("UTF-8");
		response.setContentType("text/html; charset=UTF-8");
		
		HttpSession session = request.getSession();
		
		// Kiểm tra đăng nhập
		String account = (String) session.getAttribute("account");
		if(account == null || account.trim().isEmpty()) {
			response.sendRedirect(request.getContextPath() + "/DangNhapController");
			return;
		}
		
		// Lấy tham số action
		String action = request.getParameter("action");
		
		try {
			if("create".equals(action)) {
				// Thêm bài viết
				String tieuDe = request.getParameter("tieuDe");
				String noiDung = request.getParameter("noiDung");
				String url = request.getParameter("url");
				String taiKhoanTao = account;
				String maTheLoaiStr = request.getParameter("maTheLoai");
				
				// Validate
				if(tieuDe == null || tieuDe.trim().isEmpty()) {
					session.setAttribute("message", "Tiêu đề không được để trống!");
					session.setAttribute("messageType", "error");
				} else if(tieuDe.trim().length() > 255) {
					session.setAttribute("message", "Tiêu đề không được quá 255 ký tự!");
					session.setAttribute("messageType", "error");
				} else if(noiDung == null || noiDung.trim().isEmpty()) {
					session.setAttribute("message", "Nội dung không được để trống!");
					session.setAttribute("messageType", "error");
				} else if(maTheLoaiStr == null || maTheLoaiStr.trim().isEmpty()) {
					session.setAttribute("message", "Thể loại không được để trống!");
					session.setAttribute("messageType", "error");
				} else {
					int maTheLoai = Integer.parseInt(maTheLoaiStr);
					bvbo.createDB(tieuDe.trim(), noiDung.trim(), url, taiKhoanTao, maTheLoai);
					session.setAttribute("message", "Thêm bài viết thành công!");
					session.setAttribute("messageType", "success");
				}
				
			} else if("update".equals(action)) {
				// Sửa bài viết
				long maBaiViet = Long.parseLong(request.getParameter("maBaiViet"));
				
				// Kiểm tra quyền sở hữu bài viết
				BaiViet bvCheck = bvdao.findByMaBaiViet(maBaiViet);
				if(bvCheck == null || !bvCheck.getTaiKhoanTao().equals(account)) {
					session.setAttribute("message", "Bạn không có quyền chỉnh sửa bài viết này!");
					session.setAttribute("messageType", "error");
					response.sendRedirect(request.getContextPath() + "/BaiVietCuaToiController");
					return;
				}
				
				String tieuDe = request.getParameter("tieuDe");
				String noiDung = request.getParameter("noiDung");
				String url = request.getParameter("url");
				int maTheLoai = Integer.parseInt(request.getParameter("maTheLoai"));
				String danhGiaStr = request.getParameter("danhGia");
				String trangThai = bvCheck.getTrangThai(); // Giữ nguyên trạng thái
				
				BigDecimal danhGia = bvCheck.getDanhGia(); // Giữ nguyên đánh giá
				if(danhGiaStr != null && !danhGiaStr.trim().isEmpty()) {
					danhGia = new BigDecimal(danhGiaStr);
					if(danhGia.compareTo(BigDecimal.ZERO) < 0 || danhGia.compareTo(new BigDecimal("5")) > 0) {
						session.setAttribute("message", "Đánh giá phải từ 0 đến 5!");
						session.setAttribute("messageType", "error");
						response.sendRedirect(request.getContextPath() + "/BaiVietCuaToiController");
						return;
					}
				}
				
				// Validate
				if(tieuDe == null || tieuDe.trim().isEmpty()) {
					session.setAttribute("message", "Tiêu đề không được để trống!");
					session.setAttribute("messageType", "error");
				} else if(tieuDe.trim().length() > 255) {
					session.setAttribute("message", "Tiêu đề không được quá 255 ký tự!");
					session.setAttribute("messageType", "error");
				} else if(noiDung == null || noiDung.trim().isEmpty()) {
					session.setAttribute("message", "Nội dung không được để trống!");
					session.setAttribute("messageType", "error");
				} else {
					bvbo.updateDB(maBaiViet, tieuDe.trim(), noiDung.trim(), url, maTheLoai, danhGia, trangThai);
					session.setAttribute("message", "Cập nhật bài viết thành công!");
					session.setAttribute("messageType", "success");
				}
				
			} else if("delete".equals(action)) {
				// Xóa bài viết
				long maBaiViet = Long.parseLong(request.getParameter("maBaiViet"));
				
				// Kiểm tra quyền sở hữu bài viết
				BaiViet bvCheck = bvdao.findByMaBaiViet(maBaiViet);
				if(bvCheck == null || !bvCheck.getTaiKhoanTao().equals(account)) {
					session.setAttribute("message", "Bạn không có quyền xóa bài viết này!");
					session.setAttribute("messageType", "error");
					response.sendRedirect(request.getContextPath() + "/BaiVietCuaToiController");
					return;
				}
				
				bvbo.deleteDB(maBaiViet);
				session.setAttribute("message", "Xóa bài viết thành công!");
				session.setAttribute("messageType", "success");
			}
			
		} catch(Exception e) {
			e.printStackTrace();
			session.setAttribute("message", e.getMessage());
			session.setAttribute("messageType", "error");
		}
		
		// Redirect về trang bài viết của tôi
		response.sendRedirect(request.getContextPath() + "/BaiVietCuaToiController");
	}

	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		doGet(request, response);
	}
}
- BinhLuanController.java:
package Controller.BinhLuan;

import java.io.IOException;
import java.util.ArrayList;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import Modal.BaiViet.BaiViet;
import Modal.BaiViet.BaiVietBO;
import Modal.BinhLuan.BinhLuan;
import Modal.BinhLuan.BinhLuanBO;
import Modal.TheLoai.TheLoaiBO;

/**
 * Servlet implementation class BinhLuanController
 */
@WebServlet("/BinhLuanController")
public class BinhLuanController extends HttpServlet {
	private static final long serialVersionUID = 1L;
	private BaiVietBO bvbo = new BaiVietBO();
	private TheLoaiBO tlbo = new TheLoaiBO();
	private BinhLuanBO blbo = new BinhLuanBO();
       
    /**
     * @see HttpServlet#HttpServlet()
     */
    public BinhLuanController() {
        super();
        // TODO Auto-generated constructor stub
    }

	/**
	 * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// Set UTF-8 encoding
		request.setCharacterEncoding("UTF-8");
		response.setCharacterEncoding("UTF-8");
		response.setContentType("text/html; charset=UTF-8");
		
		HttpSession session = request.getSession();
		
		// Kiểm tra đăng nhập
		String account = (String) session.getAttribute("account");
		String quyen = (String) session.getAttribute("quyen");
		
		if(account == null || account.trim().isEmpty()) {
			response.sendRedirect(request.getContextPath() + "/DangNhapController");
			return;
		}
		
		// Kiểm tra quyền Admin
		if(!"Admin".equals(quyen)) {
			response.sendRedirect(request.getContextPath() + "/TrangChuController");
			return;
		}
		
		try {
			// Tham số tìm kiếm
			String searchKey = request.getParameter("search");
			
			ArrayList<BinhLuan> dsBinhLuan;
			
			// Nếu có từ khóa tìm kiếm
			if(searchKey != null && !searchKey.trim().isEmpty()) {
				dsBinhLuan = blbo.findDB_admin(searchKey);
				request.setAttribute("searchKey", searchKey);
			} else {
				// Lấy toàn bộ danh sách
				dsBinhLuan = blbo.readDB();
			}
			
			//Sắp xếp theo mã bình luận tăng dần
			dsBinhLuan.sort((a, b) -> Long.compare(a.getMaBinhLuan(), b.getMaBinhLuan()));
			
			// Lấy danh sách bài viết cho dropdown
			ArrayList<BaiViet> dsBaiViet = bvbo.readDB();
			request.setAttribute("dsBaiViet", dsBaiViet);
			
			// === PHÂN TRANG ===
			int itemsPerPage = 8; // 8 bình luận mỗi trang
			int currentPage = 1;
			
			// Lấy số trang từ URL
			String pageParam = request.getParameter("page");
			if(pageParam != null && !pageParam.trim().isEmpty()) {
				try {
					currentPage = Integer.parseInt(pageParam);
					if(currentPage < 1) currentPage = 1;
				} catch(NumberFormatException e) {
					currentPage = 1;
				}
			}
			
			// Tính tổng số trang
			int totalItems = dsBinhLuan.size();
			int totalPages = (int) Math.ceil((double) totalItems / itemsPerPage);
			
			// Đảm bảo currentPage không vượt quá totalPages
			if(currentPage > totalPages && totalPages > 0) {
				currentPage = totalPages;
			}
			
			// Lấy danh sách cho trang hiện tại
			int startIndex = (currentPage - 1) * itemsPerPage;
			int endIndex = Math.min(startIndex + itemsPerPage, totalItems);
			
			ArrayList<BinhLuan> dsBinhLuanPhanTrang = new ArrayList<>();
			if(totalItems > 0) {
				dsBinhLuanPhanTrang = new ArrayList<>(dsBinhLuan.subList(startIndex, endIndex));
			}
			
			// Truyền dữ liệu phân trang
			request.setAttribute("dsBinhLuan", dsBinhLuanPhanTrang);
			request.setAttribute("currentPage", currentPage);
			request.setAttribute("totalPages", totalPages);
			request.setAttribute("totalItems", totalItems);
			request.setAttribute("startIndex", startIndex);
			
			// Lấy thông báo từ session (nếu có)
			String message = (String) session.getAttribute("message");
			String messageType = (String) session.getAttribute("messageType");
			
			if(message != null) {
				request.setAttribute("message", message);
				request.setAttribute("messageType", messageType);
				// Xóa thông báo khỏi session
				session.removeAttribute("message");
				session.removeAttribute("messageType");
			}
			
			// Forward đến CommentPage
			request.getRequestDispatcher("/pages/comment_page/CommentPage.jsp").forward(request, response);
		}
		catch(Exception e) {
			e.printStackTrace();
			request.setAttribute("error", "Đã xảy ra lỗi khi tải dữ liệu. Vui lòng thử lại!");
			request.getRequestDispatcher("/pages/comment_page/CommentPage.jsp").forward(request, response);
		}
	}

	/**
	 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		doGet(request, response);
	}

}
- XuLyBinhLuanController.java:
package Controller.BinhLuan;

import java.io.IOException;
import java.math.BigDecimal;

import javax.servlet.ServletException;
import javax.servlet.annotation.MultipartConfig;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import Modal.BinhLuan.BinhLuanBO;

/**
 * Servlet implementation class XuLyBinhLuanController
 */
@WebServlet("/XuLyBinhLuanController")
@MultipartConfig
public class XuLyBinhLuanController extends HttpServlet {
	private static final long serialVersionUID = 1L;
    private BinhLuanBO blbo = new BinhLuanBO();  
	
    /**
     * @see HttpServlet#HttpServlet()
     */
    public XuLyBinhLuanController() {
        super();
        // TODO Auto-generated constructor stub
    }

	/**
	 * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// Set UTF-8 encoding
		request.setCharacterEncoding("UTF-8");
		response.setCharacterEncoding("UTF-8");
		response.setContentType("text/html; charset=UTF-8");
		
		HttpSession session = request.getSession();
		
		// Kiểm tra đăng nhập và quyền Admin
		String account = (String) session.getAttribute("account");
		String quyen = (String) session.getAttribute("quyen");
		
		if(account == null || account.trim().isEmpty()) {
			response.sendRedirect(request.getContextPath() + "/DangNhapController");
			return;
		}
		
		if(!"Admin".equals(quyen)) {
			response.sendRedirect(request.getContextPath() + "/TrangChuController");
			return;
		}
		
		// Lấy tham số action
		String action = request.getParameter("action");
		
		try {
			if("create".equals(action)) {
				// Thêm 
				String noiDung = request.getParameter("noiDung");
				String url = request.getParameter("url");
				String taiKhoanTao = account; // Lấy từ session
				String maBaiVietStr = request.getParameter("maBaiViet");
				
				// Validate
				if(noiDung == null || noiDung.trim().isEmpty()) {
					session.setAttribute("message", "Nội dung không được để trống!");
					session.setAttribute("messageType", "error");
				} else if(maBaiVietStr == null || maBaiVietStr.trim().isEmpty()) {
					session.setAttribute("message", "Bài viết chứa bình luận không được để trống!");
					session.setAttribute("messageType", "error");
				} else {
					long maBaiViet = Long.parseLong(maBaiVietStr);
					blbo.createDB(noiDung.trim(), url, taiKhoanTao, maBaiViet);
					session.setAttribute("message", "Thêm bình luận thành công!");
					session.setAttribute("messageType", "success");
				}
				
			} else if("update".equals(action)) {
				// Sửa bình luận
				long maBinhLuan = Long.parseLong(request.getParameter("maBinhLuan"));
				String noiDung = request.getParameter("noiDung");
				String url = request.getParameter("url");
				String soLuotThichStr = request.getParameter("soLuotThich");
				String trangThai = request.getParameter("trangThai");
				
				int soLuotThich = -1;
				if(soLuotThichStr != null && !soLuotThichStr.trim().isEmpty()) {
					soLuotThich = Integer.parseInt(soLuotThichStr);
					if(soLuotThich < 0) {
						session.setAttribute("message", "Số lượt thích phải lớn hơn hoặc bằng 0");
						session.setAttribute("messageType", "error");
						response.sendRedirect(request.getContextPath() + "/BinhLuanController");
						return;
					}
				}
				
				// Validate
				if(noiDung == null || noiDung.trim().isEmpty()) {
					session.setAttribute("message", "Nội dung không được để trống!");
					session.setAttribute("messageType", "error");
				} else if(trangThai == null || trangThai.trim().isEmpty()) {
					session.setAttribute("message", "Trạng thái không được để trống!");
					session.setAttribute("messageType", "error");
				} else {
					blbo.updateDB(maBinhLuan, noiDung.trim(), url, soLuotThich, trangThai);
					session.setAttribute("message", "Cập nhật bình luận thành công!");
					session.setAttribute("messageType", "success");
				}
				
			} else if("delete".equals(action)) {
				// Xóa bình luận
				long maBinhLuan = Long.parseLong(request.getParameter("maBinhLuan"));
				blbo.deleteDB(maBinhLuan);
				session.setAttribute("message", "Xóa bình luận thành công!");
				session.setAttribute("messageType", "success");
			}
			
		} catch (Exception e) {
			e.printStackTrace();
			session.setAttribute("message", e.getMessage());
			session.setAttribute("messageType", "error");
		}
		
		// Redirect về trang bài viết
		response.sendRedirect(request.getContextPath() + "/BinhLuanController");
	}

	/**
	 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		doGet(request, response);
	}

}
- BinhLuanCuaToiController.java:
package Controller.BinhLuanCuaToi;

import java.io.IOException;
import java.util.ArrayList;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import Modal.BaiViet.BaiViet;
import Modal.BaiViet.BaiVietBO;
import Modal.BinhLuan.BinhLuan;
import Modal.BinhLuan.BinhLuanBO;
import Modal.LuotThichBinhLuan.LuotThichBinhLuan;
import Modal.LuotThichBinhLuan.LuotThichBinhLuanBO;

@WebServlet("/BinhLuanCuaToiController")
public class BinhLuanCuaToiController extends HttpServlet {
	private static final long serialVersionUID = 1L;
	private BinhLuanBO blbo = new BinhLuanBO();
	private BaiVietBO bvbo = new BaiVietBO();
	private LuotThichBinhLuanBO ltbo = new LuotThichBinhLuanBO();
       
	public BinhLuanCuaToiController() {
		super();
	}

	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// Set UTF-8 encoding
		request.setCharacterEncoding("UTF-8");
		response.setCharacterEncoding("UTF-8");
		response.setContentType("text/html; charset=UTF-8");
		
		HttpSession session = request.getSession();
		
		// Kiểm tra đăng nhập
		String account = (String) session.getAttribute("account");
		if(account == null || account.trim().isEmpty()) {
			response.sendRedirect(request.getContextPath() + "/DangNhapController");
			return;
		}
		
		try {
			// Lấy danh sách bài viết cho dropdown filter
			ArrayList<BaiViet> dsBaiVietAll = bvbo.readDB();
			request.setAttribute("dsBaiViet", dsBaiVietAll);
			
			// Lấy danh sách bình luận của tài khoản hiện tại
			ArrayList<BinhLuan> dsBinhLuan = blbo.filterDB_taiKhoanTao(account);
			
			// Lấy tham số từ URL
			String maBaiVietParam = request.getParameter("baiviet");
			String sortParam = request.getParameter("sort");
			String searchParam = request.getParameter("search");
			
			// Lọc theo bài viết (nếu có)
			if(maBaiVietParam != null && !maBaiVietParam.trim().isEmpty()) {
				long maBaiViet = Long.parseLong(maBaiVietParam);
				ArrayList<BinhLuan> dsBinhLuanBaiViet = new ArrayList<>();
				for(BinhLuan bl : dsBinhLuan) {
					if(bl.getMaBaiViet() == maBaiViet) {
						dsBinhLuanBaiViet.add(bl);
					}
				}
				dsBinhLuan = dsBinhLuanBaiViet;
				request.setAttribute("selectedBaiViet", maBaiViet);
			}
			
			// Tìm kiếm (nếu có)
			if(searchParam != null && !searchParam.trim().isEmpty()) {
				dsBinhLuan = blbo.findDB_user(dsBinhLuan, searchParam.trim());
				request.setAttribute("searchKey", searchParam);
			}
			
			// Sắp xếp (nếu có)
			if(sortParam != null && !sortParam.trim().isEmpty()) {
				switch(sortParam) {
					case "luotThichCao":
						dsBinhLuan = blbo.sortDB_soLuotThich_cao(dsBinhLuan);
						break;
					case "luotThichThap":
						dsBinhLuan = blbo.sortDB_soLuotThich_thap(dsBinhLuan);
						break;
					case "taoGanNhat":
						dsBinhLuan = blbo.sortDB_thoiDiemTao_ganNhat(dsBinhLuan);
						break;
					case "taoXaNhat":
						dsBinhLuan = blbo.sortDB_thoiDiemTao_xaNhat(dsBinhLuan);
						break;
					case "capNhatGanNhat":
						dsBinhLuan = blbo.sortDB_thoiDiemCapNhat_ganNhat(dsBinhLuan);
						break;
					case "capNhatXaNhat":
						dsBinhLuan = blbo.sortDB_thoiDiemCapNhat_xaNhat(dsBinhLuan);
						break;
				}
				request.setAttribute("sortBy", sortParam);
			}
			
			// === PHÂN TRANG ===
			int itemsPerPage = 8;
			int currentPage = 1;
			
			String pageParam = request.getParameter("page");
			if(pageParam != null && !pageParam.trim().isEmpty()) {
				try {
					currentPage = Integer.parseInt(pageParam);
					if(currentPage < 1) currentPage = 1;
				} catch(NumberFormatException e) {
					currentPage = 1;
				}
			}
			
			int totalItems = dsBinhLuan.size();
			int totalPages = (int) Math.ceil((double) totalItems / itemsPerPage);
			
			if(currentPage > totalPages && totalPages > 0) {
				currentPage = totalPages;
			}
			
			int startIndex = (currentPage - 1) * itemsPerPage;
			int endIndex = Math.min(startIndex + itemsPerPage, totalItems);
			
			ArrayList<BinhLuan> dsBinhLuanPhanTrang = new ArrayList<>();
			if(totalItems > 0) {
				dsBinhLuanPhanTrang = new ArrayList<>(dsBinhLuan.subList(startIndex, endIndex));
			}
			
			request.setAttribute("dsBinhLuan", dsBinhLuanPhanTrang);
			request.setAttribute("currentPage", currentPage);
			request.setAttribute("totalPages", totalPages);
			request.setAttribute("totalItems", totalItems);
			request.setAttribute("startIndex", startIndex);
			
			// Lấy danh sách lượt thích
			ArrayList<LuotThichBinhLuan> dsLuotThich = ltbo.readDB();
			request.setAttribute("dsLuotThich", dsLuotThich);
			
			// Lấy thông báo từ session (nếu có)
			String message = (String) session.getAttribute("message");
			String messageType = (String) session.getAttribute("messageType");
			
			if(message != null) {
				request.setAttribute("message", message);
				request.setAttribute("messageType", messageType);
				session.removeAttribute("message");
				session.removeAttribute("messageType");
			}
			
			// Forward đến trang MyCommentPage
			request.getRequestDispatcher("/pages/mycomment_page/MyCommentPage.jsp").forward(request, response);
			
		} catch(Exception e) {
			e.printStackTrace();
			request.setAttribute("error", "Đã xảy ra lỗi khi tải dữ liệu. Vui lòng thử lại!");
			request.getRequestDispatcher("/pages/mycomment_page/MyCommentPage.jsp").forward(request, response);
		}
	}

	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		doGet(request, response);
	}
}
- XuLyBinhLuanCuaToiController.java:
package Controller.BinhLuanCuaToi;

import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.ServletException;
import javax.servlet.annotation.MultipartConfig;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.json.JSONArray;
import org.json.JSONObject;

import Modal.BinhLuan.BinhLuan;
import Modal.BinhLuan.BinhLuanBO;
import Modal.BinhLuan.BinhLuanDAO;
import Modal.LuotThichBinhLuan.LuotThichBinhLuan;
import Modal.LuotThichBinhLuan.LuotThichBinhLuanBO;

import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.TimeZone;

@WebServlet("/XuLyBinhLuanCuaToiController")
@MultipartConfig
public class XuLyBinhLuanCuaToiController extends HttpServlet {
	private static final long serialVersionUID = 1L;
	private BinhLuanBO blbo = new BinhLuanBO();
	private BinhLuanDAO bldao = new BinhLuanDAO();
	private LuotThichBinhLuanBO ltbo = new LuotThichBinhLuanBO();
       
	public XuLyBinhLuanCuaToiController() {
		super();
	}

	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// Set UTF-8 encoding
		request.setCharacterEncoding("UTF-8");
		response.setCharacterEncoding("UTF-8");
		response.setContentType("text/html; charset=UTF-8");
		
		HttpSession session = request.getSession();
		
		// Kiểm tra đăng nhập
		String account = (String) session.getAttribute("account");
		if(account == null || account.trim().isEmpty()) {
			response.sendRedirect(request.getContextPath() + "/DangNhapController");
			return;
		}
		
		// Lấy tham số action
		String action = request.getParameter("action");
		
		try {
			if("create".equals(action)) {
			    // Thêm bình luận
			    String noiDung = request.getParameter("noiDung");
			    String url = request.getParameter("url"); // URL từ hidden field sau khi upload
			    String taiKhoanTao = account;
			    String maBaiVietStr = request.getParameter("maBaiViet");
			    
			    // Validate
			    if(noiDung == null || noiDung.trim().isEmpty()) {
			        session.setAttribute("message", "Nội dung không được để trống!");
			        session.setAttribute("messageType", "error");
			    } else if(maBaiVietStr == null || maBaiVietStr.trim().isEmpty()) {
			        session.setAttribute("message", "Mã bài viết không được để trống!");
			        session.setAttribute("messageType", "error");
			    } else {
			        long maBaiViet = Long.parseLong(maBaiVietStr);
			        
			        // URL có thể null hoặc empty
			        String finalUrl = (url != null && !url.trim().isEmpty()) ? url.trim() : null;
			        
			        blbo.createDB(noiDung.trim(), finalUrl, taiKhoanTao, maBaiViet);
			        session.setAttribute("message", "Thêm bình luận thành công!");
			        session.setAttribute("messageType", "success");
			    }
			    
			} else if("update".equals(action)) {
			    // Sửa bình luận
			    long maBinhLuan = Long.parseLong(request.getParameter("maBinhLuan"));
			    
			    // Kiểm tra quyền sở hữu bình luận
			    BinhLuan blCheck = bldao.findByMaBinhLuan(maBinhLuan);
			    if(blCheck == null || !blCheck.getTaiKhoanTao().equals(account)) {
			        session.setAttribute("message", "Bạn không có quyền chỉnh sửa bình luận này!");
			        session.setAttribute("messageType", "error");
			        response.sendRedirect(request.getContextPath() + "/BinhLuanCuaToiController");
			        return;
			    }
			    
			    String noiDung = request.getParameter("noiDung");
			    String url = request.getParameter("url");
			    String keepOldFile = request.getParameter("keepOldFile");
			    int soLuotThich = blCheck.getSoLuotThich(); // Giữ nguyên số lượt thích
			    String trangThai = blCheck.getTrangThai(); // Giữ nguyên trạng thái
			    
			    // Validate
			    if(noiDung == null || noiDung.trim().isEmpty()) {
			        session.setAttribute("message", "Nội dung không được để trống!");
			        session.setAttribute("messageType", "error");
			    } else {
			        // Xử lý URL
			        String finalUrl = null;
			        if(url != null && !url.trim().isEmpty()) {
			            finalUrl = url.trim();
			        } else if("true".equals(keepOldFile)) {
			            // Giữ file cũ - lấy URL cũ từ DB
			            finalUrl = blCheck.getUrl();
			        }
			        
			        blbo.updateDB(maBinhLuan, noiDung.trim(), finalUrl, soLuotThich, trangThai);
			        session.setAttribute("message", "Cập nhật bình luận thành công!");
			        session.setAttribute("messageType", "success");
			    }
			} else if("delete".equals(action)) {
				// Xóa bình luận
				long maBinhLuan = Long.parseLong(request.getParameter("maBinhLuan"));
				
				// Kiểm tra quyền sở hữu bình luận
				BinhLuan blCheck = bldao.findByMaBinhLuan(maBinhLuan);
				if(blCheck == null || !blCheck.getTaiKhoanTao().equals(account)) {
					session.setAttribute("message", "Bạn không có quyền xóa bình luận này!");
					session.setAttribute("messageType", "error");
					response.sendRedirect(request.getContextPath() + "/BinhLuanCuaToiController");
					return;
				}
				
				blbo.deleteDB(maBinhLuan);
				session.setAttribute("message", "Xóa bình luận thành công!");
				session.setAttribute("messageType", "success");
				
			} else if("like".equals(action) || "unlike".equals(action)) {
				// Xử lý like/unlike
				response.setContentType("application/json; charset=UTF-8");
				PrintWriter out = response.getWriter();
				JSONObject json = new JSONObject();
				
				try {
					long maBinhLuan = Long.parseLong(request.getParameter("maBinhLuan"));
					
					if("like".equals(action)) {
						ltbo.createDB(maBinhLuan, account);
						json.put("success", true);
						json.put("message", "Đã thích!");
					} else {
						ltbo.deleteDBByMaBinhLuanVaTenDangNhap(maBinhLuan, account);
						json.put("success", true);
						json.put("message", "Đã bỏ thích!");
					}
				} catch(Exception e) {
					e.printStackTrace();
					json.put("success", false);
					json.put("message", e.getMessage());
				}
				
				out.print(json.toString());
				return;
				
			} else if("getLikeList".equals(action)) {
				// Lấy danh sách lượt thích
				response.setContentType("application/json; charset=UTF-8");
				PrintWriter out = response.getWriter();
				JSONObject json = new JSONObject();
				
				try {
					long maBinhLuan = Long.parseLong(request.getParameter("maBinhLuan"));
					
					ArrayList<LuotThichBinhLuan> dsAll = ltbo.readDB();
					ArrayList<LuotThichBinhLuan> dsFiltered = new ArrayList<>();
					for(LuotThichBinhLuan lt : dsAll) {
						if(lt.getMaBinhLuan() == maBinhLuan) {
							dsFiltered.add(lt);
						}
					}
					
					JSONArray arr = new JSONArray();
					SimpleDateFormat sdf = new SimpleDateFormat("dd/MM/yyyy HH:mm:ss");
					sdf.setTimeZone(TimeZone.getTimeZone("Asia/Ho_Chi_Minh"));
					
					for(LuotThichBinhLuan lt : dsFiltered) {
						JSONObject item = new JSONObject();
						item.put("tenDangNhap", lt.getTenDangNhap());
						item.put("thoiDiemThich", sdf.format(lt.getThoiDiemThich()));
						arr.put(item);
					}
					
					json.put("success", true);
					json.put("list", arr);
					
				} catch(Exception e) {
					e.printStackTrace();
					json.put("success", false);
					json.put("message", e.getMessage());
				}
				
				out.print(json.toString());
				return;
			}
			
		} catch(Exception e) {
			e.printStackTrace();
			session.setAttribute("message", e.getMessage());
			session.setAttribute("messageType", "error");
		}
		
		// Redirect về trang bình luận của tôi
		response.sendRedirect(request.getContextPath() + "/BinhLuanCuaToiController");
	}

	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		doGet(request, response);
	}
}
- MyPostPage.jsp:
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ page import="java.util.ArrayList" %>
<%@ page import="Modal.BaiViet.BaiViet" %>
<%@ page import="Modal.TheLoai.TheLoai" %>
<%@ page import="Modal.BinhLuan.BinhLuan" %>
<%@ page import="java.text.SimpleDateFormat" %>
<%@ page import="java.util.TimeZone" %>
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bài viết của tôi - Website Forum</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="${pageContext.request.contextPath}/pages/mypost_page/style.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
    <%
        String quyen = (String) session.getAttribute("quyen");
        String account = (String) session.getAttribute("account");
        boolean isAdmin = "Admin".equals(quyen);
        
        ArrayList<TheLoai> dsTheLoai = (ArrayList<TheLoai>) request.getAttribute("dsTheLoai");
        ArrayList<BaiViet> dsBaiViet = (ArrayList<BaiViet>) request.getAttribute("dsBaiViet");
        int selectedTheLoai = -1;
        String selectedTenTheLoai = "";
        if (request.getAttribute("selectedTheLoai") != null) selectedTheLoai = (int) request.getAttribute("selectedTheLoai");
        for (TheLoai tl : dsTheLoai) {
            if (tl.getMaTheLoai() == selectedTheLoai) {
                selectedTenTheLoai = tl.getTenTheLoai();
                break;
            }
        }
        String sortBy = (String) request.getAttribute("sortBy");
        String searchKey = (String) request.getAttribute("searchKey");
        
        SimpleDateFormat sdf = new SimpleDateFormat("dd/MM/yyyy HH:mm:ss");
        sdf.setTimeZone(TimeZone.getTimeZone("Asia/Ho_Chi_Minh"));
        
        Integer currentPage = (Integer) request.getAttribute("currentPage");
        Integer totalPages = (Integer) request.getAttribute("totalPages");
        Integer totalItems = (Integer) request.getAttribute("totalItems");
        Integer startIndex = (Integer) request.getAttribute("startIndex");
        
        if (currentPage == null) currentPage = 1;
        if (totalPages == null) totalPages = 0;
        if (totalItems == null) totalItems = 0;
        if (startIndex == null) startIndex = 0;
        
        String message = (String) request.getAttribute("message");
        String messageType = (String) request.getAttribute("messageType");
    %>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-gradient sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand d-none d-lg-flex align-items-center" href="${pageContext.request.contextPath}/TrangChuController">
                <i class="bi bi-chat-dots-fill me-2"></i>
                <span class="fw-bold">Forum</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarContent">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="${pageContext.request.contextPath}/TrangChuController">
                            <i class="bi bi-house-fill me-1"></i> Trang chủ
                        </a>
                    </li>
                    <% if (isAdmin) { %>
                    <li class="nav-item">
						<a class="nav-link" href="${pageContext.request.contextPath}/TaiKhoanController">
							<i class="bi bi-tags-fill me-1"></i>Tài khoản
						</a>
					</li>
                    <li class="nav-item">
                        <a class="nav-link" href="${pageContext.request.contextPath}/TheLoaiController">
                            <i class="bi bi-tags-fill me-1"></i>Thể loại
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="${pageContext.request.contextPath}/BaiVietController">
                            <i class="bi bi-file-text-fill me-1"></i>Bài viết
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="${pageContext.request.contextPath}/BinhLuanController">
                            <i class="bi bi-chat-left-text-fill me-1"></i>Bình luận
                        </a>
                    </li>
                    <% } %>
                    <li class="nav-item">
                        <a class="nav-link active" href="${pageContext.request.contextPath}/BaiVietCuaToiController">
                            <i class="bi bi-journal-text me-1"></i>Bài viết của tôi
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="${pageContext.request.contextPath}/BinhLuanCuaToiController">
                            <i class="bi bi-chat-square-dots me-1"></i>Bình luận của tôi
                        </a>
                    </li>
                </ul>
                <div class="dropdown">
                    <button class="btn btn-user dropdown-toggle" type="button" data-bs-toggle="dropdown">
                        <i class="bi bi-person-circle"></i>
                        <span class="ms-2 d-none d-lg-inline"><%= account %></span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="${pageContext.request.contextPath}/ThongTinCaNhanController">
                            <i class="bi bi-person-fill me-2"></i>Thông tin cá nhân
                        </a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item text-danger" href="${pageContext.request.contextPath}/DangXuatController">
                            <i class="bi bi-box-arrow-right me-2"></i>Đăng xuất
                        </a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid mt-4">
        <div class="row g-3">
            <!-- Center Content - Posts -->
            <div class="col-lg-9 col-md-8 col-12">
                <!-- Page Title -->
                <div class="card shadow-sm mb-3 title-card">
                    <div class="card-body">
                        <h4 class="mb-0">
                            <i class="bi bi-journal-text me-2"></i>
                            Danh sách bài viết của <%= account %>
                        </h4>
                    </div>
                </div>

                <!-- Alert Container (Auto dismiss) -->
                <div id="messageAlert" class="alert-container" style="display: none;">
                    <div class="alert fade" role="alert">
                        <i class="bi me-2"></i>
                        <span id="messageText"></span>
                    </div>
                </div>

                <!-- Add New Post Button -->
                <div class="mb-3">
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addPostModal">
                        <i class="bi bi-plus-circle me-2"></i>Tạo bài viết mới
                    </button>
                </div>

                <!-- Sort & Filter Controls -->
                <div class="card shadow-sm mb-3 controls-card">
                    <div class="card-body">
                        <div class="row g-2">
                            <div class="col-md-6">
                                <label class="form-label small fw-bold">Sắp xếp:</label>
                                <select class="form-select form-select-sm" id="sortSelect" onchange="handleSort(this.value)">
                                    <option value="">-- Chọn --</option>
                                    <option value="danhGiaCao" <%= "danhGiaCao".equals(sortBy) ? "selected" : "" %>>Đánh giá cao nhất</option>
                                    <option value="danhGiaThap" <%= "danhGiaThap".equals(sortBy) ? "selected" : "" %>>Đánh giá thấp nhất</option>
                                    <option value="taoGanNhat" <%= "taoGanNhat".equals(sortBy) ? "selected" : "" %>>Tạo gần nhất</option>
                                    <option value="taoXaNhat" <%= "taoXaNhat".equals(sortBy) ? "selected" : "" %>>Tạo xa nhất</option>
                                    <option value="capNhatGanNhat" <%= "capNhatGanNhat".equals(sortBy) ? "selected" : "" %>>Cập nhật gần nhất</option>
                                    <option value="capNhatXaNhat" <%= "capNhatXaNhat".equals(sortBy) ? "selected" : "" %>>Cập nhật xa nhất</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label small fw-bold">Lọc theo thể loại:</label>
                                <select class="form-select form-select-sm" id="filterTheLoaiSelect" onchange="handleFilterTheLoai(this.value)">
                                    <option value="">-- Tất cả thể loại --</option>
                                    <% 
                                        if (dsTheLoai != null && !dsTheLoai.isEmpty()) {
                                            for (TheLoai tl : dsTheLoai) { 
                                    %>
                                        <option value="<%= tl.getMaTheLoai() %>" <%= tl.getMaTheLoai() == selectedTheLoai ? "selected" : "" %>>
                                            <%= tl.getTenTheLoai() %>
                                        </option>
                                    <% 
                                            }
                                        }
                                    %>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Posts List -->
                <div class="posts-container">
                    <% if (dsBaiViet == null || dsBaiViet.isEmpty()) { %>
                        <div class="card shadow-sm">
                            <div class="card-body text-center py-5">
                                <i class="bi bi-inbox text-muted" style="font-size: 4rem;"></i>
                                <h5 class="mt-3 text-muted">
                                    <% if (selectedTheLoai != -1) { %>
                                        Bạn chưa có bài viết nào thuộc thể loại "<%= selectedTenTheLoai %>"
                                    <% } else if (searchKey != null && !searchKey.trim().isEmpty()) { %>
                                        Không tìm thấy bài viết phù hợp với từ khóa tìm kiếm
                                    <% } else { %>
                                        Bạn chưa có bài viết nào. Hãy tạo bài viết đầu tiên!
                                    <% } %>
                                </h5>
                            </div>
                        </div>
                    <% } else {
                        for (BaiViet bv : dsBaiViet) {
                            String tenTheLoai = "";
                            if (dsTheLoai != null) {
                                for (TheLoai tl : dsTheLoai) {
                                    if (tl.getMaTheLoai() == bv.getMaTheLoai()) {
                                        tenTheLoai = tl.getTenTheLoai();
                                        break;
                                    }
                                }
                            }
                            ArrayList<BinhLuan> dsBinhLuan = (ArrayList<BinhLuan>) request.getAttribute("dsBinhLuan_" + bv.getMaBaiViet());
                            int soBinhLuan = (dsBinhLuan != null) ? dsBinhLuan.size() : 0;
                    %>
                        <div class="card shadow-sm mb-3 post-card" 
                             data-ma-bai-viet="<%= bv.getMaBaiViet() %>"
                             data-tieu-de="<%= bv.getTieuDe().replace("\"", "&quot;") %>"
                             data-noi-dung="<%= bv.getNoiDung().replace("\"", "&quot;").replace("\n", "&#10;") %>"
                             data-url="<%= bv.getUrl() != null ? bv.getUrl() : "" %>"
                             data-ma-the-loai="<%= bv.getMaTheLoai() %>">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <div class="d-flex align-items-center flex-grow-1" onclick="window.location.href='${pageContext.request.contextPath}/ChiTietBaiVietController?id=<%= bv.getMaBaiViet() %>'" style="cursor: pointer;">
                                        <i class="bi bi-person-circle post-avatar"></i>
                                        <div class="ms-2">
                                            <div class="fw-bold"><%= bv.getTaiKhoanTao() %></div>
                                            <small class="text-muted">
                                                <i class="bi bi-clock me-1"></i>
                                                <%= bv.getThoiDiemCapNhat() != null ? sdf.format(bv.getThoiDiemCapNhat()) : sdf.format(bv.getThoiDiemTao()) %>
                                            </small>
                                        </div>
                                    </div>
                                    <div class="dropdown">
                                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                            <i class="bi bi-three-dots-vertical"></i>
                                        </button>
                                        <ul class="dropdown-menu dropdown-menu-end">
                                            <li><a class="dropdown-item" href="#" onclick="editPost(<%= bv.getMaBaiViet() %>); return false;">
                                                <i class="bi bi-pencil me-2"></i>Sửa
                                            </a></li>
                                            <li><hr class="dropdown-divider"></li>
                                            <li><a class="dropdown-item text-danger" href="#" onclick="deletePost(<%= bv.getMaBaiViet() %>, '<%= bv.getTieuDe().replace("'", "\\'") %>'); return false;">
                                                <i class="bi bi-trash me-2"></i>Xóa
                                            </a></li>
                                        </ul>
                                    </div>
                                </div>
                                <div onclick="window.location.href='${pageContext.request.contextPath}/ChiTietBaiVietController?id=<%= bv.getMaBaiViet() %>'" style="cursor: pointer;">
                                    <div class="mb-2">
                                        <span class="badge bg-primary"><i class="bi bi-tag me-1"></i><%= tenTheLoai %></span>
                                        <% if (!"Active".equals(bv.getTrangThai())) { %>
                                            <span class="badge bg-danger ms-1"><%= bv.getTrangThai() %></span>
                                        <% } %>
                                    </div>
                                    <h5 class="post-title"><%= bv.getTieuDe() %></h5>
                                    <p class="post-content"><%= bv.getNoiDung().length() > 200 ? bv.getNoiDung().substring(0, 200) + "..." : bv.getNoiDung() %></p>
                                    <% if (bv.getUrl() != null && !bv.getUrl().trim().isEmpty()) { %>
									    <div class="post-media mb-3">
									        <% 
									        String contextPath = request.getContextPath();
									        String fullUrl = contextPath + "/" + bv.getUrl();
									        
									        if (bv.getUrl().matches(".*\\.(jpg|jpeg|png|gif|webp)$")) { %>
									            <img src="<%= fullUrl %>" class="img-fluid rounded" alt="Post image">
									        <% } else if (bv.getUrl().matches(".*\\.(mp4|webm|ogg)$")) { %>
									            <video controls class="w-100 rounded">
									                <source src="<%= fullUrl %>" type="video/mp4">
									            </video>
									        <% } %>
									    </div>
									<% } %>
                                    <div class="d-flex justify-content-between align-items-center pt-2 border-top">
                                        <div class="text-muted">
                                            <i class="bi bi-chat-fill me-1"></i>
                                            <span><%= soBinhLuan %> bình luận</span>
                                        </div>
                                        <div class="rating-display">
                                            <% 
                                                double danhGia = (bv.getDanhGia() != null) ? bv.getDanhGia().doubleValue() : 0;
                                                for (int i = 1; i <= 5; i++) {
                                                    if (i <= danhGia) { %>
                                                        <i class="bi bi-star-fill text-warning"></i>
                                            <%      } else { %>
                                                        <i class="bi bi-star text-warning"></i>
                                            <%      }
                                                }
                                            %>
                                            <span class="ms-1 text-muted"><%= String.format("%.1f", danhGia) %></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <% }
                    } %>
                    <% if (totalPages > 1) { %>
                        <nav aria-label="Page navigation" class="mt-4">
                            <ul class="pagination justify-content-center">
                                <li class="page-item <%= currentPage == 1 ? "disabled" : "" %>">
                                    <a class="page-link" href="<%= currentPage > 1 ? buildPaginationUrl(request, currentPage - 1) : "#" %>" aria-label="Previous">
                                        <span aria-hidden="true">&laquo;</span>
                                    </a>
                                </li>
                                <%
                                    int startPage = Math.max(1, currentPage - 2);
                                    int endPage = Math.min(totalPages, currentPage + 2);
                                    if (currentPage <= 3) {
                                        endPage = Math.min(5, totalPages);
                                    }
                                    if (currentPage >= totalPages - 2) {
                                        startPage = Math.max(1, totalPages - 4);
                                    }
                                    if (startPage > 1) {
                                %>
                                        <li class="page-item">
                                            <a class="page-link" href="<%= buildPaginationUrl(request, 1) %>">1</a>
                                        </li>
                                        <% if (startPage > 2) { %>
                                            <li class="page-item disabled">
                                                <span class="page-link">...</span>
                                            </li>
                                        <% } %>
                                <%
                                    }
                                    for (int i = startPage; i <= endPage; i++) {
                                %>
                                        <li class="page-item <%= i == currentPage ? "active" : "" %>">
                                            <a class="page-link" href="<%= buildPaginationUrl(request, i) %>"><%= i %></a>
                                        </li>
                                <%
                                    }
                                    if (endPage < totalPages) {
                                        if (endPage < totalPages - 1) {
                                %>
                                            <li class="page-item disabled">
                                                <span class="page-link">...</span>
                                            </li>
                                <%
                                        }
                                %>
                                        <li class="page-item">
                                            <a class="page-link" href="<%= buildPaginationUrl(request, totalPages) %>"><%= totalPages %></a>
                                        </li>
                                <%
                                    }
                                %>
                                <li class="page-item <%= currentPage == totalPages ? "disabled" : "" %>">
                                    <a class="page-link" href="<%= currentPage < totalPages ? buildPaginationUrl(request, currentPage + 1) : "#" %>" aria-label="Next">
                                        <span aria-hidden="true">&raquo;</span>
                                    </a>
                                </li>
                            </ul>
                        </nav>
                        <div class="text-center text-muted mt-2">
                            <small>
                                Trang <%= currentPage %> / <%= totalPages %> 
                                (Tổng <%= totalItems %> bài viết)
                            </small>
                        </div>
                    <% } %>
                </div>
            </div>

            <!-- Right Sidebar - Search -->
            <div class="col-lg-3 col-md-4 d-none d-md-block">
                <div class="card shadow-sm search-card sticky-top" style="top: 80px;">
                    <div class="card-header bg-gradient text-white">
                        <h5 class="mb-0"><i class="bi bi-search me-2"></i>Tìm kiếm</h5>
                    </div>
                    <div class="card-body">
                        <form action="${pageContext.request.contextPath}/BaiVietCuaToiController" method="get">
                            <div class="input-group">
                                <input type="text" class="form-control" name="search" 
                                       placeholder="Tìm kiếm bài viết..." 
                                       value="<%= searchKey != null ? searchKey : "" %>">
                                <button class="btn btn-primary" type="submit">
                                    <i class="bi bi-search"></i>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer mt-5">
        <div class="container text-center">
            <p class="mb-0">&copy; 2025 Website Forum. All rights reserved.</p>
        </div>
    </footer>

    <!-- Add Post Modal - UPDATED -->
	<div class="modal fade" id="addPostModal" tabindex="-1">
	    <div class="modal-dialog modal-lg modal-dialog-scrollable">
	        <div class="modal-content">
	            <div class="modal-header bg-gradient text-white">
	                <h5 class="modal-title"><i class="bi bi-plus-circle me-2"></i>Tạo bài viết mới</h5>
	                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
	            </div>
	            <form action="${pageContext.request.contextPath}/XuLyBaiVietCuaToiController" method="post" id="addPostForm">
	                <input type="hidden" name="action" value="create">
	                <input type="hidden" id="addUrlHidden" name="url" value="">
	                <div class="modal-body">
	                    <div class="mb-3">
	                        <label class="form-label">Tiêu đề <span class="text-danger">*</span></label>
	                        <input type="text" class="form-control" name="tieuDe" id="addTieuDe" required maxlength="255">
	                    </div>
	                    <div class="mb-3">
	                        <label class="form-label">Thể loại <span class="text-danger">*</span></label>
	                        <select class="form-select" name="maTheLoai" id="addMaTheLoai" required>
	                            <option value="">-- Chọn thể loại --</option>
	                            <% if (dsTheLoai != null) {
	                                for (TheLoai tl : dsTheLoai) { %>
	                                    <option value="<%= tl.getMaTheLoai() %>"><%= tl.getTenTheLoai() %></option>
	                            <% }
	                            } %>
	                        </select>
	                    </div>
	                    <div class="mb-3">
	                        <label class="form-label">Nội dung <span class="text-danger">*</span></label>
	                        <textarea class="form-control" name="noiDung" id="addNoiDung" rows="6" required></textarea>
	                    </div>
	                    
	                    <!-- Upload File Section -->
	                    <div class="mb-3">
	                        <label class="form-label fw-bold">Ảnh/Video</label>
	                        <div class="upload-container">
	                            <input type="file" id="addFileInput" accept="image/*,video/*" style="display: none;">
	                            <button type="button" class="btn btn-upload" onclick="document.getElementById('addFileInput').click()">
	                                <i class="bi bi-cloud-upload me-2"></i>Tải ảnh/video lên
	                            </button>
	                            <div class="file-status mt-2">
	                                <i class="bi bi-file-earmark"></i>
	                                <span id="addFileStatus" class="text-muted">Chưa có ảnh/video</span>
	                            </div>
	                            <div id="addFilePreview" class="file-preview mt-3" style="display: none;"></div>
	                        </div>
	                        <small class="text-muted">
	                            Hỗ trợ: .jpg, .jpeg, .png, .gif, .webp (ảnh), .mp4, .webm, .ogg (video) - Tối đa 50MB
	                        </small>
	                    </div>
	                </div>
	                <div class="modal-footer">
	                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
	                    <button type="submit" class="btn btn-primary"><i class="bi bi-check-circle me-2"></i>Tạo bài viết</button>
	                </div>
	            </form>
	        </div>
	    </div>
	</div>
	
	<!-- Edit Post Modal - UPDATED -->
	<div class="modal fade" id="editPostModal" tabindex="-1">
	    <div class="modal-dialog modal-lg modal-dialog-scrollable">
	        <div class="modal-content">
	            <div class="modal-header bg-gradient text-white">
	                <h5 class="modal-title"><i class="bi bi-pencil me-2"></i>Chỉnh sửa bài viết</h5>
	                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
	            </div>
	            <form action="${pageContext.request.contextPath}/XuLyBaiVietCuaToiController" method="post" id="editPostForm">
	                <input type="hidden" name="action" value="update">
	                <input type="hidden" name="maBaiViet" id="editMaBaiViet">
	                <input type="hidden" id="editUrlHidden" name="url" value="">
	                <input type="hidden" id="editKeepOldFile" name="keepOldFile" value="false">
	                <div class="modal-body">
	                    <div class="mb-3">
	                        <label class="form-label">Tiêu đề <span class="text-danger">*</span></label>
	                        <input type="text" class="form-control" name="tieuDe" id="editTieuDe" required maxlength="255">
	                    </div>
	                    <div class="mb-3">
	                        <label class="form-label">Thể loại <span class="text-danger">*</span></label>
	                        <select class="form-select" name="maTheLoai" id="editMaTheLoai" required>
	                            <option value="">-- Chọn thể loại --</option>
	                            <% if (dsTheLoai != null) {
	                                for (TheLoai tl : dsTheLoai) { %>
	                                    <option value="<%= tl.getMaTheLoai() %>"><%= tl.getTenTheLoai() %></option>
	                            <% }
	                            } %>
	                        </select>
	                    </div>
	                    <div class="mb-3">
	                        <label class="form-label">Nội dung <span class="text-danger">*</span></label>
	                        <textarea class="form-control" name="noiDung" id="editNoiDung" rows="6" required></textarea>
	                    </div>
	                    
	                    <!-- Upload File Section -->
	                    <div class="mb-3">
	                        <label class="form-label fw-bold">Ảnh/Video</label>
	                        <div class="upload-container">
	                            <input type="file" id="editFileInput" accept="image/*,video/*" style="display: none;">
	                            <button type="button" class="btn btn-upload" onclick="document.getElementById('editFileInput').click()">
	                                <i class="bi bi-cloud-upload me-2"></i>Tải ảnh/video lên
	                            </button>
	                            <div class="file-status mt-2">
	                                <i class="bi bi-file-earmark"></i>
	                                <span id="editFileStatus" class="text-muted">Chưa có ảnh/video</span>
	                            </div>
	                            <div id="editFilePreview" class="file-preview mt-3" style="display: none;"></div>
	                            <button type="button" class="btn btn-sm btn-danger mt-2" id="editRemoveFileBtn" 
	                                    style="display: none;" onclick="removeEditFile()">
	                                <i class="bi bi-trash me-1"></i>Xóa file
	                            </button>
	                        </div>
	                        <small class="text-muted">
	                            Hỗ trợ: .jpg, .jpeg, .png, .gif, .webp (ảnh), .mp4, .webm, .ogg (video) - Tối đa 50MB
	                        </small>
	                    </div>
	                </div>
	                <div class="modal-footer">
	                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
	                    <button type="submit" class="btn btn-primary"><i class="bi bi-check-circle me-2"></i>Cập nhật</button>
	                </div>
	            </form>
	        </div>
	    </div>
	</div>

    <%!
        private String buildPaginationUrl(HttpServletRequest request, int page) {
            String contextPath = request.getContextPath();
            String theloai = request.getParameter("theloai");
            String sort = request.getParameter("sort");
            String search = request.getParameter("search");
            
            StringBuilder url = new StringBuilder(contextPath + "/BaiVietCuaToiController?page=" + page);
            
            if (theloai != null && !theloai.trim().isEmpty()) {
                try {
                    url.append("&theloai=").append(java.net.URLEncoder.encode(theloai, "UTF-8"));
                } catch (Exception e) {
                    e.printStackTrace();
                }
            }
            if (sort != null && !sort.trim().isEmpty()) {
                try {
                    url.append("&sort=").append(java.net.URLEncoder.encode(sort, "UTF-8"));
                } catch (Exception e) {
                    e.printStackTrace();
                }
            }
            if (search != null && !search.trim().isEmpty()) {
                try {
                    url.append("&search=").append(java.net.URLEncoder.encode(search, "UTF-8"));
                } catch (Exception e) {
                    e.printStackTrace();
                }
            }
            
            return url.toString();
        }
    %>

    <script src="${pageContext.request.contextPath}/pages/mypost_page/script.js"></script>
    <script>
        // Show message from server - Auto dismiss after 3 seconds
        <% if (message != null && messageType != null) { 
            String escapedMessage = message.replace("\\", "\\\\").replace("'", "\\'").replace("\n", "\\n").replace("\r", "\\r");
        %>
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(function() {
                    showMessage('<%= escapedMessage %>', '<%= messageType %>');
                }, 100);
            });
        <% } %>
    </script>
</body>
</html>
- script.js (Của MyPostPage):
document.addEventListener('DOMContentLoaded', function() {
    // Initialize tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
});

// Show message alert with auto dismiss
function showMessage(message, type) {
	const alertContainer = document.getElementById('messageAlert');
	const messageText = document.getElementById('messageText');
	const alert = alertContainer.querySelector('.alert');
	const icon = alert.querySelector('i');
	
	// Set message text
	messageText.textContent = message;
	
	// Set alert type
	alert.className = 'alert fade show';
	if (type === 'success') {
		alert.classList.add('alert-success');
		icon.className = 'bi bi-check-circle-fill me-2';
	} else {
		alert.classList.add('alert-danger');
		icon.className = 'bi bi-exclamation-circle-fill me-2';
	}
	
	// Show alert
	alertContainer.style.display = 'block';
	
	// Auto hide after 3 seconds
	setTimeout(() => {
		alertContainer.style.display = 'none';
	}, 3000);
}

// Handle sort selection
function handleSort(value) {
    if (!value) return;
    
    const urlParams = new URLSearchParams(window.location.search);
    const contextPath = window.location.pathname.split('/')[1];
    const theloai = urlParams.get('theloai');
    const search = urlParams.get('search');
    const page = urlParams.get('page');
    
    let url = '/' + contextPath + '/BaiVietCuaToiController?sort=' + value;
    if (theloai) url += '&theloai=' + encodeURIComponent(theloai);
    if (search) url += '&search=' + encodeURIComponent(search);
    if (page) url += '&page=' + encodeURIComponent(page);
    
    window.location.href = url;
}

// Handle filter by the loai
function handleFilterTheLoai(value) {
    const urlParams = new URLSearchParams(window.location.search);
    const contextPath = window.location.pathname.split('/')[1];
    const search = urlParams.get('search');
    const sort = urlParams.get('sort');
    const page = urlParams.get('page');
    
    let url = '/' + contextPath + '/BaiVietCuaToiController';
    let params = [];
    
    if (search) params.push('search=' + encodeURIComponent(search));
    if (sort) params.push('sort=' + sort);
    if (value) params.push('theloai=' + encodeURIComponent(value));
    if (page) params.push('page=' + encodeURIComponent(page));
    
    if (params.length > 0) url += '?' + params.join('&');
    
    window.location.href = url;
}

// Edit post
function editPost(maBaiViet) {
    // Find the post card by maBaiViet
    const postCard = document.querySelector(`.post-card[data-ma-bai-viet="${maBaiViet}"]`);
    if (!postCard) {
        alert('Không tìm thấy bài viết!');
        return;
    }

    // Get data from data attributes
    const maBaiVietValue = postCard.getAttribute('data-ma-bai-viet');
    const tieuDe = postCard.getAttribute('data-tieu-de');
    const noiDung = postCard.getAttribute('data-noi-dung').replace(/&#10;/g, '\n');
    const url = postCard.getAttribute('data-url');
    const maTheLoai = postCard.getAttribute('data-ma-the-loai');

    // Populate the edit form
    document.getElementById('editMaBaiViet').value = maBaiVietValue;
    document.getElementById('editTieuDe').value = tieuDe;
    document.getElementById('editNoiDung').value = noiDung;
    document.getElementById('editUrl').value = url || '';
    document.getElementById('editMaTheLoai').value = maTheLoai;

    // Show the edit modal
    const modal = new bootstrap.Modal(document.getElementById('editPostModal'));
    modal.show();
}

// Delete post
function deletePost(maBaiViet, tieuDe) {
    if (confirm('Bạn có chắc chắn muốn xóa bài viết "' + tieuDe + '"?\n\nLưu ý: Tất cả bình luận của bài viết này cũng sẽ bị xóa!')) {
        const contextPath = window.location.pathname.split('/')[1];
        window.location.href = '/' + contextPath + '/XuLyBaiVietCuaToiController?action=delete&maBaiViet=' + maBaiViet;
    }
}

// Close modal on escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        const modals = ['postDetailModal', 'addPostModal', 'editPostModal'];
        modals.forEach(modalId => {
            const modalElement = document.getElementById(modalId);
            if (modalElement) {
                const modal = bootstrap.Modal.getInstance(modalElement);
                if (modal) modal.hide();
            }
        });
    }
});

// Form validation
document.addEventListener('DOMContentLoaded', function() {
    const forms = document.querySelectorAll('form');
    forms.forEach(form => {
        form.addEventListener('submit', function(e) {
            const tieuDeInput = form.querySelector('input[name="tieuDe"]');
            const noiDungInput = form.querySelector('textarea[name="noiDung"]');
            
            if (tieuDeInput && tieuDeInput.value.trim().length > 255) {
                e.preventDefault();
                alert('Tiêu đề không được quá 255 ký tự!');
                tieuDeInput.focus();
                return false;
            }
            
            if (noiDungInput && noiDungInput.value.trim() === '') {
                e.preventDefault();
                alert('Nội dung không được để trống!');
                noiDungInput.focus();
                return false;
            }
        });
    });
});

// ============================================
// Upload File Functions
// ============================================

let addUploadedFileUrl = '';
let editUploadedFileUrl = '';
let editOriginalFileUrl = '';

// Initialize upload listeners
document.addEventListener('DOMContentLoaded', function() {
    const addFileInput = document.getElementById('addFileInput');
    if(addFileInput) {
        addFileInput.addEventListener('change', handleAddFileSelect);
    }
    
    const editFileInput = document.getElementById('editFileInput');
    if(editFileInput) {
        editFileInput.addEventListener('change', handleEditFileSelect);
    }
});

// Handle Add File Select
function handleAddFileSelect(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    console.log('Add file selected:', file.name, file.type, file.size);
    
    const validImageTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
    const validVideoTypes = ['video/mp4', 'video/webm', 'video/ogg'];
    const allValidTypes = [...validImageTypes, ...validVideoTypes];
    
    if (!allValidTypes.includes(file.type)) {
        alert('Định dạng file không được hỗ trợ! Vui lòng chọn file ảnh (.jpg, .png, .gif, .webp) hoặc video (.mp4, .webm, .ogg)');
        event.target.value = '';
        return;
    }
    
    if (file.size > 50 * 1024 * 1024) {
        alert('Kích thước file quá lớn! Vui lòng chọn file nhỏ hơn 50MB');
        event.target.value = '';
        return;
    }
    
    document.getElementById('addFileStatus').textContent = 'Đang chuẩn bị tải lên...';
    document.getElementById('addFileStatus').classList.remove('text-muted');
    document.getElementById('addFileStatus').classList.add('text-primary');
    
    showAddFilePreview(file);
    uploadAddFile(file);
}

// Upload Add File
function uploadAddFile(file) {
    const formData = new FormData();
    formData.append('file', file);
    
    const statusElement = document.getElementById('addFileStatus');
    statusElement.innerHTML = '<i class="spinner-border spinner-border-sm me-2"></i>Đang tải lên...';
    statusElement.classList.remove('text-success', 'text-danger', 'text-muted');
    statusElement.classList.add('text-primary');
    
    const contextPath = window.location.pathname.split('/')[1];
    
    fetch('/' + contextPath + '/UploadFileController', {
        method: 'POST',
        body: formData
    })
    .then(response => {
        console.log('Upload response status:', response.status);
        return response.json();
    })
    .then(data => {
        console.log('Upload response data:', data);
        if (data.success) {
            addUploadedFileUrl = data.url;
            document.getElementById('addUrlHidden').value = data.url;
            statusElement.textContent = data.fileName;
            statusElement.classList.remove('text-primary');
            statusElement.classList.add('text-success');
            console.log('Upload success! URL:', data.url);
        } else {
            throw new Error(data.message || 'Upload thất bại');
        }
    })
    .catch(error => {
        console.error('Upload error:', error);
        statusElement.textContent = 'Lỗi: ' + error.message;
        statusElement.classList.remove('text-primary');
        statusElement.classList.add('text-danger');
        document.getElementById('addFileInput').value = '';
        document.getElementById('addFilePreview').style.display = 'none';
        addUploadedFileUrl = '';
    });
}

// Show Add File Preview
function showAddFilePreview(file) {
    const preview = document.getElementById('addFilePreview');
    preview.innerHTML = '';
    preview.style.display = 'block';
    
    const reader = new FileReader();
    
    if (file.type.startsWith('image/')) {
        reader.onload = function(e) {
            const img = document.createElement('img');
            img.src = e.target.result;
            img.style.maxWidth = '100%';
            img.style.maxHeight = '400px';
            img.style.objectFit = 'contain';
            img.style.borderRadius = '12px';
            preview.appendChild(img);
        };
        reader.readAsDataURL(file);
    } else if (file.type.startsWith('video/')) {
        reader.onload = function(e) {
            const video = document.createElement('video');
            video.src = e.target.result;
            video.controls = true;
            video.style.width = '100%';
            video.style.maxHeight = '400px';
            video.style.borderRadius = '12px';
            preview.appendChild(video);
        };
        reader.readAsDataURL(file);
    }
}

// Handle Edit File Select
function handleEditFileSelect(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    console.log('Edit file selected:', file.name, file.type, file.size);
    
    const validImageTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
    const validVideoTypes = ['video/mp4', 'video/webm', 'video/ogg'];
    const allValidTypes = [...validImageTypes, ...validVideoTypes];
    
    if (!allValidTypes.includes(file.type)) {
        alert('Định dạng file không được hỗ trợ! Vui lòng chọn file ảnh (.jpg, .png, .gif, .webp) hoặc video (.mp4, .webm, .ogg)');
        event.target.value = '';
        return;
    }
    
    if (file.size > 50 * 1024 * 1024) {
        alert('Kích thước file quá lớn! Vui lòng chọn file nhỏ hơn 50MB');
        event.target.value = '';
        return;
    }
    
    document.getElementById('editFileStatus').textContent = 'Đang chuẩn bị tải lên...';
    document.getElementById('editFileStatus').classList.remove('text-muted');
    document.getElementById('editFileStatus').classList.add('text-primary');
    
    showEditFilePreview(file);
    document.getElementById('editRemoveFileBtn').style.display = 'inline-block';
    document.getElementById('editKeepOldFile').value = 'false';
    
    uploadEditFile(file);
}

// Upload Edit File
function uploadEditFile(file) {
    const formData = new FormData();
    formData.append('file', file);
    
    const statusElement = document.getElementById('editFileStatus');
    statusElement.innerHTML = '<i class="spinner-border spinner-border-sm me-2"></i>Đang tải lên...';
    statusElement.classList.remove('text-success', 'text-danger', 'text-muted');
    statusElement.classList.add('text-primary');
    
    const contextPath = window.location.pathname.split('/')[1];
    
    fetch('/' + contextPath + '/UploadFileController', {
        method: 'POST',
        body: formData
    })
    .then(response => {
        console.log('Edit upload response status:', response.status);
        return response.json();
    })
    .then(data => {
        console.log('Edit upload response data:', data);
        if (data.success) {
            editUploadedFileUrl = data.url;
            document.getElementById('editUrlHidden').value = data.url;
            statusElement.textContent = data.fileName;
            statusElement.classList.remove('text-primary');
            statusElement.classList.add('text-success');
            console.log('Edit upload success! URL:', data.url);
        } else {
            throw new Error(data.message || 'Upload thất bại');
        }
    })
    .catch(error => {
        console.error('Edit upload error:', error);
        statusElement.textContent = 'Lỗi: ' + error.message;
        statusElement.classList.remove('text-primary');
        statusElement.classList.add('text-danger');
        document.getElementById('editFileInput').value = '';
        document.getElementById('editFilePreview').style.display = 'none';
        editUploadedFileUrl = '';
    });
}

// Show Edit File Preview
function showEditFilePreview(file) {
    const preview = document.getElementById('editFilePreview');
    preview.innerHTML = '';
    preview.style.display = 'block';
    
    const reader = new FileReader();
    
    if (file.type.startsWith('image/')) {
        reader.onload = function(e) {
            const img = document.createElement('img');
            img.src = e.target.result;
            img.style.maxWidth = '100%';
            img.style.maxHeight = '400px';
            img.style.objectFit = 'contain';
            img.style.borderRadius = '12px';
            preview.appendChild(img);
        };
        reader.readAsDataURL(file);
    } else if (file.type.startsWith('video/')) {
        reader.onload = function(e) {
            const video = document.createElement('video');
            video.src = e.target.result;
            video.controls = true;
            video.style.width = '100%';
            video.style.maxHeight = '400px';
            video.style.borderRadius = '12px';
            preview.appendChild(video);
        };
        reader.readAsDataURL(file);
    }
}

// Remove Edit File
function removeEditFile() {
    document.getElementById('editFileInput').value = '';
    document.getElementById('editFileStatus').textContent = 'Chưa có ảnh/video';
    document.getElementById('editFileStatus').classList.remove('text-success');
    document.getElementById('editFileStatus').classList.add('text-muted');
    document.getElementById('editFilePreview').style.display = 'none';
    document.getElementById('editRemoveFileBtn').style.display = 'none';
    document.getElementById('editUrlHidden').value = '';
    document.getElementById('editKeepOldFile').value = 'false';
    editUploadedFileUrl = '';
}

// Update editPost function
const originalEditPost = editPost;
editPost = function(maBaiViet) {
    const postCard = document.querySelector(`.post-card[data-ma-bai-viet="${maBaiViet}"]`);
    if (!postCard) {
        alert('Không tìm thấy bài viết!');
        return;
    }

    const maBaiVietValue = postCard.getAttribute('data-ma-bai-viet');
    const tieuDe = postCard.getAttribute('data-tieu-de');
    const noiDung = postCard.getAttribute('data-noi-dung').replace(/&#10;/g, '\n');
    const url = postCard.getAttribute('data-url');
    const maTheLoai = postCard.getAttribute('data-ma-the-loai');

    document.getElementById('editMaBaiViet').value = maBaiVietValue;
    document.getElementById('editTieuDe').value = tieuDe;
    document.getElementById('editNoiDung').value = noiDung;
    document.getElementById('editMaTheLoai').value = maTheLoai;

    // Handle file
    editOriginalFileUrl = url || '';
    editUploadedFileUrl = '';
    document.getElementById('editFileInput').value = '';
    document.getElementById('editUrlHidden').value = editOriginalFileUrl;
    document.getElementById('editKeepOldFile').value = 'true';
    
    const contextPath = window.location.pathname.split('/')[1];
    
    if (editOriginalFileUrl && editOriginalFileUrl.trim() !== '') {
        const fileName = editOriginalFileUrl.split('/').pop();
        document.getElementById('editFileStatus').textContent = fileName;
        document.getElementById('editFileStatus').classList.remove('text-muted');
        document.getElementById('editFileStatus').classList.add('text-success');
        
        const preview = document.getElementById('editFilePreview');
        preview.innerHTML = '';
        preview.style.display = 'block';
        
        const fullUrl = '/' + contextPath + '/' + editOriginalFileUrl;
        
        if (editOriginalFileUrl.match(/\.(jpg|jpeg|png|gif|webp)$/i)) {
            const img = document.createElement('img');
            img.src = fullUrl;
            img.style.maxWidth = '100%';
            img.style.maxHeight = '400px';
            img.style.objectFit = 'contain';
            img.style.borderRadius = '12px';
            preview.appendChild(img);
        } else if (editOriginalFileUrl.match(/\.(mp4|webm|ogg)$/i)) {
            const video = document.createElement('video');
            video.src = fullUrl;
            video.controls = true;
            video.style.width = '100%';
            video.style.maxHeight = '400px';
            video.style.borderRadius = '12px';
            preview.appendChild(video);
        }
        
        document.getElementById('editRemoveFileBtn').style.display = 'inline-block';
    } else {
        document.getElementById('editFileStatus').textContent = 'Chưa có ảnh/video';
        document.getElementById('editFileStatus').classList.remove('text-success');
        document.getElementById('editFileStatus').classList.add('text-muted');
        document.getElementById('editFilePreview').style.display = 'none';
        document.getElementById('editRemoveFileBtn').style.display = 'none';
    }

    const modal = new bootstrap.Modal(document.getElementById('editPostModal'));
    modal.show();
};

// Reset upload state when opening add modal
document.getElementById('addPostModal').addEventListener('show.bs.modal', function () {
    addUploadedFileUrl = '';
    document.getElementById('addFileInput').value = '';
    document.getElementById('addFileStatus').textContent = 'Chưa có ảnh/video';
    document.getElementById('addFileStatus').classList.remove('text-success', 'text-primary');
    document.getElementById('addFileStatus').classList.add('text-muted');
    document.getElementById('addFilePreview').style.display = 'none';
    document.getElementById('addUrlHidden').value = '';
});
- style.css (Của MyPostPage):
/* style.css (MyPostPage) - Full Code */
@charset "UTF-8";

/* =======================
   Global Styles
======================= */
* {
	margin: 0;
	padding: 0;
	box-sizing: border-box;
	transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease;
}

body {
	font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
	background-color: #f0f2f5 !important;
	min-height: 100vh !important;
}

/* =======================
   Navbar Styles
======================= */
.bg-gradient {
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
}

.navbar {
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
}

.navbar-brand {
	font-size: 1.5rem !important;
	transition: transform 0.3s ease !important;
}

.navbar-brand:hover {
	transform: scale(1.05) !important;
}

.navbar-brand i {
	font-size: 1.8rem !important;
}

.nav-link {
	border-radius: 8px !important;
	margin: 0 4px !important;
	transition: all 0.3s ease !important;
	color: #fff !important;
}

.nav-link:hover {
	background-color: rgba(255, 255, 255, 0.1) !important;
	transform: translateY(-2px) !important;
}

.nav-link.active {
	background-color: rgba(255, 255, 255, 0.25) !important;
	font-weight: 600 !important;
}

.btn-user {
	background-color: rgba(255, 255, 255, 0.2) !important;
	border: none !important;
	color: #fff !important;
	border-radius: 25px !important;
	padding: 8px 16px !important;
	transition: all 0.3s ease !important;
}

.btn-user:hover {
	background-color: rgba(255, 255, 255, 0.35) !important;
	transform: translateY(-2px) !important;
}

.btn-user i {
	font-size: 1.5rem !important;
}

/* =======================
   Card Styles
======================= */
.card {
	border: none !important;
	border-radius: 12px !important;
	transition: transform 0.3s ease, box-shadow 0.3s ease !important;
}

.card:hover {
	transform: translateY(-2px) !important;
	box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15) !important;
}

.card-header {
	border-radius: 12px 12px 0 0 !important;
	border: none !important;
}

/* =======================
   Title Card
======================= */
.title-card {
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
	color: white !important;
}

.title-card h4 {
	color: white !important;
}

/* =======================
   Controls Card
======================= */
.controls-card {
	background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%) !important;
}

/* =======================
   Post Card
======================= */
.post-card {
	transition: all 0.3s ease !important;
	animation: fadeInUp 0.5s ease !important;
}

.post-card:hover {
	transform: translateY(-4px) !important;
	box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2) !important;
}

@keyframes fadeInUp {
	from {
		opacity: 0;
		transform: translateY(20px);
	}
	to {
		opacity: 1;
		transform: translateY(0);
	}
}

.post-avatar {
	font-size: 2.5rem !important;
	color: #667eea !important;
}

.post-title {
	font-size: 1.25rem !important;
	font-weight: 700 !important;
	color: #2d3748 !important;
	margin-bottom: 0.5rem !important;
}

.post-content {
	color: #4a5568 !important;
	line-height: 1.6 !important;
	margin-bottom: 1rem !important;
}

.post-media img,
.post-media video {
	max-height: 400px !important;
	object-fit: cover !important;
	border-radius: 8px !important;
}

.rating-display i {
	font-size: 1.1rem !important;
}

/* =======================
   Search Card
======================= */
.search-card {
	z-index: 1000 !important;
}

.search-card .input-group {
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
	border-radius: 8px !important;
	overflow: hidden !important;
}

.search-card .form-control {
	border: none !important;
	padding: 12px 16px !important;
}

.search-card .form-control:focus {
	box-shadow: none !important;
}

.search-card .btn-primary {
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
	border: none !important;
	padding: 12px 20px !important;
}

.search-card .btn-primary:hover {
	opacity: 0.9 !important;
}

/* =======================
   Footer
======================= */
.footer {
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
	color: white !important;
	padding: 20px 0 !important;
	margin-top: auto !important;
}

/* =======================
   Modal
======================= */
.modal-content {
	border-radius: 16px !important;
	border: none !important;
}

.modal-header {
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
	color: white !important;
	border-radius: 16px 16px 0 0 !important;
}

.modal-header .btn-close,
.modal-header .btn-close-white {
	filter: brightness(0) invert(1) !important;
}

/* =======================
   Badge
======================= */
.badge {
	padding: 6px 12px !important;
	border-radius: 20px !important;
	font-weight: 500 !important;
}

/* =======================
   Pagination Styles
======================= */
.pagination {
	margin-bottom: 0 !important;
}

.page-link {
	color: #667eea !important;
	border: 1px solid #e2e8f0 !important;
	padding: 8px 16px !important;
	margin: 0 4px !important;
	border-radius: 8px !important;
	transition: all 0.3s ease !important;
	font-weight: 500 !important;
}

.page-link:hover {
	background-color: #f8f9fa !important;
	border-color: #667eea !important;
	transform: translateY(-2px) !important;
	box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3) !important;
}

.page-item.active .page-link {
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
	border-color: #667eea !important;
	color: white !important;
	box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4) !important;
}

.page-item.disabled .page-link {
	color: #cbd5e0 !important;
	background-color: #f8f9fa !important;
	border-color: #e2e8f0 !important;
	cursor: not-allowed !important;
}

.page-item:first-child .page-link {
	border-radius: 8px !important;
}

.page-item:last-child .page-link {
	border-radius: 8px !important;
}

/* =======================
   Dropdown Menu
======================= */
.dropdown-menu {
	border: none !important;
	box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
	border-radius: 12px !important;
	margin-top: 0.5rem !important;
	z-index: 1050 !important;
}

.dropdown-item {
	padding: 10px 20px !important;
	transition: all 0.3s ease !important;
}

.dropdown-item:hover {
	background-color: #f8f9fa !important;
	padding-left: 25px !important;
}

.dropdown-item i {
	width: 20px !important;
}

/* =======================
   Alert
======================= */
.alert {
	border-radius: 12px !important;
	border: none !important;
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
}

/* =======================
   Buttons
======================= */
.btn-primary {
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
	border: none !important;
	border-radius: 8px !important;
	padding: 10px 20px !important;
	font-weight: 500 !important;
	transition: all 0.3s ease !important;
}

.btn-primary:hover {
	opacity: 0.9 !important;
	transform: translateY(-2px) !important;
	box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4) !important;
}

.btn-outline-secondary {
	border-radius: 8px !important;
	transition: all 0.3s ease !important;
}

.btn-outline-secondary:hover {
	transform: translateY(-2px) !important;
}

/* =======================
   Form Controls
======================= */
.form-select:focus,
.form-control:focus {
	border-color: #667eea !important;
	box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25) !important;
}

.form-label {
	font-weight: 500 !important;
	color: #2d3748 !important;
}

/* =======================
   Scrollbar
======================= */
::-webkit-scrollbar {
	width: 8px !important;
	height: 8px !important;
}

::-webkit-scrollbar-track {
	background: #f1f1f1 !important;
}

::-webkit-scrollbar-thumb {
	background: #888 !important;
	border-radius: 4px !important;
}

::-webkit-scrollbar-thumb:hover {
	background: #555 !important;
}

/* =======================
   Spinner
======================= */
.spinner-border {
	width: 3rem !important;
	height: 3rem !important;
}

/* =======================
   Empty State
======================= */
.bi-inbox {
	opacity: 0.3 !important;
}

/* =======================
   Alert Container (Updated)
======================= */
/* Alert Container - Auto dismiss */
.alert-container {
	position: fixed !important;
	top: 80px !important;
	left: 50% !important;
	transform: translateX(-50%) !important;
	z-index: 9999 !important;
	width: 90% !important;
	max-width: 600px !important;
}

.alert-container .alert {
	border: none !important;
	border-radius: 12px !important;
	box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
	padding: 1rem 1.5rem !important;
	font-weight: 500 !important;
	opacity: 0 !important;
	transform: translateY(-20px) !important;
	transition: all 0.3s ease !important;
}

.alert-container .alert.show {
	opacity: 1 !important;
	transform: translateY(0) !important;
}

.alert-container .alert-success {
	background-color: #d4edda !important;
	color: #155724 !important;
	border-left: 4px solid #28a745 !important;
}

.alert-container .alert-success i {
	color: #28a745 !important;
}

.alert-container .alert-danger {
	background-color: #f8d7da !important;
	color: #721c24 !important;
	border-left: 4px solid #dc3545 !important;
}

.alert-container .alert-danger i {
	color: #dc3545 !important;
}

/* =======================
   Upload File Styles
======================= */
.upload-container {
	border: 2px dashed #e2e8f0 !important;
	border-radius: 12px !important;
	padding: 1.5rem !important;
	text-align: center !important;
	background-color: #f8f9fa !important;
	transition: all 0.3s ease !important;
}

.upload-container:hover {
	border-color: #667eea !important;
	background-color: #f0f2ff !important;
}

.btn-upload {
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
	color: white !important;
	border: none !important;
	padding: 10px 24px !important;
	border-radius: 8px !important;
	font-weight: 600 !important;
	transition: all 0.3s ease !important;
	box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3) !important;
}

.btn-upload:hover {
	transform: translateY(-2px) !important;
	box-shadow: 0 4px 12px rgba(102, 126, 234, 0.5) !important;
}

.file-status {
	display: flex !important;
	align-items: center !important;
	justify-content: center !important;
	gap: 8px !important;
	font-size: 0.95rem !important;
	font-weight: 500 !important;
	padding: 8px !important;
}

.file-status i {
	font-size: 1.2rem !important;
}

.file-preview {
	max-width: 100% !important;
	border-radius: 12px !important;
	overflow: hidden !important;
	box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;
}

/* Spinner for loading */
.spinner-border-sm {
	width: 1rem !important;
	height: 1rem !important;
	border-width: 0.15em !important;
}

/* Remove file button */
.btn-sm.btn-danger {
	padding: 6px 12px !important;
	font-size: 0.875rem !important;
	border-radius: 6px !important;
}

/* =======================
   Responsive
======================= */
@media (max-width: 991px) {
	.search-card {
		position: static !important;
	}
}

@media (max-width: 767px) {
	.navbar-brand {
		font-size: 1.2rem !important;
	}
	.post-card {
		margin-bottom: 1rem !important;
	}
	.post-title {
		font-size: 1.1rem !important;
	}
	.post-content {
		font-size: 0.9rem !important;
	}
}

@media (max-width: 576px) {
	.card-body {
		padding: 1rem !important;
	}
	.navbar-brand i {
		font-size: 1.5rem !important;
	}
	.btn-user i {
		font-size: 1.3rem !important;
	}
	.post-avatar {
		font-size: 2rem !important;
	}
	.modal-dialog {
		margin: 0.5rem !important;
	}
}

/* =======================
   Modal Body & Footer Fix
======================= */
.modal-body {
	padding: 1.5rem !important;
	max-height: calc(100vh - 250px) !important;
	overflow-y: auto !important;
}

.modal-footer {
	padding: 1rem 1.5rem !important;
	border-top: 1px solid #e9ecef !important;
	background-color: #f8f9fa !important;
}

.modal-dialog-scrollable .modal-body {
	max-height: calc(100vh - 250px) !important;
}

.modal-dialog-scrollable .modal-content {
	max-height: calc(100vh - 60px) !important;
}

/* =======================
   Button Styles in Modal
======================= */
.modal-footer .btn {
	min-width: 100px !important;
	padding: 10px 20px !important;
	font-weight: 500 !important;
}

.modal-footer .btn-secondary {
	background-color: #6c757d !important;
	border: none !important;
	color: white !important;
}

.modal-footer .btn-secondary:hover {
	background-color: #5a6268 !important;
}

.modal-footer .btn-primary {
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
	border: none !important;
	color: white !important;
}

.modal-footer .btn-primary:hover {
	opacity: 0.9 !important;
	transform: translateY(-1px) !important;
}
- CommentPage.jsp:
<%@page import="Modal.BinhLuan.BinhLuanBO"%>
<%@page import="java.text.SimpleDateFormat"%>
<%@page import="Modal.BinhLuan.BinhLuan"%>
<%@page import="Modal.BaiViet.BaiViet"%>
<%@page import="java.util.ArrayList"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Website Forum</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
	<link rel="stylesheet" href="${pageContext.request.contextPath}/pages/comment_page/style.css">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
	<%
		String quyen = (String) session.getAttribute("quyen");
		String account = (String) session.getAttribute("account");
		boolean isAdmin = "Admin".equals(quyen);
		
		ArrayList<BinhLuan> dsBinhLuan = (ArrayList<BinhLuan>) request.getAttribute("dsBinhLuan");
		ArrayList<BaiViet> dsBaiViet = (ArrayList<BaiViet>) request.getAttribute("dsBaiViet");
		
		String searchKey = (String) request.getAttribute("searchKey");
		String message = (String) request.getAttribute("message");
		String messageType = (String) request.getAttribute("messageType");
		
		// Phân trang
		Integer currentPage = (Integer) request.getAttribute("currentPage");
		Integer totalPages = (Integer) request.getAttribute("totalPages");
		Integer totalItems = (Integer) request.getAttribute("totalItems");
		Integer startIndex = (Integer) request.getAttribute("startIndex");
		
		if(currentPage == null) currentPage = 1;
		if(totalPages == null) totalPages = 0;
		if(totalItems == null) totalItems = 0;
		if(startIndex == null) startIndex = 0;
		
		SimpleDateFormat sdf = new SimpleDateFormat("dd/MM/yyyy HH:mm:ss");
	%>

	<!-- Navbar -->
	<nav class="navbar navbar-expand-lg navbar-dark bg-gradient sticky-top">
		<div class="container-fluid">
			<!-- Logo -->
			<a class="navbar-brand d-none d-lg-flex align-items-center" href="${pageContext.request.contextPath}/TrangChuController">
				<i class="bi bi-chat-dots-fill me-2"></i>
				<span class="fw-bold">Forum</span>
			</a>

			<!-- Mobile Toggle -->
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
				<span class="navbar-toggler-icon"></span>
			</button>

			<!-- Nav Links -->
			<div class="collapse navbar-collapse" id="navbarContent">
				<ul class="navbar-nav me-auto">
					<li class="nav-item">
						<a class="nav-link" href="${pageContext.request.contextPath}/TrangChuController">
							<i class="bi bi-house-fill me-1"></i>Trang chủ
						</a>
					</li>
					<% if(isAdmin) { %>
					<li class="nav-item">
						<a class="nav-link" href="${pageContext.request.contextPath}/TaiKhoanController">
							<i class="bi bi-tags-fill me-1"></i>Tài khoản
						</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="${pageContext.request.contextPath}/TheLoaiController">
							<i class="bi bi-tags-fill me-1"></i>Thể loại
						</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="${pageContext.request.contextPath}/BaiVietController">
							<i class="bi bi-file-text-fill me-1"></i>Bài viết
						</a>
					</li>
					<li class="nav-item">
						<a class="nav-link active" href="${pageContext.request.contextPath}/BinhLuanController">
							<i class="bi bi-chat-left-text-fill me-1"></i>Bình luận
						</a>
					</li>
					<% } %>
					<li class="nav-item">
						<a class="nav-link" href="${pageContext.request.contextPath}/BaiVietCuaToiController">
							<i class="bi bi-journal-text me-1"></i>Bài viết của tôi
						</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="${pageContext.request.contextPath}/BinhLuanCuaToiController">
							<i class="bi bi-chat-square-dots me-1"></i>Bình luận của tôi
						</a>
					</li>
				</ul>

				<!-- User Menu -->
				<div class="dropdown">
					<button class="btn btn-user dropdown-toggle" type="button" data-bs-toggle="dropdown">
						<i class="bi bi-person-circle"></i>
						<span class="ms-2 d-none d-lg-inline"><%= account %></span>
					</button>
					<ul class="dropdown-menu dropdown-menu-end">
						<li><a class="dropdown-item" href="${pageContext.request.contextPath}/ThongTinCaNhanController">
							<i class="bi bi-person-fill me-2"></i>Thông tin cá nhân
						</a></li>
						<li><hr class="dropdown-divider"></li>
						<li><a class="dropdown-item text-danger" href="${pageContext.request.contextPath}/DangXuatController">
							<i class="bi bi-box-arrow-right me-2"></i>Đăng xuất
						</a></li>
					</ul>
				</div>
			</div>
		</div>
	</nav>

	<!-- Main Content -->
	<div class="container mt-5">
		<!-- Page Title -->
		<div class="text-center mb-4">
			<h1 class="page-title">
				<i class="bi bi-chat-left-text-fill me-2"></i>Danh sách Bình luận
			</h1>
		</div>

		<!-- Message Alert -->
		<div id="messageAlert" class="alert-container" style="display: none;">
			<div class="alert alert-dismissible fade" role="alert">
				<i class="bi bi-check-circle-fill me-2"></i>
				<span id="messageText"></span>
			</div>
		</div>

		<!-- Search Bar -->
		<div class="row mb-4">
			<div class="col-lg-4 col-md-6 ms-auto">
				<div class="search-box">
					<input type="text" class="form-control" id="searchInput" 
						   placeholder="Tìm kiếm bình luận..." 
						   value="<%= searchKey != null ? searchKey : "" %>"
						   onkeyup="handleSearch()">
					<i class="bi bi-search search-icon"></i>
				</div>
			</div>
		</div>

		<!-- Comment Table or Empty State -->
		<div class="card shadow-sm table-card">
			<div class="card-body">
				<% if(dsBinhLuan == null || dsBinhLuan.isEmpty()) { %>
					<div class="empty-state text-center py-5">
						<i class="bi bi-inbox text-muted" style="font-size: 4rem;"></i>
						<h5 class="mt-3 text-muted">
							<% if(searchKey != null && !searchKey.trim().isEmpty()) { %>
								Không tìm thấy bình luận nào phù hợp
							<% } else { %>
								Chưa có bình luận nào
							<% } %>
						</h5>
					</div>
				<% } else { %>
					<div class="table-responsive">
						<table class="table table-hover align-middle">
							<thead class="table-header">
								<tr>
									<th width="8%" class="text-center">STT</th>
									<th width="42%">Nội dung</th>
									<th width="20%">Bài viết</th>
									<th width="12%" class="text-center">Trạng thái</th>
									<th width="18%" class="text-center">Thao tác</th>
								</tr>
							</thead>
							<tbody>
								<% 
									int stt = startIndex + 1;
									for(BinhLuan bl: dsBinhLuan) {
										String trangThaiVN = "";
										if("Active".equals(bl.getTrangThai())) trangThaiVN = "Hoạt động";
										else if("Deleted".equals(bl.getTrangThai())) trangThaiVN = "Đã xóa";
										else if("Hidden".equals(bl.getTrangThai())) trangThaiVN = "Ẩn";
										
										String noiDungDisplay = bl.getNoiDung();
										if(noiDungDisplay.length() > 60) {
											noiDungDisplay = noiDungDisplay.substring(0, 60) + "...";
										}
										
										// Tìm tên bài viết
										String tenBaiViet = "";
										if(dsBaiViet != null) {
											for(BaiViet bv : dsBaiViet) {
												if(bv.getMaBaiViet() == bl.getMaBaiViet()) {
													tenBaiViet = bv.getTieuDe();
													if(tenBaiViet.length() > 40) {
														tenBaiViet = tenBaiViet.substring(0, 40) + "...";
													}
													break;
												}
											}
										}
								%>
									<tr class="table-row" onclick="showDetailModal(<%= bl.getMaBinhLuan() %>)">
										<td class="text-center fw-bold"><%= stt++ %></td>
										<td><%= noiDungDisplay %></td>
										<td><%= tenBaiViet %></td>
										<td class="text-center">
											<span class="badge <%= "Active".equals(bl.getTrangThai()) ? "bg-success" : ("Deleted".equals(bl.getTrangThai()) ? "bg-danger" : "bg-warning") %>">
												<%= trangThaiVN %>
											</span>
										</td>
										<td class="text-center" onclick="event.stopPropagation()">
											<button class="btn btn-sm btn-edit me-2" 
													onclick="showEditModal(<%= bl.getMaBinhLuan() %>)">
												<i class="bi bi-pencil-fill me-1"></i>Sửa
											</button>
											<button class="btn btn-sm btn-delete" 
													onclick="showDeleteModal(<%= bl.getMaBinhLuan() %>, '<%= noiDungDisplay.replace("'", "\\'").replace("\"", "&quot;") %>')">
												<i class="bi bi-trash-fill me-1"></i>Xóa
											</button>
										</td>
									</tr>
								<% } %>
							</tbody>
						</table>
					</div>
					
					<!-- Pagination -->
					<% if(totalPages > 1) { %>
						<nav aria-label="Page navigation" class="mt-4">
							<ul class="pagination justify-content-center">
								<li class="page-item <%= currentPage == 1 ? "disabled" : "" %>">
									<a class="page-link" href="<%= currentPage > 1 ? buildPaginationUrl(request, currentPage - 1) : "#" %>" aria-label="Previous">
										<span aria-hidden="true">&laquo;</span>
									</a>
								</li>
								
								<%
									int startPage = Math.max(1, currentPage - 2);
									int endPage = Math.min(totalPages, currentPage + 2);
									
									if(currentPage <= 3) {
										endPage = Math.min(5, totalPages);
									}
									
									if(currentPage >= totalPages - 2) {
										startPage = Math.max(1, totalPages - 4);
									}
									
									if(startPage > 1) {
								%>
										<li class="page-item">
											<a class="page-link" href="<%= buildPaginationUrl(request, 1) %>">1</a>
										</li>
										<% if(startPage > 2) { %>
											<li class="page-item disabled">
												<span class="page-link">...</span>
											</li>
										<% } %>
								<%
									}
									
									for(int i = startPage; i <= endPage; i++) {
								%>
										<li class="page-item <%= i == currentPage ? "active" : "" %>">
											<a class="page-link" href="<%= buildPaginationUrl(request, i) %>"><%= i %></a>
										</li>
								<%
									}
									
									if(endPage < totalPages) {
										if(endPage < totalPages - 1) {
								%>
											<li class="page-item disabled">
												<span class="page-link">...</span>
											</li>
								<%
										}
								%>
										<li class="page-item">
											<a class="page-link" href="<%= buildPaginationUrl(request, totalPages) %>"><%= totalPages %></a>
										</li>
								<%
									}
								%>
								
								<li class="page-item <%= currentPage == totalPages ? "disabled" : "" %>">
									<a class="page-link" href="<%= currentPage < totalPages ? buildPaginationUrl(request, currentPage + 1) : "#" %>" aria-label="Next">
										<span aria-hidden="true">&raquo;</span>
									</a>
								</li>
							</ul>
						</nav>
						
						<div class="text-center text-muted mt-2">
							<small>
								Trang <%= currentPage %> / <%= totalPages %> 
								(Tổng <%= totalItems %> bình luận)
							</small>
						</div>
					<% } %>
				<% } %>
			</div>
		</div>

		<!-- Add Button -->
		<div class="text-center mt-4 mb-5">
			<button class="btn btn-add" onclick="showAddModal()">
				<i class="bi bi-plus-circle-fill me-2"></i>Thêm bình luận
			</button>
		</div>
	</div>

	<%!
		private String buildPaginationUrl(HttpServletRequest request, int page) {
			String contextPath = request.getContextPath();
			String searchKey = request.getParameter("search");
			
			StringBuilder url = new StringBuilder(contextPath + "/BinhLuanController?page=" + page);
			
			if(searchKey != null && !searchKey.trim().isEmpty()) {
				try {
					url.append("&search=").append(java.net.URLEncoder.encode(searchKey, "UTF-8"));
				} catch(Exception e) {
					e.printStackTrace();
				}
			}
			
			return url.toString();
		}
	%>

	<!-- Footer -->
	<footer class="footer mt-5">
		<div class="container text-center">
			<p class="mb-0">&copy; 2025 Website Forum. All rights reserved.</p>
		</div>
	</footer>

	<!-- Detail Modal -->
	<div class="modal fade" id="detailModal" tabindex="-1">
		<div class="modal-dialog modal-lg modal-dialog-scrollable">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title"><i class="bi bi-info-circle-fill me-2"></i>Chi tiết bình luận</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body" id="detailContent">
					<div class="text-center py-5">
						<div class="spinner-border text-primary" role="status"></div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Add Modal -->
	<div class="modal fade" id="addModal" tabindex="-1">
		<div class="modal-dialog modal-lg modal-dialog-scrollable">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">
						<i class="bi bi-plus-circle-fill me-2"></i>Thêm bình luận
					</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
				<form id="addForm" action="${pageContext.request.contextPath}/XuLyBinhLuanController" method="post" enctype="multipart/form-data">
					<input type="hidden" name="action" value="create">
					<input type="hidden" id="addUrlHidden" name="url" value="">
					<div class="modal-body">
						<div id="addError" class="alert alert-danger" style="display: none;">
							<i class="bi bi-x-circle-fill me-2"></i>
							<span id="addErrorText"></span>
						</div>
						
						<div class="mb-3">
							<label for="addNoiDung" class="form-label fw-bold">
								Nội dung <span class="text-danger">*</span>
							</label>
							<textarea class="form-control" id="addNoiDung" name="noiDung" 
									  rows="6" onkeyup="validateAddForm()" required></textarea>
							<div class="invalid-feedback" id="addNoiDungError"></div>
						</div>
	
						<!-- Upload File Section -->
						<div class="mb-3">
							<label class="form-label fw-bold">Ảnh/Video</label>
							<div class="upload-container">
								<input type="file" id="addFileInput" accept="image/*,video/*" 
									   style="display: none;">
								<button type="button" class="btn btn-upload" onclick="document.getElementById('addFileInput').click()">
									<i class="bi bi-cloud-upload me-2"></i>Tải ảnh/video lên
								</button>
								<div class="file-status mt-2">
									<i class="bi bi-file-earmark"></i>
									<span id="addFileStatus" class="text-muted">Chưa có ảnh/video</span>
								</div>
								<div id="addFilePreview" class="file-preview mt-3" style="display: none;"></div>
							</div>
							<small class="text-muted">
								Hỗ trợ: .jpg, .jpeg, .png, .gif, .webp (ảnh), .mp4, .webm, .ogg (video) - Tối đa 50MB
							</small>
						</div>
	
						<div class="mb-3">
							<label for="addMaBaiViet" class="form-label fw-bold">
								Bài viết <span class="text-danger">*</span>
							</label>
							<select class="form-select" id="addMaBaiViet" name="maBaiViet" 
									onchange="validateAddForm()" required>
								<option value="">-- Chọn bài viết --</option>
								<% if(dsBaiViet != null && !dsBaiViet.isEmpty()) {
									for(BaiViet bv : dsBaiViet) { %>
										<option value="<%= bv.getMaBaiViet() %>"><%= bv.getTieuDe() %></option>
								<% }
								} %>
							</select>
							<div class="invalid-feedback" id="addMaBaiVietError"></div>
						</div>
					</div>
					<div class="modal-footer sticky-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
							<i class="bi bi-x-circle me-1"></i>Hủy
						</button>
						<button type="submit" class="btn btn-primary" id="addSubmitBtn">
							<i class="bi bi-check-circle me-1"></i>Thêm
						</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	<!-- Edit Modal -->
	<div class="modal fade" id="editModal" tabindex="-1">
		<div class="modal-dialog modal-lg modal-dialog-scrollable">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">
						<i class="bi bi-pencil-fill me-2"></i>Sửa bình luận
					</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
				<form id="editForm" action="${pageContext.request.contextPath}/XuLyBinhLuanController" method="post" enctype="multipart/form-data">
					<input type="hidden" name="action" value="update">
					<input type="hidden" id="editMaBinhLuan" name="maBinhLuan">
					<input type="hidden" id="editUrlHidden" name="url" value="">
					<input type="hidden" id="editKeepOldFile" name="keepOldFile" value="false">
					<div class="modal-body">
						<div id="editError" class="alert alert-danger" style="display: none;">
							<i class="bi bi-x-circle-fill me-2"></i>
							<span id="editErrorText"></span>
						</div>
						
						<div class="mb-3">
							<label for="editNoiDung" class="form-label fw-bold">
								Nội dung <span class="text-danger">*</span>
							</label>
							<textarea class="form-control" id="editNoiDung" name="noiDung" 
									  rows="6" onkeyup="validateEditForm()" required></textarea>
							<div class="invalid-feedback" id="editNoiDungError"></div>
						</div>
	
						<!-- Upload File Section -->
						<div class="mb-3">
							<label class="form-label fw-bold">Ảnh/Video</label>
							<div class="upload-container">
								<input type="file" id="editFileInput" accept="image/*,video/*" 
									   style="display: none;">
								<button type="button" class="btn btn-upload" onclick="document.getElementById('editFileInput').click()">
									<i class="bi bi-cloud-upload me-2"></i>Tải ảnh/video lên
								</button>
								<div class="file-status mt-2">
									<i class="bi bi-file-earmark"></i>
									<span id="editFileStatus" class="text-muted">Chưa có ảnh/video</span>
								</div>
								<div id="editFilePreview" class="file-preview mt-3" style="display: none;"></div>
								<button type="button" class="btn btn-sm btn-danger mt-2" id="editRemoveFileBtn" 
										style="display: none;" onclick="removeEditFile()">
									<i class="bi bi-trash me-1"></i>Xóa file
								</button>
							</div>
							<small class="text-muted">
								Hỗ trợ: .jpg, .jpeg, .png, .gif, .webp (ảnh), .mp4, .webm, .ogg (video) - Tối đa 50MB
							</small>
						</div>
	
						<div class="mb-3">
							<label for="editSoLuotThich" class="form-label fw-bold">Số lượt thích</label>
							<input type="number" class="form-control" id="editSoLuotThich" 
								   name="soLuotThich" min="0" placeholder="0">
							<small class="text-muted">Để trống nếu không thay đổi</small>
						</div>
	
						<div class="mb-3">
							<label for="editTrangThai" class="form-label fw-bold">
								Trạng thái <span class="text-danger">*</span>
							</label>
							<select class="form-select" id="editTrangThai" name="trangThai" required>
								<option value="Active">Hoạt động</option>
								<option value="Hidden">Ẩn</option>
								<option value="Deleted">Đã xóa</option>
							</select>
						</div>
					</div>
					<div class="modal-footer sticky-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
							<i class="bi bi-x-circle me-1"></i>Hủy
						</button>
						<button type="submit" class="btn btn-primary" id="editSubmitBtn">
							<i class="bi bi-check-circle me-1"></i>Cập nhật
						</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	<!-- Delete Modal -->
	<div class="modal fade" id="deleteModal" tabindex="-1">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header bg-danger text-white">
					<h5 class="modal-title">
						<i class="bi bi-exclamation-triangle-fill me-2"></i>Xác nhận xóa
					</h5>
					<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
				</div>
				<form action="${pageContext.request.contextPath}/XuLyBinhLuanController" method="post">
					<input type="hidden" name="action" value="delete">
					<input type="hidden" id="deleteMaBinhLuan" name="maBinhLuan">
					<div class="modal-body">
						<p class="mb-0">Bạn có chắc chắn muốn xóa bình luận <strong id="deleteNoiDung"></strong>?</p>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
							<i class="bi bi-x-circle me-1"></i>Không
						</button>
						<button type="submit" class="btn btn-danger">
							<i class="bi bi-check-circle me-1"></i>Có
						</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	<!-- Hidden data for detail modal -->
	<div id="commentData" style="display: none;">
		<%
			if(dsBinhLuan != null && !dsBinhLuan.isEmpty()) {
				for(BinhLuan bl : dsBinhLuan) {
					// Tìm tên bài viết
					String tenBaiViet = "";
					if(dsBaiViet != null) {
						for(BaiViet bv : dsBaiViet) {
							if(bv.getMaBaiViet() == bl.getMaBaiViet()) {
								tenBaiViet = bv.getTieuDe();
								if(tenBaiViet.length() > 40) {
									tenBaiViet = tenBaiViet.substring(0, 40) + "...";
								}
								break;
							}
						}
					}
					
					String trangThaiVN = "";
					if("Active".equals(bl.getTrangThai())) trangThaiVN = "Hoạt động";
					else if("Deleted".equals(bl.getTrangThai())) trangThaiVN = "Đã xóa";
					else if("Hidden".equals(bl.getTrangThai())) trangThaiVN = "Ẩn";
		%>
			<div class="comment-data-item" data-id="<%= bl.getMaBinhLuan() %>"
				 data-tieude="<%= bl.getTieuDe() != null ? bl.getTieuDe() : "" %>"
				 data-noidung="<%= bl.getNoiDung().replace("\"", "&quot;") %>"
				 data-url="<%= bl.getUrl() != null ? bl.getUrl() : "" %>"
				 data-taikhoantao="<%= bl.getTaiKhoanTao() %>"
				 data-mabaiviet="<%= bl.getMaBaiViet() %>"
				 data-tenbaiviet="<%= tenBaiViet %>"
				 data-soluotthich="<%= bl.getSoLuotThich() %>"
				 data-trangthai="<%= bl.getTrangThai() %>"
				 data-trangthaiVN="<%= trangThaiVN %>"
				 data-thoidiemtao="<%= bl.getThoiDiemTao() != null ? sdf.format(bl.getThoiDiemTao()) : "" %>"
				 data-thoidiemcapnhat="<%= bl.getThoiDiemCapNhat() != null ? sdf.format(bl.getThoiDiemCapNhat()) : "" %>">
			</div>
		<%
				}
			}
		%>
	</div>

	<script src="${pageContext.request.contextPath}/pages/comment_page/script.js"></script>
	<script>
		<% if(message != null && messageType != null) { 
			String escapedMessage = message.replace("\\", "\\\\").replace("'", "\\'").replace("\n", "\\n").replace("\r", "\\r");
		%>
			document.addEventListener('DOMContentLoaded', function() {
				setTimeout(function() {
					showMessage('<%= escapedMessage %>', '<%= messageType %>');
				}, 100);
			});
		<% } %>
	</script>
</body>
</html>
- script.js (Của CommentPage):
// Đợi DOM load xong
document.addEventListener('DOMContentLoaded', function() {
	// Initialize tooltips
	var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
	var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
		return new bootstrap.Tooltip(tooltipTriggerEl);
	});
});

// Handle real-time search
let searchTimeout;
function handleSearch() {
	const searchInput = document.getElementById('searchInput');
	const searchValue = searchInput.value.trim();
	
	// Clear previous timeout
	clearTimeout(searchTimeout);
	
	// Set new timeout for search (debounce)
	searchTimeout = setTimeout(() => {
		const contextPath = window.location.pathname.split('/')[1];
		let url = '/' + contextPath + '/BinhLuanController';
		
		if(searchValue) {
			url += '?search=' + encodeURIComponent(searchValue);
		}
		
		window.location.href = url;
	}, 300); // Wait 300ms after user stops typing
}

// Show message alert
function showMessage(message, type) {
	const alertContainer = document.getElementById('messageAlert');
	const messageText = document.getElementById('messageText');
	const alert = alertContainer.querySelector('.alert');
	const icon = alert.querySelector('i');
	
	// Set message text
	messageText.textContent = message;
	
	// Set alert type
	alert.className = 'alert alert-dismissible fade show';
	if(type === 'success') {
		alert.classList.add('alert-success');
		icon.className = 'bi bi-check-circle-fill me-2';
	} else {
		alert.classList.add('alert-danger');
		icon.className = 'bi bi-x-circle-fill me-2';
	}
	
	// Show alert
	alertContainer.style.display = 'block';
	
	// Auto hide after 3 seconds
	setTimeout(() => {
		alertContainer.style.display = 'none';
	}, 3000);
}

// Get comment data by ID
function getCommentData(maBinhLuan) {
	const commentItems = document.querySelectorAll('.comment-data-item');
	for(let item of commentItems) {
		if(item.getAttribute('data-id') == maBinhLuan) {
			return {
				maBinhLuan: item.getAttribute('data-id'),
				tieuDe: item.getAttribute('data-tieude'),
				noiDung: item.getAttribute('data-noidung'),
				url: item.getAttribute('data-url'),
				taiKhoanTao: item.getAttribute('data-taikhoantao'),
				maBaiViet: item.getAttribute('data-mabaiviet'),
				tenBaiViet: item.getAttribute('data-tenbaiviet'),
				soLuotThich: item.getAttribute('data-soluotthich'),
				trangThai: item.getAttribute('data-trangthai'),
				trangThaiVN: item.getAttribute('data-trangthaiVN'),
				thoiDiemTao: item.getAttribute('data-thoidiemtao'),
				thoiDiemCapNhat: item.getAttribute('data-thoidiemcapnhat')
			};
		}
	}
	return null;
}

// Show Detail Modal
function showDetailModal(maBinhLuan) {
	const modal = new bootstrap.Modal(document.getElementById('detailModal'));
	const content = document.getElementById('detailContent');
	
	// Get comment data
	const comment = getCommentData(maBinhLuan);
	
	if(!comment) {
		content.innerHTML = '<div class="alert alert-danger">Không tìm thấy thông tin bình luận</div>';
		modal.show();
		return;
	}
	
	// Build detail content
	let html = '<div class="detail-container">';
	
	// Tiêu đề (nếu có)
	if(comment.tieuDe && comment.tieuDe.trim() !== '') {
		html += '<div class="detail-item">';
		html += '<div class="detail-label"><i class="bi bi-card-heading"></i>Tiêu đề</div>';
		html += '<div class="detail-value">' + comment.tieuDe + '</div>';
		html += '</div>';
	}
	
	// Nội dung
	html += '<div class="detail-item">';
	html += '<div class="detail-label"><i class="bi bi-file-text"></i>Nội dung</div>';
	html += '<div class="detail-value">' + comment.noiDung.replace(/\n/g, '<br>') + '</div>';
	html += '</div>';
	
	// Ảnh/Video
	if(comment.url && comment.url.trim() !== '') {
		html += '<div class="detail-item">';
		html += '<div class="detail-label"><i class="bi bi-image"></i>Media</div>';
		html += '<div class="detail-media">';
		
		// Check if image
		if(comment.url.match(/\.(jpg|jpeg|png|gif|webp)$/i)) {
			html += '<img src="' + comment.url + '" alt="Comment image" class="img-fluid">';
		}
		// Check if video
		else if(comment.url.match(/\.(mp4|webm|ogg)$/i)) {
			html += '<video controls class="w-100">';
			html += '<source src="' + comment.url + '" type="video/mp4">';
			html += 'Trình duyệt không hỗ trợ video.';
			html += '</video>';
		}
		
		html += '</div>';
		html += '</div>';
	}
	
	// Tài khoản tạo
	html += '<div class="detail-item">';
	html += '<div class="detail-label"><i class="bi bi-person-fill"></i>Tác giả</div>';
	html += '<div class="detail-value">' + comment.taiKhoanTao + '</div>';
	html += '</div>';
	
	// Bài viết
	html += '<div class="detail-item">';
	html += '<div class="detail-label"><i class="bi bi-file-text-fill"></i>Bài viết</div>';
	html += '<div class="detail-value">' + comment.tenBaiViet + '</div>';
	html += '</div>';
	
	// Số lượt thích
	html += '<div class="detail-item">';
	html += '<div class="detail-label"><i class="bi bi-heart-fill"></i>Lượt thích</div>';
	html += '<div class="detail-value">';
	html += '<span class="badge bg-danger">' + comment.soLuotThich + ' <i class="bi bi-heart-fill ms-1"></i></span>';
	html += '</div>';
	html += '</div>';
	
	// Trạng thái
	html += '<div class="detail-item">';
	html += '<div class="detail-label"><i class="bi bi-info-circle-fill"></i>Trạng thái</div>';
	html += '<div class="detail-value">';
	let badgeClass = 'bg-success';
	if(comment.trangThai === 'Deleted') badgeClass = 'bg-danger';
	else if(comment.trangThai === 'Hidden') badgeClass = 'bg-warning';
	html += '<span class="badge ' + badgeClass + '">' + comment.trangThaiVN + '</span>';
	html += '</div>';
	html += '</div>';
	
	// Thời điểm tạo
	html += '<div class="detail-item">';
	html += '<div class="detail-label"><i class="bi bi-calendar-plus"></i>Thời điểm tạo</div>';
	html += '<div class="detail-value">' + (comment.thoiDiemTao || 'N/A') + '</div>';
	html += '</div>';
	
	// Thời điểm cập nhật
	html += '<div class="detail-item">';
	html += '<div class="detail-label"><i class="bi bi-calendar-check"></i>Thời điểm cập nhật</div>';
	html += '<div class="detail-value">' + (comment.thoiDiemCapNhat || 'Chưa cập nhật') + '</div>';
	html += '</div>';
	
	html += '</div>';
	
	content.innerHTML = html;
	modal.show();
}

// Show Add Modal
function showAddModal() {
	const modal = new bootstrap.Modal(document.getElementById('addModal'));
	const form = document.getElementById('addForm');
	const errorDiv = document.getElementById('addError');
	const submitBtn = document.getElementById('addSubmitBtn');
	
	// Reset form
	form.reset();
	
	// Reset validation
	document.querySelectorAll('#addForm .form-control, #addForm .form-select').forEach(el => {
		el.classList.remove('is-invalid');
	});
	document.querySelectorAll('#addForm .invalid-feedback').forEach(el => {
		el.textContent = '';
	});
	
	errorDiv.style.display = 'none';
	submitBtn.disabled = false;
	
	modal.show();
}

// Show Edit Modal
function showEditModal(maBinhLuan) {
	const modal = new bootstrap.Modal(document.getElementById('editModal'));
	const form = document.getElementById('editForm');
	const errorDiv = document.getElementById('editError');
	const submitBtn = document.getElementById('editSubmitBtn');
	
	// Get comment data
	const comment = getCommentData(maBinhLuan);
	
	if(!comment) {
		alert('Không tìm thấy thông tin bình luận');
		return;
	}
	
	// Set values
	document.getElementById('editMaBinhLuan').value = comment.maBinhLuan;
	document.getElementById('editNoiDung').value = comment.noiDung;
	document.getElementById('editUrl').value = comment.url || '';
	document.getElementById('editSoLuotThich').value = comment.soLuotThich || '';
	document.getElementById('editTrangThai').value = comment.trangThai;
	
	// Reset validation
	document.querySelectorAll('#editForm .form-control, #editForm .form-select').forEach(el => {
		el.classList.remove('is-invalid');
	});
	document.querySelectorAll('#editForm .invalid-feedback').forEach(el => {
		el.textContent = '';
	});
	
	errorDiv.style.display = 'none';
	submitBtn.disabled = false;
	
	modal.show();
}

// Show Delete Modal
function showDeleteModal(maBinhLuan, noiDung) {
	const modal = new bootstrap.Modal(document.getElementById('deleteModal'));
	
	document.getElementById('deleteMaBinhLuan').value = maBinhLuan;
	document.getElementById('deleteNoiDung').textContent = noiDung;
	
	modal.show();
}

// Validate Add Form
function validateAddForm() {
	const noiDung = document.getElementById('addNoiDung').value.trim();
	const maBaiViet = document.getElementById('addMaBaiViet').value;
	const submitBtn = document.getElementById('addSubmitBtn');
	
	let isValid = true;
	
	// Validate nội dung
	const noiDungInput = document.getElementById('addNoiDung');
	const noiDungError = document.getElementById('addNoiDungError');
	if(noiDung === '') {
		noiDungInput.classList.add('is-invalid');
		noiDungError.textContent = 'Nội dung không được để trống';
		isValid = false;
	} else {
		noiDungInput.classList.remove('is-invalid');
		noiDungError.textContent = '';
	}
	
	// Validate bài viết
	const maBaiVietSelect = document.getElementById('addMaBaiViet');
	const maBaiVietError = document.getElementById('addMaBaiVietError');
	if(!maBaiViet || maBaiViet === '') {
		maBaiVietSelect.classList.add('is-invalid');
		maBaiVietError.textContent = 'Vui lòng chọn bài viết';
		isValid = false;
	} else {
		maBaiVietSelect.classList.remove('is-invalid');
		maBaiVietError.textContent = '';
	}
	
	submitBtn.disabled = !isValid;
	return isValid;
}

// Validate Edit Form
function validateEditForm() {
	const noiDung = document.getElementById('editNoiDung').value.trim();
	const submitBtn = document.getElementById('editSubmitBtn');
	
	let isValid = true;
	
	// Validate nội dung
	const noiDungInput = document.getElementById('editNoiDung');
	const noiDungError = document.getElementById('editNoiDungError');
	if(noiDung === '') {
		noiDungInput.classList.add('is-invalid');
		noiDungError.textContent = 'Nội dung không được để trống';
		isValid = false;
	} else {
		noiDungInput.classList.remove('is-invalid');
		noiDungError.textContent = '';
	}
	
	submitBtn.disabled = !isValid;
	return isValid;
}

// Handle Add Form Submit
document.addEventListener('DOMContentLoaded', function() {
	const addForm = document.getElementById('addForm');
	if(addForm) {
		addForm.addEventListener('submit', function(e) {
			if(!validateAddForm()) {
				e.preventDefault();
				const errorDiv = document.getElementById('addError');
				const errorText = document.getElementById('addErrorText');
				errorText.textContent = 'Vui lòng kiểm tra lại các trường đã nhập!';
				errorDiv.style.display = 'block';
				
				setTimeout(() => {
					errorDiv.style.display = 'none';
				}, 3000);
			}
		});
	}
	
	const editForm = document.getElementById('editForm');
	if(editForm) {
		editForm.addEventListener('submit', function(e) {
			if(!validateEditForm()) {
				e.preventDefault();
				const errorDiv = document.getElementById('editError');
				const errorText = document.getElementById('editErrorText');
				errorText.textContent = 'Vui lòng kiểm tra lại các trường đã nhập!';
				errorDiv.style.display = 'block';
				
				setTimeout(() => {
					errorDiv.style.display = 'none';
				}, 3000);
			}
		});
	}
});

// Close modal on escape key
document.addEventListener('keydown', function(e) {
	if(e.key === 'Escape') {
		const modals = document.querySelectorAll('.modal.show');
		modals.forEach(modal => {
			const modalInstance = bootstrap.Modal.getInstance(modal);
			if(modalInstance) {
				modalInstance.hide();
			}
		});
	}
});

// Prevent duplicate form submission
let isSubmitting = false;
document.addEventListener('DOMContentLoaded', function() {
	const forms = document.querySelectorAll('form');
	forms.forEach(form => {
		form.addEventListener('submit', function(e) {
			if(isSubmitting) {
				e.preventDefault();
				return false;
			}
			isSubmitting = true;
			
			// Re-enable after 3 seconds (in case of error)
			setTimeout(() => {
				isSubmitting = false;
			}, 3000);
		});
	});
});

// ============================================
// UPLOAD FILE FUNCTIONALITY
// ============================================

// Global variables
let addUploadedFileUrl = '';
let editUploadedFileUrl = '';
let editOriginalFileUrl = '';

// Initialize upload listeners when DOM loaded
document.addEventListener('DOMContentLoaded', function() {
	// Add file input listener
	const addFileInput = document.getElementById('addFileInput');
	if(addFileInput) {
		addFileInput.addEventListener('change', handleAddFileSelect);
	}
	
	// Edit file input listener
	const editFileInput = document.getElementById('editFileInput');
	if(editFileInput) {
		editFileInput.addEventListener('change', handleEditFileSelect);
	}
});

// Handle Add File Select
function handleAddFileSelect(event) {
	const file = event.target.files[0];
	if (!file) return;
	
	console.log('File selected:', file.name, file.type, file.size);
	
	// Validate file type
	const validImageTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
	const validVideoTypes = ['video/mp4', 'video/webm', 'video/ogg'];
	const allValidTypes = [...validImageTypes, ...validVideoTypes];
	
	if (!allValidTypes.includes(file.type)) {
		alert('Định dạng file không được hỗ trợ! Vui lòng chọn file ảnh (.jpg, .png, .gif, .webp) hoặc video (.mp4, .webm, .ogg)');
		event.target.value = '';
		return;
	}
	
	// Validate file size (50MB)
	if (file.size > 50 * 1024 * 1024) {
		alert('Kích thước file quá lớn! Vui lòng chọn file nhỏ hơn 50MB');
		event.target.value = '';
		return;
	}
	
	// Update file status
	document.getElementById('addFileStatus').textContent = 'Đang chuẩn bị tải lên...';
	document.getElementById('addFileStatus').classList.remove('text-muted');
	document.getElementById('addFileStatus').classList.add('text-primary');
	
	// Show preview
	showAddFilePreview(file);
	
	// Upload file
	uploadAddFile(file);
}

// Upload Add File
function uploadAddFile(file) {
	const formData = new FormData();
	formData.append('file', file);
	
	const statusElement = document.getElementById('addFileStatus');
	statusElement.innerHTML = '<i class="spinner-border spinner-border-sm me-2"></i>Đang tải lên...';
	statusElement.classList.remove('text-success', 'text-danger', 'text-muted');
	statusElement.classList.add('text-primary');
	
	const contextPath = window.location.pathname.split('/')[1];
	
	fetch('/' + contextPath + '/UploadFileController', {
		method: 'POST',
		body: formData
	})
	.then(response => {
		console.log('Upload response status:', response.status);
		return response.json();
	})
	.then(data => {
		console.log('Upload response data:', data);
		if (data.success) {
			addUploadedFileUrl = data.url;
			document.getElementById('addUrlHidden').value = data.url;
			statusElement.textContent = data.fileName;
			statusElement.classList.remove('text-primary');
			statusElement.classList.add('text-success');
			console.log('Upload success! URL:', data.url);
		} else {
			throw new Error(data.message || 'Upload thất bại');
		}
	})
	.catch(error => {
		console.error('Upload error:', error);
		statusElement.textContent = 'Lỗi: ' + error.message;
		statusElement.classList.remove('text-primary');
		statusElement.classList.add('text-danger');
		document.getElementById('addFileInput').value = '';
		document.getElementById('addFilePreview').style.display = 'none';
		addUploadedFileUrl = '';
	});
}

// Show Add File Preview
function showAddFilePreview(file) {
	const preview = document.getElementById('addFilePreview');
	preview.innerHTML = '';
	preview.style.display = 'block';
	
	const reader = new FileReader();
	
	if (file.type.startsWith('image/')) {
		reader.onload = function(e) {
			const img = document.createElement('img');
			img.src = e.target.result;
			img.className = 'preview-image';
			img.style.maxWidth = '100%';
			img.style.maxHeight = '400px';
			img.style.objectFit = 'contain';
			img.style.borderRadius = '12px';
			preview.appendChild(img);
		};
		reader.readAsDataURL(file);
	} else if (file.type.startsWith('video/')) {
		reader.onload = function(e) {
			const video = document.createElement('video');
			video.src = e.target.result;
			video.controls = true;
			video.className = 'preview-video';
			video.style.width = '100%';
			video.style.maxHeight = '400px';
			video.style.borderRadius = '12px';
			preview.appendChild(video);
		};
		reader.readAsDataURL(file);
	}
}

// Handle Edit File Select
function handleEditFileSelect(event) {
	const file = event.target.files[0];
	if (!file) return;
	
	console.log('Edit file selected:', file.name, file.type, file.size);
	
	// Validate file type
	const validImageTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
	const validVideoTypes = ['video/mp4', 'video/webm', 'video/ogg'];
	const allValidTypes = [...validImageTypes, ...validVideoTypes];
	
	if (!allValidTypes.includes(file.type)) {
		alert('Định dạng file không được hỗ trợ! Vui lòng chọn file ảnh (.jpg, .png, .gif, .webp) hoặc video (.mp4, .webm, .ogg)');
		event.target.value = '';
		return;
	}
	
	// Validate file size (50MB)
	if (file.size > 50 * 1024 * 1024) {
		alert('Kích thước file quá lớn! Vui lòng chọn file nhỏ hơn 50MB');
		event.target.value = '';
		return;
	}
	
	// Update file status
	document.getElementById('editFileStatus').textContent = 'Đang chuẩn bị tải lên...';
	document.getElementById('editFileStatus').classList.remove('text-muted');
	document.getElementById('editFileStatus').classList.add('text-primary');
	
	// Show preview
	showEditFilePreview(file);
	
	// Show remove button
	document.getElementById('editRemoveFileBtn').style.display = 'inline-block';
	
	// Mark that we're uploading a new file
	document.getElementById('editKeepOldFile').value = 'false';
	
	// Upload file
	uploadEditFile(file);
}

// Upload Edit File
function uploadEditFile(file) {
	const formData = new FormData();
	formData.append('file', file);
	
	const statusElement = document.getElementById('editFileStatus');
	statusElement.innerHTML = '<i class="spinner-border spinner-border-sm me-2"></i>Đang tải lên...';
	statusElement.classList.remove('text-success', 'text-danger', 'text-muted');
	statusElement.classList.add('text-primary');
	
	const contextPath = window.location.pathname.split('/')[1];
	
	fetch('/' + contextPath + '/UploadFileController', {
		method: 'POST',
		body: formData
	})
	.then(response => {
		console.log('Edit upload response status:', response.status);
		return response.json();
	})
	.then(data => {
		console.log('Edit upload response data:', data);
		if (data.success) {
			editUploadedFileUrl = data.url;
			document.getElementById('editUrlHidden').value = data.url;
			statusElement.textContent = data.fileName;
			statusElement.classList.remove('text-primary');
			statusElement.classList.add('text-success');
			console.log('Edit upload success! URL:', data.url);
		} else {
			throw new Error(data.message || 'Upload thất bại');
		}
	})
	.catch(error => {
		console.error('Edit upload error:', error);
		statusElement.textContent = 'Lỗi: ' + error.message;
		statusElement.classList.remove('text-primary');
		statusElement.classList.add('text-danger');
		document.getElementById('editFileInput').value = '';
		document.getElementById('editFilePreview').style.display = 'none';
		editUploadedFileUrl = '';
	});
}

// Show Edit File Preview
function showEditFilePreview(file) {
	const preview = document.getElementById('editFilePreview');
	preview.innerHTML = '';
	preview.style.display = 'block';
	
	const reader = new FileReader();
	
	if (file.type.startsWith('image/')) {
		reader.onload = function(e) {
			const img = document.createElement('img');
			img.src = e.target.result;
			img.className = 'preview-image';
			img.style.maxWidth = '100%';
			img.style.maxHeight = '400px';
			img.style.objectFit = 'contain';
			img.style.borderRadius = '12px';
			preview.appendChild(img);
		};
		reader.readAsDataURL(file);
	} else if (file.type.startsWith('video/')) {
		reader.onload = function(e) {
			const video = document.createElement('video');
			video.src = e.target.result;
			video.controls = true;
			video.className = 'preview-video';
			video.style.width = '100%';
			video.style.maxHeight = '400px';
			video.style.borderRadius = '12px';
			preview.appendChild(video);
		};
		reader.readAsDataURL(file);
	}
}

// Remove Edit File
function removeEditFile() {
	document.getElementById('editFileInput').value = '';
	document.getElementById('editFileStatus').textContent = 'Chưa có ảnh/video';
	document.getElementById('editFileStatus').classList.remove('text-success');
	document.getElementById('editFileStatus').classList.add('text-muted');
	document.getElementById('editFilePreview').style.display = 'none';
	document.getElementById('editRemoveFileBtn').style.display = 'none';
	document.getElementById('editUrlHidden').value = '';
	document.getElementById('editKeepOldFile').value = 'false';
	editUploadedFileUrl = '';
}

// Override showAddModal để reset upload state
const originalShowAddModal = window.showAddModal;
window.showAddModal = function() {
	if(originalShowAddModal) {
		originalShowAddModal();
	}
	
	// Reset upload state
	addUploadedFileUrl = '';
	document.getElementById('addFileInput').value = '';
	document.getElementById('addFileStatus').textContent = 'Chưa có ảnh/video';
	document.getElementById('addFileStatus').classList.remove('text-success', 'text-primary');
	document.getElementById('addFileStatus').classList.add('text-muted');
	document.getElementById('addFilePreview').style.display = 'none';
	document.getElementById('addUrlHidden').value = '';
	console.log('Add modal opened, upload state reset');
};

// Override showEditModal để load file cũ
const originalShowEditModal = window.showEditModal;
window.showEditModal = function(maBinhLuan) {
	const comment = getCommentData(maBinhLuan);
	
	if (!comment) {
		alert('Không tìm thấy thông tin bình luận');
		return;
	}
	
	console.log('Opening edit modal for comment:', maBinhLuan, comment);
	
	// Call original
	const modal = new bootstrap.Modal(document.getElementById('editModal'));
	const form = document.getElementById('editForm');
	
	// Set values
	document.getElementById('editMaBinhLuan').value = comment.maBinhLuan;
	document.getElementById('editNoiDung').value = comment.noiDung;
	document.getElementById('editSoLuotThich').value = comment.soLuotThich || '';
	document.getElementById('editTrangThai').value = comment.trangThai;
	
	// Handle file
	editOriginalFileUrl = comment.url || '';
	editUploadedFileUrl = '';
	document.getElementById('editFileInput').value = '';
	document.getElementById('editUrlHidden').value = editOriginalFileUrl;
	document.getElementById('editKeepOldFile').value = 'true';
	
	const contextPath = window.location.pathname.split('/')[1];
	
	if (editOriginalFileUrl && editOriginalFileUrl.trim() !== '') {
		const fileName = editOriginalFileUrl.split('/').pop();
		document.getElementById('editFileStatus').textContent = fileName;
		document.getElementById('editFileStatus').classList.remove('text-muted');
		document.getElementById('editFileStatus').classList.add('text-success');
		
		const preview = document.getElementById('editFilePreview');
		preview.innerHTML = '';
		preview.style.display = 'block';
		
		const fullUrl = '/' + contextPath + '/' + editOriginalFileUrl;
		
		if (editOriginalFileUrl.match(/\.(jpg|jpeg|png|gif|webp)$/i)) {
			const img = document.createElement('img');
			img.src = fullUrl;
			img.className = 'preview-image';
			img.style.maxWidth = '100%';
			img.style.maxHeight = '400px';
			img.style.objectFit = 'contain';
			img.style.borderRadius = '12px';
			preview.appendChild(img);
		} else if (editOriginalFileUrl.match(/\.(mp4|webm|ogg)$/i)) {
			const video = document.createElement('video');
			video.src = fullUrl;
			video.controls = true;
			video.className = 'preview-video';
			video.style.width = '100%';
			video.style.maxHeight = '400px';
			video.style.borderRadius = '12px';
			preview.appendChild(video);
		}
		
		document.getElementById('editRemoveFileBtn').style.display = 'inline-block';
	} else {
		document.getElementById('editFileStatus').textContent = 'Chưa có ảnh/video';
		document.getElementById('editFileStatus').classList.remove('text-success');
		document.getElementById('editFileStatus').classList.add('text-muted');
		document.getElementById('editFilePreview').style.display = 'none';
		document.getElementById('editRemoveFileBtn').style.display = 'none';
	}
	
	// Reset validation
	document.querySelectorAll('#editForm .form-control, #editForm .form-select').forEach(el => {
		el.classList.remove('is-invalid');
	});
	document.querySelectorAll('#editForm .invalid-feedback').forEach(el => {
		el.textContent = '';
	});
	
	document.getElementById('editError').style.display = 'none';
	document.getElementById('editSubmitBtn').disabled = false;
	
	modal.show();
};
- style.css (Của CommentPage):
@charset "UTF-8";

/* =======================
   Global Styles
======================= */
* {
	margin: 0;
	padding: 0;
	box-sizing: border-box;
	transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease;
}

body {
	font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
	background-color: #f0f2f5 !important;
	min-height: 100vh !important;
	display: flex !important;
	flex-direction: column !important;
}

/* =======================
   Navbar Styles
======================= */
.bg-gradient {
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
}

.navbar {
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
}

.navbar-brand {
	font-size: 1.5rem !important;
	transition: transform 0.3s ease !important;
}

.navbar-brand:hover {
	transform: scale(1.05) !important;
}

.navbar-brand i {
	font-size: 1.8rem !important;
}

.nav-link {
	border-radius: 8px !important;
	margin: 0 4px !important;
	transition: all 0.3s ease !important;
	color: #fff !important;
}

.nav-link:hover {
	background-color: rgba(255, 255, 255, 0.1) !important;
	transform: translateY(-2px) !important;
}

.nav-link.active {
	background-color: rgba(255, 255, 255, 0.25) !important;
	font-weight: 600 !important;
}

.btn-user {
	background-color: rgba(255, 255, 255, 0.2) !important;
	border: none !important;
	color: #fff !important;
	border-radius: 25px !important;
	padding: 8px 16px !important;
	transition: all 0.3s ease !important;
}

.btn-user:hover {
	background-color: rgba(255, 255, 255, 0.35) !important;
	transform: translateY(-2px) !important;
}

.btn-user i {
	font-size: 1.5rem !important;
}

/* =======================
   Page Title
======================= */
.page-title {
	font-size: 2.5rem !important;
	font-weight: 700 !important;
	color: #2d3748 !important;
	text-align: center !important;
	margin-bottom: 2rem !important;
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
	-webkit-background-clip: text !important;
	-webkit-text-fill-color: transparent !important;
	background-clip: text !important;
}

/* =======================
   Alert Container
======================= */
.alert-container {
	position: fixed !important;
	top: 80px !important;
	left: 50% !important;
	transform: translateX(-50%) !important;
	z-index: 9999 !important;
	width: 90% !important;
	max-width: 600px !important;
}

.alert-container .alert {
	border: none !important;
	border-radius: 12px !important;
	box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
	padding: 1rem 1.5rem !important;
	font-weight: 500 !important;
	opacity: 0 !important;
	transform: translateY(-20px) !important;
	transition: all 0.3s ease !important;
}

.alert-container .alert.show {
	opacity: 1 !important;
	transform: translateY(0) !important;
}

.alert-container .alert-success {
	background-color: #d4edda !important;
	color: #155724 !important;
	border-left: 4px solid #28a745 !important;
}

.alert-container .alert-success i {
	color: #28a745 !important;
}

.alert-container .alert-danger {
	background-color: #f8d7da !important;
	color: #721c24 !important;
	border-left: 4px solid #dc3545 !important;
}

.alert-container .alert-danger i {
	color: #dc3545 !important;
}

/* =======================
   Search Box
======================= */
.search-box {
	position: relative !important;
}

.search-box .form-control {
	padding-left: 2.5rem !important;
	border-radius: 25px !important;
	border: 2px solid #e2e8f0 !important;
	transition: all 0.3s ease !important;
	box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05) !important;
}

.search-box .form-control:focus {
	border-color: #667eea !important;
	box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25) !important;
}

.search-icon {
	position: absolute !important;
	left: 1rem !important;
	top: 50% !important;
	transform: translateY(-50%) !important;
	color: #667eea !important;
	font-size: 1.2rem !important;
	pointer-events: none !important;
}

/* =======================
   Table Card
======================= */
.table-card {
	border: none !important;
	border-radius: 16px !important;
	overflow: hidden !important;
	animation: fadeInUp 0.5s ease !important;
}

@keyframes fadeInUp {
	from {
		opacity: 0;
		transform: translateY(20px);
	}
	to {
		opacity: 1;
		transform: translateY(0);
	}
}

.table-responsive {
	border-radius: 12px !important;
}

.table {
	margin-bottom: 0 !important;
}

.table-header {
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
	color: white !important;
}

.table-header th {
	padding: 1rem !important;
	font-weight: 600 !important;
	border: none !important;
	text-transform: uppercase !important;
	font-size: 0.85rem !important;
	letter-spacing: 0.5px !important;
}

.table-row {
	transition: all 0.3s ease !important;
	cursor: pointer !important;
}

.table-row:hover {
	background-color: #f8f9fa !important;
	transform: scale(1.01) !important;
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08) !important;
}

.table-row td {
	padding: 1rem !important;
	vertical-align: middle !important;
	border-bottom: 1px solid #e2e8f0 !important;
}

/* Comment content preview styling */
.table-row td:nth-child(2) {
	font-size: 0.95rem !important;
	color: #4a5568 !important;
	line-height: 1.5 !important;
}

/* Post name column styling */
.table-row td:nth-child(3) {
	font-size: 0.9rem !important;
	color: #667eea !important;
	font-weight: 500 !important;
}

/* =======================
   Empty State
======================= */
.empty-state {
	padding: 4rem 2rem !important;
}

.empty-state i {
	opacity: 0.3 !important;
}

/* =======================
   Buttons
======================= */
.btn-add {
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
	color: white !important;
	border: none !important;
	padding: 12px 32px !important;
	border-radius: 25px !important;
	font-weight: 600 !important;
	font-size: 1.1rem !important;
	transition: all 0.3s ease !important;
	box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4) !important;
}

.btn-add:hover {
	transform: translateY(-2px) !important;
	box-shadow: 0 6px 16px rgba(102, 126, 234, 0.6) !important;
}

.btn-edit {
	background-color: #3182ce !important;
	color: white !important;
	border: none !important;
	padding: 6px 16px !important;
	border-radius: 8px !important;
	font-weight: 500 !important;
	transition: all 0.3s ease !important;
}

.btn-edit:hover {
	background-color: #2c5282 !important;
	transform: translateY(-2px) !important;
	box-shadow: 0 4px 8px rgba(49, 130, 206, 0.4) !important;
}

.btn-delete {
	background-color: #e53e3e !important;
	color: white !important;
	border: none !important;
	padding: 6px 16px !important;
	border-radius: 8px !important;
	font-weight: 500 !important;
	transition: all 0.3s ease !important;
}

.btn-delete:hover {
	background-color: #c53030 !important;
	transform: translateY(-2px) !important;
	box-shadow: 0 4px 8px rgba(229, 62, 62, 0.4) !important;
}

/* =======================
   Modal Styles
======================= */
.modal-content {
	border-radius: 16px !important;
	border: none !important;
	box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2) !important;
}

.modal-header {
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
	color: white !important;
	border-radius: 16px 16px 0 0 !important;
	border: none !important;
	padding: 1.5rem !important;
}

.modal-header .btn-close,
.modal-header .btn-close-white {
	filter: brightness(0) invert(1) !important;
}

.modal-body {
	padding: 2rem !important;
	max-height: 70vh !important;
	overflow-y: auto !important;
}

.modal-footer {
	border: none !important;
	padding: 1rem 2rem 1.5rem !important;
}

.form-label {
	color: #2d3748 !important;
	margin-bottom: 0.5rem !important;
	font-size: 0.95rem !important;
}

.form-control, .form-select {
	border: 2px solid #e2e8f0 !important;
	border-radius: 8px !important;
	padding: 10px 16px !important;
	transition: all 0.3s ease !important;
	font-size: 0.95rem !important;
}

.form-control:focus, .form-select:focus {
	border-color: #667eea !important;
	box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25) !important;
}

.form-control.is-invalid, .form-select.is-invalid {
	border-color: #e53e3e !important;
}

.invalid-feedback {
	display: block !important;
	color: #e53e3e !important;
	font-size: 0.875rem !important;
	margin-top: 0.5rem !important;
}

textarea.form-control {
	resize: vertical !important;
	min-height: 120px !important;
	line-height: 1.6 !important;
}

/* =======================
   Detail Modal Content
======================= */
.detail-container {
	animation: fadeIn 0.3s ease !important;
}

@keyframes fadeIn {
	from {
		opacity: 0;
	}
	to {
		opacity: 1;
	}
}

.detail-item {
	margin-bottom: 1.5rem !important;
	padding-bottom: 1rem !important;
	border-bottom: 1px solid #e2e8f0 !important;
}

.detail-item:last-child {
	border-bottom: none !important;
	margin-bottom: 0 !important;
	padding-bottom: 0 !important;
}

.detail-label {
	font-weight: 600 !important;
	color: #667eea !important;
	margin-bottom: 0.5rem !important;
	display: flex !important;
	align-items: center !important;
	font-size: 0.95rem !important;
}

.detail-label i {
	margin-right: 8px !important;
	font-size: 1.1rem !important;
}

.detail-value {
	color: #2d3748 !important;
	word-wrap: break-word !important;
	line-height: 1.6 !important;
	font-size: 0.95rem !important;
}

.detail-media {
	margin-top: 1rem !important;
	text-align: center !important;
}

.detail-media img,
.detail-media video {
	max-width: 100% !important;
	border-radius: 12px !important;
	box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;
	max-height: 400px !important;
	object-fit: contain !important;
}

/* =======================
   Footer
======================= */
.footer {
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
	color: white !important;
	padding: 20px 0 !important;
	margin-top: auto !important;
}

/* =======================
   Dropdown
======================= */
.dropdown-menu {
	border: none !important;
	box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
	border-radius: 12px !important;
	margin-top: 0.5rem !important;
	z-index: 1050 !important;
}

.dropdown-item {
	padding: 10px 20px !important;
	transition: all 0.3s ease !important;
}

.dropdown-item:hover {
	background-color: #f8f9fa !important;
	padding-left: 25px !important;
}

.dropdown-item i {
	width: 20px !important;
}

/* =======================
   Pagination Styles
======================= */
.pagination {
	margin-bottom: 0 !important;
}

.page-link {
	color: #667eea !important;
	border: 1px solid #e2e8f0 !important;
	padding: 8px 16px !important;
	margin: 0 4px !important;
	border-radius: 8px !important;
	transition: all 0.3s ease !important;
	font-weight: 500 !important;
}

.page-link:hover {
	background-color: #f8f9fa !important;
	border-color: #667eea !important;
	transform: translateY(-2px) !important;
	box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3) !important;
}

.page-item.active .page-link {
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
	border-color: #667eea !important;
	color: white !important;
	box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4) !important;
}

.page-item.disabled .page-link {
	color: #cbd5e0 !important;
	background-color: #f8f9fa !important;
	border-color: #e2e8f0 !important;
	cursor: not-allowed !important;
}

.page-item:first-child .page-link {
	border-radius: 8px !important;
}

.page-item:last-child .page-link {
	border-radius: 8px !important;
}

/* =======================
   Badge Styles
======================= */
.badge {
	padding: 6px 12px !important;
	font-weight: 500 !important;
	font-size: 0.85rem !important;
	border-radius: 6px !important;
}

.badge.bg-success {
	background-color: #48bb78 !important;
}

.badge.bg-danger {
	background-color: #f56565 !important;
}

.badge.bg-warning {
	background-color: #ed8936 !important;
	color: white !important;
}

/* Like badge styling */
.badge.bg-danger i {
	animation: heartbeat 1.5s ease infinite !important;
}

@keyframes heartbeat {
	0%, 100% {
		transform: scale(1);
	}
	10%, 30% {
		transform: scale(1.1);
	}
	20%, 40% {
		transform: scale(1);
	}
}

/* =======================
   Responsive Design
======================= */
@media (max-width: 991px) {
	.page-title {
		font-size: 2rem !important;
	}
	
	.table-header th {
		font-size: 0.8rem !important;
	}
}

@media (max-width: 767px) {
	.page-title {
		font-size: 1.75rem !important;
	}
	
	.navbar-brand {
		font-size: 1.2rem !important;
	}
	
	.btn-add {
		font-size: 1rem !important;
		padding: 10px 24px !important;
	}
	
	.btn-edit,
	.btn-delete {
		padding: 5px 12px !important;
		font-size: 0.875rem !important;
	}
	
	.table-header th {
		font-size: 0.75rem !important;
		padding: 0.75rem 0.5rem !important;
	}
	
	.table-row td {
		padding: 0.75rem 0.5rem !important;
		font-size: 0.875rem !important;
	}
	
	.modal-body {
		padding: 1.5rem !important;
	}
	
	/* Hide post name column on mobile */
	.table-header th:nth-child(3),
	.table-row td:nth-child(3) {
		display: none !important;
	}
}

@media (max-width: 576px) {
	.navbar-brand i {
		font-size: 1.5rem !important;
	}
	
	.btn-user i {
		font-size: 1.3rem !important;
	}
	
	.alert-container {
		width: 95% !important;
		top: 70px !important;
	}
	
	.page-link {
		padding: 6px 12px !important;
		font-size: 0.875rem !important;
		margin: 0 2px !important;
	}
	
	.pagination {
		flex-wrap: wrap !important;
	}
	
	.detail-media img,
	.detail-media video {
		max-height: 250px !important;
	}
	
	/* Make buttons full width on mobile */
	.btn-edit,
	.btn-delete {
		display: block !important;
		width: 100% !important;
		margin-bottom: 0.5rem !important;
	}
	
	.btn-edit {
		margin-right: 0 !important;
	}
}

/* =======================
   Scrollbar
======================= */
::-webkit-scrollbar {
	width: 8px !important;
	height: 8px !important;
}

::-webkit-scrollbar-track {
	background: #f1f1f1 !important;
	border-radius: 4px !important;
}

::-webkit-scrollbar-thumb {
	background: #888 !important;
	border-radius: 4px !important;
}

::-webkit-scrollbar-thumb:hover {
	background: #667eea !important;
}

/* =======================
   Loading Spinner
======================= */
.spinner-border {
	width: 3rem !important;
	height: 3rem !important;
	border-width: 0.3rem !important;
}

/* =======================
   Utility Classes
======================= */
.text-truncate-2 {
	display: -webkit-box !important;
	-webkit-line-clamp: 2 !important;
	-webkit-box-orient: vertical !important;
	overflow: hidden !important;
	text-overflow: ellipsis !important;
}

/* =======================
   Upload File Styles
======================= */
.upload-container {
	border: 2px dashed #e2e8f0 !important;
	border-radius: 12px !important;
	padding: 1.5rem !important;
	text-align: center !important;
	background-color: #f8f9fa !important;
	transition: all 0.3s ease !important;
}

.upload-container:hover {
	border-color: #667eea !important;
	background-color: #f0f2ff !important;
}

.btn-upload {
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
	color: white !important;
	border: none !important;
	padding: 10px 24px !important;
	border-radius: 8px !important;
	font-weight: 600 !important;
	transition: all 0.3s ease !important;
	box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3) !important;
}

.btn-upload:hover {
	transform: translateY(-2px) !important;
	box-shadow: 0 4px 12px rgba(102, 126, 234, 0.5) !important;
}

.file-status {
	display: flex !important;
	align-items: center !important;
	justify-content: center !important;
	gap: 8px !important;
	font-size: 0.95rem !important;
	font-weight: 500 !important;
	padding: 8px !important;
}

.file-status i {
	font-size: 1.2rem !important;
}

.file-preview {
	max-width: 100% !important;
	border-radius: 12px !important;
	overflow: hidden !important;
	box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;
}

.preview-image,
.preview-video {
	width: 100% !important;
	max-height: 400px !important;
	object-fit: contain !important;
	border-radius: 12px !important;
}

/* Spinner for loading */
.spinner-border-sm {
	width: 1rem !important;
	height: 1rem !important;
	border-width: 0.15em !important;
}

/* Remove file button */
.btn-sm.btn-danger {
	padding: 6px 12px !important;
	font-size: 0.875rem !important;
	border-radius: 6px !important;
}

/* =======================
   Sticky Footer for Modals
======================= */
.sticky-footer {
	position: sticky !important;
	bottom: 0 !important;
	background: white !important;
	z-index: 10 !important;
	box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05) !important;
	margin: 0 !important;
	padding: 1rem 1.5rem !important;
}

.modal-body {
	padding-bottom: 1rem !important;
	max-height: calc(70vh - 120px) !important;
	overflow-y: auto !important;
}

/* Responsive cho mobile */
@media (max-width: 767px) {
	.upload-container {
		padding: 1rem !important;
	}
	
	.btn-upload {
		padding: 8px 20px !important;
		font-size: 0.9rem !important;
	}
	
	.preview-image,
	.preview-video {
		max-height: 300px !important;
	}
	
	.sticky-footer {
		padding: 0.75rem 1rem !important;
	}
	
	.sticky-footer .btn {
		padding: 8px 16px !important;
		font-size: 0.9rem !important;
	}
}
- MyCommentPage.jsp:
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ page import="java.util.ArrayList" %>
<%@ page import="Modal.BaiViet.BaiViet" %>
<%@ page import="Modal.BinhLuan.BinhLuan" %>
<%@ page import="Modal.LuotThichBinhLuan.LuotThichBinhLuan" %>
<%@ page import="java.text.SimpleDateFormat" %>
<%@ page import="java.util.TimeZone" %>
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Website Forum</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="${pageContext.request.contextPath}/pages/mycomment_page/style.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
    <%
        String quyen = (String) session.getAttribute("quyen");
        String account = (String) session.getAttribute("account");
        boolean isAdmin = "Admin".equals(quyen);
        
        ArrayList<BaiViet> dsBaiVietAll = (ArrayList<BaiViet>) request.getAttribute("dsBaiViet");
        ArrayList<BinhLuan> dsBinhLuan = (ArrayList<BinhLuan>) request.getAttribute("dsBinhLuan");
        ArrayList<LuotThichBinhLuan> dsLuotThich = (ArrayList<LuotThichBinhLuan>) request.getAttribute("dsLuotThich");
        
        long selectedBaiViet = -1;
        if (request.getAttribute("selectedBaiViet") != null) selectedBaiViet = (long) request.getAttribute("selectedBaiViet");
        
        String sortBy = (String) request.getAttribute("sortBy");
        String searchKey = (String) request.getAttribute("searchKey");
        
        SimpleDateFormat sdf = new SimpleDateFormat("dd/MM/yyyy HH:mm:ss");
        sdf.setTimeZone(TimeZone.getTimeZone("Asia/Ho_Chi_Minh"));
        
        Integer currentPage = (Integer) request.getAttribute("currentPage");
        Integer totalPages = (Integer) request.getAttribute("totalPages");
        Integer totalItems = (Integer) request.getAttribute("totalItems");
        Integer startIndex = (Integer) request.getAttribute("startIndex");
        
        if (currentPage == null) currentPage = 1;
        if (totalPages == null) totalPages = 0;
        if (totalItems == null) totalItems = 0;
        if (startIndex == null) startIndex = 0;
        
        String message = (String) request.getAttribute("message");
        String messageType = (String) request.getAttribute("messageType");
    %>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-gradient sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand d-none d-lg-flex align-items-center" href="${pageContext.request.contextPath}/TrangChuController">
                <i class="bi bi-chat-dots-fill me-2"></i>
                <span class="fw-bold">Forum</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarContent">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="${pageContext.request.contextPath}/TrangChuController">
                            <i class="bi bi-house-fill me-1"></i> Trang chủ
                        </a>
                    </li>
                    <% if (isAdmin) { %>
                    <li class="nav-item">
						<a class="nav-link" href="${pageContext.request.contextPath}/TaiKhoanController">
							<i class="bi bi-tags-fill me-1"></i>Tài khoản
						</a>
					</li>
                    <li class="nav-item">
                        <a class="nav-link" href="${pageContext.request.contextPath}/TheLoaiController">
                            <i class="bi bi-tags-fill me-1"></i>Thể loại
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="${pageContext.request.contextPath}/BaiVietController">
                            <i class="bi bi-file-text-fill me-1"></i>Bài viết
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="${pageContext.request.contextPath}/BinhLuanController">
                            <i class="bi bi-chat-left-text-fill me-1"></i>Bình luận
                        </a>
                    </li>
                    <% } %>
                    <li class="nav-item">
                        <a class="nav-link" href="${pageContext.request.contextPath}/BaiVietCuaToiController">
                            <i class="bi bi-journal-text me-1"></i>Bài viết của tôi
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="${pageContext.request.contextPath}/BinhLuanCuaToiController">
                            <i class="bi bi-chat-square-dots me-1"></i>Bình luận của tôi
                        </a>
                    </li>
                </ul>
                <div class="dropdown">
                    <button class="btn btn-user dropdown-toggle" type="button" data-bs-toggle="dropdown">
                        <i class="bi bi-person-circle"></i>
                        <span class="ms-2 d-none d-lg-inline"><%= account %></span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="${pageContext.request.contextPath}/ThongTinCaNhanController">
                            <i class="bi bi-person-fill me-2"></i>Thông tin cá nhân
                        </a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item text-danger" href="${pageContext.request.contextPath}/DangXuatController">
                            <i class="bi bi-box-arrow-right me-2"></i>Đăng xuất
                        </a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid mt-4">
        <div class="row g-3">
            <!-- Center Content - Comments -->
            <div class="col-lg-9 col-md-8 col-12">
                <!-- Page Title -->
                <div class="card shadow-sm mb-3 title-card">
                    <div class="card-body">
                        <h4 class="mb-0">
                            <i class="bi bi-chat-square-dots me-2"></i>
                            Danh sách bình luận của <%= account %>
                        </h4>
                    </div>
                </div>

                <!-- Alert Container (Auto dismiss) -->
                <div id="messageAlert" class="alert-container" style="display: none;">
                    <div class="alert fade" role="alert">
                        <i class="bi me-2"></i>
                        <span id="messageText"></span>
                    </div>
                </div>

                <!-- Add New Comment Button -->
                <div class="mb-3">
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addCommentModal">
                        <i class="bi bi-plus-circle me-2"></i>Tạo bình luận mới
                    </button>
                </div>

                <!-- Sort & Filter Controls -->
                <div class="card shadow-sm mb-3 controls-card">
                    <div class="card-body">
                        <div class="row g-2">
                            <div class="col-md-6">
                                <label class="form-label small fw-bold">Sắp xếp:</label>
                                <select class="form-select form-select-sm" id="sortSelect" onchange="handleSort(this.value)">
                                    <option value="">-- Chọn --</option>
                                    <option value="luotThichCao" <%= "luotThichCao".equals(sortBy) ? "selected" : "" %>>Lượt thích cao nhất</option>
                                    <option value="luotThichThap" <%= "luotThichThap".equals(sortBy) ? "selected" : "" %>>Lượt thích thấp nhất</option>
                                    <option value="taoGanNhat" <%= "taoGanNhat".equals(sortBy) ? "selected" : "" %>>Tạo gần nhất</option>
                                    <option value="taoXaNhat" <%= "taoXaNhat".equals(sortBy) ? "selected" : "" %>>Tạo xa nhất</option>
                                    <option value="capNhatGanNhat" <%= "capNhatGanNhat".equals(sortBy) ? "selected" : "" %>>Cập nhật gần nhất</option>
                                    <option value="capNhatXaNhat" <%= "capNhatXaNhat".equals(sortBy) ? "selected" : "" %>>Cập nhật xa nhất</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label small fw-bold">Lọc theo bài viết:</label>
                                <select class="form-select form-select-sm" id="filterBaiVietSelect" onchange="handleFilterBaiViet(this.value)">
                                    <option value="">-- Tất cả bài viết --</option>
                                    <% 
                                        if (dsBaiVietAll != null && !dsBaiVietAll.isEmpty()) {
                                            for (BaiViet bv : dsBaiVietAll) { 
                                    %>
                                        <option value="<%= bv.getMaBaiViet() %>" <%= bv.getMaBaiViet() == selectedBaiViet ? "selected" : "" %>>
                                            <%= bv.getTieuDe() %>
                                        </option>
                                    <% 
                                            }
                                        }
                                    %>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Comments List -->
                <div class="comments-container">
                    <% if (dsBinhLuan == null || dsBinhLuan.isEmpty()) { %>
                        <div class="card shadow-sm">
                            <div class="card-body text-center py-5">
                                <i class="bi bi-inbox text-muted" style="font-size: 4rem;"></i>
                                <h5 class="mt-3 text-muted">
                                    <% if (selectedBaiViet != -1) { %>
                                        Bạn chưa có bình luận nào trong bài viết này
                                    <% } else if (searchKey != null && !searchKey.trim().isEmpty()) { %>
                                        Không tìm thấy bình luận phù hợp với từ khóa tìm kiếm
                                    <% } else { %>
                                        Bạn chưa có bình luận nào. Hãy tạo bình luận đầu tiên!
                                    <% } %>
                                </h5>
                            </div>
                        </div>
                    <% } else {
                        for (BinhLuan bl : dsBinhLuan) {
                            // Tìm tên bài viết
                            String tenBaiViet = "";
                            if (dsBaiVietAll != null) {
                                for (BaiViet bv : dsBaiVietAll) {
                                    if (bv.getMaBaiViet() == bl.getMaBaiViet()) {
                                        tenBaiViet = bv.getTieuDe();
                                        break;
                                    }
                                }
                            }
                            
                            // Đếm số lượt thích
                            int soLuotThich = 0;
                            boolean daThich = false;
                            if (dsLuotThich != null) {
                                for (LuotThichBinhLuan lt : dsLuotThich) {
                                    if (lt.getMaBinhLuan() == bl.getMaBinhLuan()) {
                                        soLuotThich++;
                                        if (account != null && lt.getTenDangNhap().equals(account)) {
                                            daThich = true;
                                        }
                                    }
                                }
                            }
                    %>
                        <div class="card shadow-sm mb-3 comment-card" 
                             data-ma-binh-luan="<%= bl.getMaBinhLuan() %>"
                             data-noi-dung="<%= bl.getNoiDung().replace("\"", "&quot;").replace("\n", "&#10;") %>"
                             data-url="<%= bl.getUrl() != null ? bl.getUrl() : "" %>"
                             data-ma-bai-viet="<%= bl.getMaBaiViet() %>">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <div class="d-flex align-items-center flex-grow-1">
                                        <i class="bi bi-person-circle comment-avatar"></i>
                                        <div class="ms-2">
                                            <div class="fw-bold"><%= bl.getTaiKhoanTao() %></div>
                                            <small class="text-muted">
                                                <i class="bi bi-clock me-1"></i>
                                                <%= bl.getThoiDiemCapNhat() != null ? sdf.format(bl.getThoiDiemCapNhat()) : sdf.format(bl.getThoiDiemTao()) %>
                                            </small>
                                        </div>
                                    </div>
                                    <div class="dropdown">
                                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                            <i class="bi bi-three-dots-vertical"></i>
                                        </button>
                                        <ul class="dropdown-menu dropdown-menu-end">
                                            <li><a class="dropdown-item" href="#" onclick="editComment(<%= bl.getMaBinhLuan() %>); return false;">
                                                <i class="bi bi-pencil me-2"></i>Sửa
                                            </a></li>
                                            <li><hr class="dropdown-divider"></li>
                                            <li><a class="dropdown-item text-danger" href="#" onclick="deleteComment(<%= bl.getMaBinhLuan() %>, '<%= bl.getTieuDe() != null ? bl.getTieuDe().replace("'", "\\'") : "bình luận này" %>'); return false;">
                                                <i class="bi bi-trash me-2"></i>Xóa
                                            </a></li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <div class="mb-2">
                                    <% if (!"Active".equals(bl.getTrangThai())) { %>
                                        <span class="badge bg-danger ms-1"><%= bl.getTrangThai() %></span>
                                    <% } %>
                                </div>
                                
                                <% if (bl.getTieuDe() != null && !bl.getTieuDe().trim().isEmpty()) { %>
                                    <h6 class="comment-title"><%= bl.getTieuDe() %></h6>
                                <% } %>
                                
                                <div class="comment-content mb-3">
                                    <%= bl.getNoiDung().replace("\n", "<br>") %>
                                </div>
                                
                                <% if (bl.getUrl() != null && !bl.getUrl().trim().isEmpty()) { %>
                                    <div class="comment-media mb-3">
                                        <% if (bl.getUrl().matches(".*\\.(jpg|jpeg|png|gif|webp)$")) { %>
                                            <img src="<%= bl.getUrl() %>" class="img-fluid rounded" alt="Comment image">
                                        <% } else if (bl.getUrl().matches(".*\\.(mp4|webm|ogg)$")) { %>
                                            <video controls class="w-100 rounded">
                                                <source src="<%= bl.getUrl() %>" type="video/mp4">
                                            </video>
                                        <% } %>
                                    </div>
                                <% } %>
                                
                                <div class="d-flex justify-content-between align-items-center pt-2 border-top">
                                    <div class="text-muted">
                                        <i class="bi bi-file-text-fill me-1"></i>
                                        <a href="${pageContext.request.contextPath}/ChiTietBaiVietController?id=<%= bl.getMaBaiViet() %>" 
                                           class="text-decoration-none">
                                            <span><%= tenBaiViet %></span>
                                        </a>
                                    </div>
                                    <div class="like-section" style="cursor: pointer;">
                                        <i class="bi <%= daThich ? "bi-hand-thumbs-up-fill" : "bi-hand-thumbs-up" %> me-1 like-icon" 
                                           data-ma-binh-luan="<%= bl.getMaBinhLuan() %>"
                                           data-da-thich="<%= daThich %>"
                                           style="color: <%= daThich ? "#667eea" : "" %>; font-size: 1.1rem;"></i>
                                        <span class="like-count" data-ma-binh-luan="<%= bl.getMaBinhLuan() %>"><%= soLuotThich %></span>
                                        <span class="text-muted"> lượt thích</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <% 
                        }
                    } 
                    %>
                    
                    <% if (totalPages > 1) { %>
                        <nav aria-label="Page navigation" class="mt-4">
                            <ul class="pagination justify-content-center">
                                <li class="page-item <%= currentPage == 1 ? "disabled" : "" %>">
                                    <a class="page-link" href="<%= currentPage > 1 ? buildPaginationUrl(request, currentPage - 1) : "#" %>" aria-label="Previous">
                                        <span aria-hidden="true">&laquo;</span>
                                    </a>
                                </li>
                                <%
                                    int startPage = Math.max(1, currentPage - 2);
                                    int endPage = Math.min(totalPages, currentPage + 2);
                                    if (currentPage <= 3) {
                                        endPage = Math.min(5, totalPages);
                                    }
                                    if (currentPage >= totalPages - 2) {
                                        startPage = Math.max(1, totalPages - 4);
                                    }
                                    if (startPage > 1) {
                                %>
                                        <li class="page-item">
                                            <a class="page-link" href="<%= buildPaginationUrl(request, 1) %>">1</a>
                                        </li>
                                        <% if (startPage > 2) { %>
                                            <li class="page-item disabled">
                                                <span class="page-link">...</span>
                                            </li>
                                        <% } %>
                                <%
                                    }
                                    for (int i = startPage; i <= endPage; i++) {
                                %>
                                        <li class="page-item <%= i == currentPage ? "active" : "" %>">
                                            <a class="page-link" href="<%= buildPaginationUrl(request, i) %>"><%= i %></a>
                                        </li>
                                <%
                                    }
                                    if (endPage < totalPages) {
                                        if (endPage < totalPages - 1) {
                                %>
                                            <li class="page-item disabled">
                                                <span class="page-link">...</span>
                                            </li>
                                <%
                                        }
                                %>
                                        <li class="page-item">
                                            <a class="page-link" href="<%= buildPaginationUrl(request, totalPages) %>"><%= totalPages %></a>
                                        </li>
                                <%
                                    }
                                %>
                                <li class="page-item <%= currentPage == totalPages ? "disabled" : "" %>">
                                    <a class="page-link" href="<%= currentPage < totalPages ? buildPaginationUrl(request, currentPage + 1) : "#" %>" aria-label="Next">
                                        <span aria-hidden="true">&raquo;</span>
                                    </a>
                                </li>
                            </ul>
                        </nav>
                        
                        <div class="text-center text-muted mt-2">
                            <small>
                                Trang <%= currentPage %> / <%= totalPages %> 
                                (Tổng <%= totalItems %> bình luận)
                            </small>
                        </div>
                    <% } %>
                </div>
            </div>

            <!-- Right Sidebar - Search -->
            <div class="col-lg-3 col-md-4 d-none d-md-block">
                <div class="card shadow-sm search-card sticky-top" style="top: 80px;">
                    <div class="card-header bg-gradient text-white">
                        <h5 class="mb-0"><i class="bi bi-search me-2"></i>Tìm kiếm</h5>
                    </div>
                    <div class="card-body">
                        <form action="${pageContext.request.contextPath}/BinhLuanCuaToiController" method="get">
                            <div class="input-group">
                                <input type="text" class="form-control" name="search" 
                                       placeholder="Tìm kiếm bình luận..." 
                                       value="<%= searchKey != null ? searchKey : "" %>">
                                <button class="btn btn-primary" type="submit">
                                    <i class="bi bi-search"></i>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer mt-5">
        <div class="container text-center">
            <p class="mb-0">&copy; 2025 Website Forum. All rights reserved.</p>
        </div>
    </footer>

    <!-- Add Comment Modal -->
	<div class="modal fade" id="addCommentModal" tabindex="-1">
	    <div class="modal-dialog modal-lg modal-dialog-scrollable">
	        <div class="modal-content">
	            <div class="modal-header bg-gradient text-white">
	                <h5 class="modal-title"><i class="bi bi-plus-circle me-2"></i>Tạo bình luận mới</h5>
	                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
	            </div>
	            <form action="${pageContext.request.contextPath}/XuLyBinhLuanCuaToiController" method="post" enctype="multipart/form-data">
	                <input type="hidden" name="action" value="create">
	                <input type="hidden" id="addUrlHidden" name="url" value="">
	                <div class="modal-body">
	                    <div class="mb-3">
	                        <label class="form-label fw-bold">Bài viết <span class="text-danger">*</span></label>
	                        <select class="form-select" name="maBaiViet" required>
	                            <option value="">-- Chọn bài viết --</option>
	                            <% if (dsBaiVietAll != null) {
	                                for (BaiViet bv : dsBaiVietAll) { %>
	                                    <option value="<%= bv.getMaBaiViet() %>"><%= bv.getTieuDe() %></option>
	                            <% }
	                            } %>
	                        </select>
	                    </div>
	                    <div class="mb-3">
	                        <label class="form-label fw-bold">Nội dung <span class="text-danger">*</span></label>
	                        <textarea class="form-control" name="noiDung" rows="6" required></textarea>
	                    </div>
	                    
	                    <!-- Upload File Section -->
	                    <div class="mb-3">
	                        <label class="form-label fw-bold">Ảnh/Video</label>
	                        <div class="upload-container">
	                            <input type="file" id="addFileInput" accept="image/*,video/*" style="display: none;">
	                            <button type="button" class="btn btn-upload" onclick="document.getElementById('addFileInput').click()">
	                                <i class="bi bi-cloud-upload me-2"></i>Tải ảnh/video lên
	                            </button>
	                            <div class="file-status mt-2">
	                                <i class="bi bi-file-earmark"></i>
	                                <span id="addFileStatus" class="text-muted">Chưa có ảnh/video</span>
	                            </div>
	                            <div id="addFilePreview" class="file-preview mt-3" style="display: none;"></div>
	                        </div>
	                        <small class="text-muted">
	                            Hỗ trợ: .jpg, .jpeg, .png, .gif, .webp (ảnh), .mp4, .webm, .ogg (video) - Tối đa 50MB
	                        </small>
	                    </div>
	                </div>
	                <div class="modal-footer sticky-footer">
	                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
	                        <i class="bi bi-x-circle me-1"></i>Hủy
	                    </button>
	                    <button type="submit" class="btn btn-primary">
	                        <i class="bi bi-check-circle me-1"></i>Tạo bình luận
	                    </button>
	                </div>
	            </form>
	        </div>
	    </div>
	</div>

    <!-- Edit Comment Modal -->
	<div class="modal fade" id="editCommentModal" tabindex="-1">
	    <div class="modal-dialog modal-lg modal-dialog-scrollable">
	        <div class="modal-content">
	            <div class="modal-header bg-gradient text-white">
	                <h5 class="modal-title"><i class="bi bi-pencil me-2"></i>Chỉnh sửa bình luận</h5>
	                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
	            </div>
	            <form action="${pageContext.request.contextPath}/XuLyBinhLuanCuaToiController" method="post" enctype="multipart/form-data" id="editCommentForm">
	                <input type="hidden" name="action" value="update">
	                <input type="hidden" name="maBinhLuan" id="editMaBinhLuan">
	                <input type="hidden" id="editUrlHidden" name="url" value="">
	                <input type="hidden" id="editKeepOldFile" name="keepOldFile" value="false">
	                <div class="modal-body">
	                    <div class="mb-3">
	                        <label class="form-label fw-bold">Nội dung <span class="text-danger">*</span></label>
	                        <textarea class="form-control" name="noiDung" id="editNoiDung" rows="6" required></textarea>
	                    </div>
	                    
	                    <!-- Upload File Section -->
	                    <div class="mb-3">
	                        <label class="form-label fw-bold">Ảnh/Video</label>
	                        <div class="upload-container">
	                            <input type="file" id="editFileInput" accept="image/*,video/*" style="display: none;">
	                            <button type="button" class="btn btn-upload" onclick="document.getElementById('editFileInput').click()">
	                                <i class="bi bi-cloud-upload me-2"></i>Tải ảnh/video lên
	                            </button>
	                            <div class="file-status mt-2">
	                                <i class="bi bi-file-earmark"></i>
	                                <span id="editFileStatus" class="text-muted">Chưa có ảnh/video</span>
	                            </div>
	                            <div id="editFilePreview" class="file-preview mt-3" style="display: none;"></div>
	                            <button type="button" class="btn btn-sm btn-danger mt-2" id="editRemoveFileBtn" 
	                                    style="display: none;" onclick="removeEditFile()">
	                                <i class="bi bi-trash me-1"></i>Xóa file
	                            </button>
	                        </div>
	                        <small class="text-muted">
	                            Hỗ trợ: .jpg, .jpeg, .png, .gif, .webp (ảnh), .mp4, .webm, .ogg (video) - Tối đa 50MB
	                        </small>
	                    </div>
	                </div>
	                <div class="modal-footer sticky-footer">
	                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
	                        <i class="bi bi-x-circle me-1"></i>Hủy
	                    </button>
	                    <button type="submit" class="btn btn-primary">
	                        <i class="bi bi-check-circle me-1"></i>Cập nhật
	                    </button>
	                </div>
	            </form>
	        </div>
	    </div>
	</div>

    <!-- Like List Modal -->
    <div class="modal fade" id="likeListModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-hand-thumbs-up-fill me-2"></i>Danh sách lượt thích</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="likeListContent">
                    <div class="text-center py-3">
                        <div class="spinner-border text-primary" role="status"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <%!
        private String buildPaginationUrl(HttpServletRequest request, int page) {
            String contextPath = request.getContextPath();
            String baiviet = request.getParameter("baiviet");
            String sort = request.getParameter("sort");
            String search = request.getParameter("search");
            
            StringBuilder url = new StringBuilder(contextPath + "/BinhLuanCuaToiController?page=" + page);
            
            if (baiviet != null && !baiviet.trim().isEmpty()) {
                try {
                    url.append("&baiviet=").append(java.net.URLEncoder.encode(baiviet, "UTF-8"));
                } catch (Exception e) {
                    e.printStackTrace();
                }
            }
            if (sort != null && !sort.trim().isEmpty()) {
                try {
                    url.append("&sort=").append(java.net.URLEncoder.encode(sort, "UTF-8"));
                } catch (Exception e) {
                    e.printStackTrace();
                }
            }
            if (search != null && !search.trim().isEmpty()) {
                try {
                    url.append("&search=").append(java.net.URLEncoder.encode(search, "UTF-8"));
                } catch (Exception e) {
                    e.printStackTrace();
                }
            }
            
            return url.toString();
        }
    %>

    <script src="${pageContext.request.contextPath}/pages/mycomment_page/script.js"></script>
    <script>
        // Show message from server - Auto dismiss after 3 seconds
        <% if (message != null && messageType != null) { 
            String escapedMessage = message.replace("\\", "\\\\").replace("'", "\\'").replace("\n", "\\n").replace("\r", "\\r");
        %>
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(function() {
                    showMessage('<%= escapedMessage %>', '<%= messageType %>');
                }, 100);
            });
        <% } %>
    </script>
</body>
</html>
- script.js (Của MyCommentPage):
// script.js (MyCommentPage)
document.addEventListener('DOMContentLoaded', function() {
    // Initialize tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
});

// Get context path
const contextPath = window.location.pathname.split('/')[1];

// Show message alert with auto dismiss
function showMessage(message, type) {
    const alertContainer = document.getElementById('messageAlert');
    const messageText = document.getElementById('messageText');
    const alert = alertContainer.querySelector('.alert');
    const icon = alert.querySelector('i');
    
    // Set message text
    messageText.textContent = message;
    
    // Set alert type
    alert.className = 'alert fade show';
    if (type === 'success') {
        alert.classList.add('alert-success');
        icon.className = 'bi bi-check-circle-fill me-2';
    } else {
        alert.classList.add('alert-danger');
        icon.className = 'bi bi-exclamation-circle-fill me-2';
    }
    
    // Show alert
    alertContainer.style.display = 'block';
    
    // Auto hide after 3 seconds
    setTimeout(() => {
        alertContainer.style.display = 'none';
    }, 3000);
}

// Handle sort selection
function handleSort(value) {
    if (!value) return;
    
    const urlParams = new URLSearchParams(window.location.search);
    const baiviet = urlParams.get('baiviet');
    const search = urlParams.get('search');
    const page = urlParams.get('page');
    
    let url = '/' + contextPath + '/BinhLuanCuaToiController?sort=' + value;
    if (baiviet) url += '&baiviet=' + encodeURIComponent(baiviet);
    if (search) url += '&search=' + encodeURIComponent(search);
    if (page) url += '&page=' + encodeURIComponent(page);
    
    window.location.href = url;
}

// Handle filter by bai viet
function handleFilterBaiViet(value) {
    const urlParams = new URLSearchParams(window.location.search);
    const search = urlParams.get('search');
    const sort = urlParams.get('sort');
    const page = urlParams.get('page');
    
    let url = '/' + contextPath + '/BinhLuanCuaToiController';
    let params = [];
    
    if (search) params.push('search=' + encodeURIComponent(search));
    if (sort) params.push('sort=' + sort);
    if (value) params.push('baiviet=' + encodeURIComponent(value));
    if (page) params.push('page=' + encodeURIComponent(page));
    
    if (params.length > 0) url += '?' + params.join('&');
    
    window.location.href = url;
}

// Edit comment
function editComment(maBinhLuan) {
    // Find the comment card by maBinhLuan
    const commentCard = document.querySelector(`.comment-card[data-ma-binh-luan="${maBinhLuan}"]`);
    if (!commentCard) {
        alert('Không tìm thấy bình luận!');
        return;
    }

    // Get data from data attributes
    const maBinhLuanValue = commentCard.getAttribute('data-ma-binh-luan');
    const noiDung = commentCard.getAttribute('data-noi-dung').replace(/&#10;/g, '\n');
    const url = commentCard.getAttribute('data-url');

    // Populate the edit form
    document.getElementById('editMaBinhLuan').value = maBinhLuanValue;
    document.getElementById('editNoiDung').value = noiDung;
    document.getElementById('editUrl').value = url || '';

    // Show the edit modal
    const modal = new bootstrap.Modal(document.getElementById('editCommentModal'));
    modal.show();
}

// Delete comment
function deleteComment(maBinhLuan, tieuDe) {
    if (confirm('Bạn có chắc chắn muốn xóa bình luận "' + tieuDe + '"?')) {
        window.location.href = '/' + contextPath + '/XuLyBinhLuanCuaToiController?action=delete&maBinhLuan=' + maBinhLuan;
    }
}

// Handle like/unlike
document.addEventListener('click', function(e) {
    if (e.target.classList.contains('like-icon')) {
        const maBinhLuan = e.target.getAttribute('data-ma-binh-luan');
        const daThich = e.target.getAttribute('data-da-thich') === 'true';
        const action = daThich ? 'unlike' : 'like';
        
        fetch('/' + contextPath + '/XuLyBinhLuanCuaToiController?action=' + action + '&maBinhLuan=' + maBinhLuan)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const commentCard = document.querySelector('.comment-card[data-ma-binh-luan="' + maBinhLuan + '"]');
                    if (!commentCard) return;
                    
                    const likeIcon = commentCard.querySelector('.like-icon[data-ma-binh-luan="' + maBinhLuan + '"]');
                    const likeCount = commentCard.querySelector('.like-count[data-ma-binh-luan="' + maBinhLuan + '"]');
                    
                    if (action === 'like') {
                        likeIcon.classList.remove('bi-hand-thumbs-up');
                        likeIcon.classList.add('bi-hand-thumbs-up-fill');
                        likeIcon.style.color = '#667eea';
                        likeCount.textContent = parseInt(likeCount.textContent) + 1;
                        likeIcon.setAttribute('data-da-thich', 'true');
                    } else {
                        likeIcon.classList.remove('bi-hand-thumbs-up-fill');
                        likeIcon.classList.add('bi-hand-thumbs-up');
                        likeIcon.style.color = '';
                        likeCount.textContent = parseInt(likeCount.textContent) - 1;
                        likeIcon.setAttribute('data-da-thich', 'false');
                    }
                } else {
                    alert(data.message || 'Có lỗi xảy ra!');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Có lỗi xảy ra! Vui lòng thử lại.');
            });
    }
    
    // Handle click on like count
    if (e.target.classList.contains('like-count')) {
        const maBinhLuan = e.target.getAttribute('data-ma-binh-luan');
        showLikeList(maBinhLuan);
    }
});

// Show like list
function showLikeList(maBinhLuan) {
    let modal = bootstrap.Modal.getInstance(document.getElementById('likeListModal'));
    if (!modal) {
        modal = new bootstrap.Modal(document.getElementById('likeListModal'));
    }
    
    const content = document.getElementById('likeListContent');
    content.innerHTML = '<div class="text-center py-3"><div class="spinner-border text-primary" role="status"></div></div>';
    modal.show();
    
    fetch('/' + contextPath + '/XuLyBinhLuanCuaToiController?action=getLikeList&maBinhLuan=' + maBinhLuan)
        .then(response => response.json())
        .then(data => {
            if (data.success && data.list && data.list.length > 0) {
                let html = '<div class="list-group">';
                for (let i = 0; i < data.list.length; i++) {
                    const item = data.list[i];
                    html += '<div class="list-group-item d-flex align-items-center">';
                    html += '<i class="bi bi-person-circle me-3" style="font-size: 2rem; color: #667eea;"></i>';
                    html += '<div><div class="fw-bold">' + item.tenDangNhap + '</div>';
                    html += '<small class="text-muted">' + item.thoiDiemThich + '</small></div></div>';
                }
                html += '</div>';
                content.innerHTML = html;
            } else {
                content.innerHTML = '<div class="text-center py-3 text-muted">Chưa có ai thích bình luận này</div>';
            }
        })
        .catch(error => {
            console.error('Error:', error);
            content.innerHTML = '<div class="alert alert-danger">Không thể tải danh sách!</div>';
        });
}

// Close modal on escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        const modals = ['addCommentModal', 'editCommentModal', 'likeListModal'];
        modals.forEach(modalId => {
            const modalElement = document.getElementById(modalId);
            if (modalElement) {
                const modal = bootstrap.Modal.getInstance(modalElement);
                if (modal) modal.hide();
            }
        });
    }
});

// Form validation
document.addEventListener('DOMContentLoaded', function() {
    const forms = document.querySelectorAll('form');
    forms.forEach(form => {
        form.addEventListener('submit', function(e) {
            const noiDungInput = form.querySelector('textarea[name="noiDung"]');
            
            if (noiDungInput && noiDungInput.value.trim() === '') {
                e.preventDefault();
                alert('Nội dung không được để trống!');
                noiDungInput.focus();
                return false;
            }
        });
    });
});

// ============================================
// UPLOAD FILE FUNCTIONALITY
// ============================================

// Global variables
let addUploadedFileUrl = '';
let editUploadedFileUrl = '';
let editOriginalFileUrl = '';

// Initialize upload listeners
document.addEventListener('DOMContentLoaded', function() {
    const addFileInput = document.getElementById('addFileInput');
    if(addFileInput) {
        addFileInput.addEventListener('change', handleAddFileSelect);
    }
    
    const editFileInput = document.getElementById('editFileInput');
    if(editFileInput) {
        editFileInput.addEventListener('change', handleEditFileSelect);
    }
});

// Handle Add File Select
function handleAddFileSelect(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    console.log('File selected:', file.name, file.type, file.size);
    
    // Validate file type
    const validImageTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
    const validVideoTypes = ['video/mp4', 'video/webm', 'video/ogg'];
    const allValidTypes = [...validImageTypes, ...validVideoTypes];
    
    if (!allValidTypes.includes(file.type)) {
        alert('Định dạng file không được hỗ trợ! Vui lòng chọn file ảnh (.jpg, .png, .gif, .webp) hoặc video (.mp4, .webm, .ogg)');
        event.target.value = '';
        return;
    }
    
    // Validate file size (50MB)
    if (file.size > 50 * 1024 * 1024) {
        alert('Kích thước file quá lớn! Vui lòng chọn file nhỏ hơn 50MB');
        event.target.value = '';
        return;
    }
    
    // Update file status
    document.getElementById('addFileStatus').textContent = 'Đang chuẩn bị tải lên...';
    document.getElementById('addFileStatus').classList.remove('text-muted');
    document.getElementById('addFileStatus').classList.add('text-primary');
    
    // Show preview
    showAddFilePreview(file);
    
    // Upload file
    uploadAddFile(file);
}

// Upload Add File
function uploadAddFile(file) {
    const formData = new FormData();
    formData.append('file', file);
    
    const statusElement = document.getElementById('addFileStatus');
    statusElement.innerHTML = '<i class="spinner-border spinner-border-sm me-2"></i>Đang tải lên...';
    statusElement.classList.remove('text-success', 'text-danger', 'text-muted');
    statusElement.classList.add('text-primary');
    
    fetch('/' + contextPath + '/UploadFileController', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        console.log('Upload response data:', data);
        if (data.success) {
            addUploadedFileUrl = data.url;
            document.getElementById('addUrlHidden').value = data.url;
            statusElement.textContent = data.fileName;
            statusElement.classList.remove('text-primary');
            statusElement.classList.add('text-success');
            console.log('Upload success! URL:', data.url);
        } else {
            throw new Error(data.message || 'Upload thất bại');
        }
    })
    .catch(error => {
        console.error('Upload error:', error);
        statusElement.textContent = 'Lỗi: ' + error.message;
        statusElement.classList.remove('text-primary');
        statusElement.classList.add('text-danger');
        document.getElementById('addFileInput').value = '';
        document.getElementById('addFilePreview').style.display = 'none';
        addUploadedFileUrl = '';
    });
}

// Show Add File Preview
function showAddFilePreview(file) {
    const preview = document.getElementById('addFilePreview');
    preview.innerHTML = '';
    preview.style.display = 'block';
    
    const reader = new FileReader();
    
    if (file.type.startsWith('image/')) {
        reader.onload = function(e) {
            const img = document.createElement('img');
            img.src = e.target.result;
            img.className = 'preview-image';
            img.style.maxWidth = '100%';
            img.style.maxHeight = '400px';
            img.style.objectFit = 'contain';
            img.style.borderRadius = '12px';
            preview.appendChild(img);
        };
        reader.readAsDataURL(file);
    } else if (file.type.startsWith('video/')) {
        reader.onload = function(e) {
            const video = document.createElement('video');
            video.src = e.target.result;
            video.controls = true;
            video.className = 'preview-video';
            video.style.width = '100%';
            video.style.maxHeight = '400px';
            video.style.borderRadius = '12px';
            preview.appendChild(video);
        };
        reader.readAsDataURL(file);
    }
}

// Handle Edit File Select
function handleEditFileSelect(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    console.log('Edit file selected:', file.name, file.type, file.size);
    
    // Validate file type
    const validImageTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
    const validVideoTypes = ['video/mp4', 'video/webm', 'video/ogg'];
    const allValidTypes = [...validImageTypes, ...validVideoTypes];
    
    if (!allValidTypes.includes(file.type)) {
        alert('Định dạng file không được hỗ trợ! Vui lòng chọn file ảnh (.jpg, .png, .gif, .webp) hoặc video (.mp4, .webm, .ogg)');
        event.target.value = '';
        return;
    }
    
    // Validate file size (50MB)
    if (file.size > 50 * 1024 * 1024) {
        alert('Kích thước file quá lớn! Vui lòng chọn file nhỏ hơn 50MB');
        event.target.value = '';
        return;
    }
    
    // Update file status
    document.getElementById('editFileStatus').textContent = 'Đang chuẩn bị tải lên...';
    document.getElementById('editFileStatus').classList.remove('text-muted');
    document.getElementById('editFileStatus').classList.add('text-primary');
    
    // Show preview
    showEditFilePreview(file);
    
    // Show remove button
    document.getElementById('editRemoveFileBtn').style.display = 'inline-block';
    
    // Mark that we're uploading a new file
    document.getElementById('editKeepOldFile').value = 'false';
    
    // Upload file
    uploadEditFile(file);
}

// Upload Edit File
function uploadEditFile(file) {
    const formData = new FormData();
    formData.append('file', file);
    
    const statusElement = document.getElementById('editFileStatus');
    statusElement.innerHTML = '<i class="spinner-border spinner-border-sm me-2"></i>Đang tải lên...';
    statusElement.classList.remove('text-success', 'text-danger', 'text-muted');
    statusElement.classList.add('text-primary');
    
    fetch('/' + contextPath + '/UploadFileController', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        console.log('Edit upload response data:', data);
        if (data.success) {
            editUploadedFileUrl = data.url;
            document.getElementById('editUrlHidden').value = data.url;
            statusElement.textContent = data.fileName;
            statusElement.classList.remove('text-primary');
            statusElement.classList.add('text-success');
            console.log('Edit upload success! URL:', data.url);
        } else {
            throw new Error(data.message || 'Upload thất bại');
        }
    })
    .catch(error => {
        console.error('Edit upload error:', error);
        statusElement.textContent = 'Lỗi: ' + error.message;
        statusElement.classList.remove('text-primary');
        statusElement.classList.add('text-danger');
        document.getElementById('editFileInput').value = '';
        document.getElementById('editFilePreview').style.display = 'none';
        editUploadedFileUrl = '';
    });
}

// Show Edit File Preview
function showEditFilePreview(file) {
    const preview = document.getElementById('editFilePreview');
    preview.innerHTML = '';
    preview.style.display = 'block';
    
    const reader = new FileReader();
    
    if (file.type.startsWith('image/')) {
        reader.onload = function(e) {
            const img = document.createElement('img');
            img.src = e.target.result;
            img.className = 'preview-image';
            img.style.maxWidth = '100%';
            img.style.maxHeight = '400px';
            img.style.objectFit = 'contain';
            img.style.borderRadius = '12px';
            preview.appendChild(img);
        };
        reader.readAsDataURL(file);
    } else if (file.type.startsWith('video/')) {
        reader.onload = function(e) {
            const video = document.createElement('video');
            video.src = e.target.result;
            video.controls = true;
            video.className = 'preview-video';
            video.style.width = '100%';
            video.style.maxHeight = '400px';
            video.style.borderRadius = '12px';
            preview.appendChild(video);
        };
        reader.readAsDataURL(file);
    }
}

// Remove Edit File
function removeEditFile() {
    document.getElementById('editFileInput').value = '';
    document.getElementById('editFileStatus').textContent = 'Chưa có ảnh/video';
    document.getElementById('editFileStatus').classList.remove('text-success');
    document.getElementById('editFileStatus').classList.add('text-muted');
    document.getElementById('editFilePreview').style.display = 'none';
    document.getElementById('editRemoveFileBtn').style.display = 'none';
    document.getElementById('editUrlHidden').value = '';
    document.getElementById('editKeepOldFile').value = 'false';
    editUploadedFileUrl = '';
}

// Override editComment function
const originalEditComment = window.editComment;
window.editComment = function(maBinhLuan) {
    // Find the comment card by maBinhLuan
    const commentCard = document.querySelector(`.comment-card[data-ma-binh-luan="${maBinhLuan}"]`);
    if (!commentCard) {
        alert('Không tìm thấy bình luận!');
        return;
    }

    // Get data from data attributes
    const maBinhLuanValue = commentCard.getAttribute('data-ma-binh-luan');
    const noiDung = commentCard.getAttribute('data-noi-dung').replace(/&#10;/g, '\n');
    const url = commentCard.getAttribute('data-url');

    // Populate the edit form
    document.getElementById('editMaBinhLuan').value = maBinhLuanValue;
    document.getElementById('editNoiDung').value = noiDung;
    
    // Handle file
    editOriginalFileUrl = url || '';
    editUploadedFileUrl = '';
    document.getElementById('editFileInput').value = '';
    document.getElementById('editUrlHidden').value = editOriginalFileUrl;
    document.getElementById('editKeepOldFile').value = 'true';
    
    if (editOriginalFileUrl && editOriginalFileUrl.trim() !== '') {
        const fileName = editOriginalFileUrl.split('/').pop();
        document.getElementById('editFileStatus').textContent = fileName;
        document.getElementById('editFileStatus').classList.remove('text-muted');
        document.getElementById('editFileStatus').classList.add('text-success');
        
        const preview = document.getElementById('editFilePreview');
        preview.innerHTML = '';
        preview.style.display = 'block';
        
        const fullUrl = '/' + contextPath + '/' + editOriginalFileUrl;
        
        if (editOriginalFileUrl.match(/\.(jpg|jpeg|png|gif|webp)$/i)) {
            const img = document.createElement('img');
            img.src = fullUrl;
            img.className = 'preview-image';
            img.style.maxWidth = '100%';
            img.style.maxHeight = '400px';
            img.style.objectFit = 'contain';
            img.style.borderRadius = '12px';
            preview.appendChild(img);
        } else if (editOriginalFileUrl.match(/\.(mp4|webm|ogg)$/i)) {
            const video = document.createElement('video');
            video.src = fullUrl;
            video.controls = true;
            video.className = 'preview-video';
            video.style.width = '100%';
            video.style.maxHeight = '400px';
            video.style.borderRadius = '12px';
            preview.appendChild(video);
        }
        
        document.getElementById('editRemoveFileBtn').style.display = 'inline-block';
    } else {
        document.getElementById('editFileStatus').textContent = 'Chưa có ảnh/video';
        document.getElementById('editFileStatus').classList.remove('text-success');
        document.getElementById('editFileStatus').classList.add('text-muted');
        document.getElementById('editFilePreview').style.display = 'none';
        document.getElementById('editRemoveFileBtn').style.display = 'none';
    }

    // Show the edit modal
    const modal = new bootstrap.Modal(document.getElementById('editCommentModal'));
    modal.show();
};

// Reset add modal when opened
document.getElementById('addCommentModal').addEventListener('show.bs.modal', function() {
    addUploadedFileUrl = '';
    document.getElementById('addFileInput').value = '';
    document.getElementById('addFileStatus').textContent = 'Chưa có ảnh/video';
    document.getElementById('addFileStatus').classList.remove('text-success', 'text-primary');
    document.getElementById('addFileStatus').classList.add('text-muted');
    document.getElementById('addFilePreview').style.display = 'none';
    document.getElementById('addUrlHidden').value = '';
    console.log('Add modal opened, upload state reset');
});
- style.css (Của MyCommentPage):
/* style.css (MyCommentPage) - Full Code */
@charset "UTF-8";

/* =======================
   Global Styles
======================= */
* {
	margin: 0;
	padding: 0;
	box-sizing: border-box;
	transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease;
}

body {
	font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
	background-color: #f0f2f5 !important;
	min-height: 100vh !important;
}

/* =======================
   Navbar Styles
======================= */
.bg-gradient {
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
}

.navbar {
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
}

.navbar-brand {
	font-size: 1.5rem !important;
	transition: transform 0.3s ease !important;
}

.navbar-brand:hover {
	transform: scale(1.05) !important;
}

.navbar-brand i {
	font-size: 1.8rem !important;
}

.nav-link {
	border-radius: 8px !important;
	margin: 0 4px !important;
	transition: all 0.3s ease !important;
	color: #fff !important;
}

.nav-link:hover {
	background-color: rgba(255, 255, 255, 0.1) !important;
	transform: translateY(-2px) !important;
}

.nav-link.active {
	background-color: rgba(255, 255, 255, 0.25) !important;
	font-weight: 600 !important;
}

.btn-user {
	background-color: rgba(255, 255, 255, 0.2) !important;
	border: none !important;
	color: #fff !important;
	border-radius: 25px !important;
	padding: 8px 16px !important;
	transition: all 0.3s ease !important;
}

.btn-user:hover {
	background-color: rgba(255, 255, 255, 0.35) !important;
	transform: translateY(-2px) !important;
}

.btn-user i {
	font-size: 1.5rem !important;
}

/* =======================
   Card Styles
======================= */
.card {
	border: none !important;
	border-radius: 12px !important;
	transition: transform 0.3s ease, box-shadow 0.3s ease !important;
}

.card:hover {
	transform: translateY(-2px) !important;
	box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15) !important;
}

.card-header {
	border-radius: 12px 12px 0 0 !important;
	border: none !important;
}

/* =======================
   Title Card
======================= */
.title-card {
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
	color: white !important;
}

.title-card h4 {
	color: white !important;
}

/* =======================
   Controls Card
======================= */
.controls-card {
	background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%) !important;
}

/* =======================
   Comment Card
======================= */
.comment-card {
	transition: all 0.3s ease !important;
	animation: fadeInUp 0.5s ease !important;
}

.comment-card:hover {
	transform: translateY(-4px) !important;
	box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2) !important;
}

@keyframes fadeInUp {
	from {
		opacity: 0;
		transform: translateY(20px);
	}
	to {
		opacity: 1;
		transform: translateY(0);
	}
}

.comment-avatar {
	font-size: 2.5rem !important;
	color: #764ba2 !important;
	min-width: 40px !important;
}

.comment-title {
	font-size: 1.1rem !important;
	font-weight: 600 !important;
	color: #2d3748 !important;
	margin-bottom: 0.5rem !important;
}

.comment-content {
	color: #4a5568 !important;
	line-height: 1.6 !important;
	word-wrap: break-word !important;
}

.comment-media img,
.comment-media video {
	max-height: 300px !important;
	object-fit: cover !important;
	border-radius: 8px !important;
}

.like-section {
	transition: all 0.2s ease !important;
}

.like-icon {
	transition: all 0.2s ease !important;
	font-size: 1.1rem !important;
}

.like-icon:hover {
	transform: scale(1.2) !important;
}

.like-count {
	font-weight: 600 !important;
	color: #667eea !important;
}

.like-count:hover {
	text-decoration: underline !important;
	cursor: pointer !important;
}

/* =======================
   Search Card
======================= */
.search-card {
	z-index: 1000 !important;
}

.search-card .input-group {
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
	border-radius: 8px !important;
	overflow: hidden !important;
}

.search-card .form-control {
	border: none !important;
	padding: 12px 16px !important;
}

.search-card .form-control:focus {
	box-shadow: none !important;
}

.search-card .btn-primary {
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
	border: none !important;
	padding: 12px 20px !important;
}

.search-card .btn-primary:hover {
	opacity: 0.9 !important;
}

/* =======================
   Footer
======================= */
.footer {
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
	color: white !important;
	padding: 20px 0 !important;
	margin-top: auto !important;
}

/* =======================
   Modal
======================= */
.modal-content {
	border-radius: 16px !important;
	border: none !important;
}

.modal-header {
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
	color: white !important;
	border-radius: 16px 16px 0 0 !important;
}

.modal-header .btn-close,
.modal-header .btn-close-white {
	filter: brightness(0) invert(1) !important;
}

/* =======================
   Badge
======================= */
.badge {
	padding: 6px 12px !important;
	border-radius: 20px !important;
	font-weight: 500 !important;
}

/* =======================
   Pagination Styles
======================= */
.pagination {
	margin-bottom: 0 !important;
}

.page-link {
	color: #667eea !important;
	border: 1px solid #e2e8f0 !important;
	padding: 8px 16px !important;
	margin: 0 4px !important;
	border-radius: 8px !important;
	transition: all 0.3s ease !important;
	font-weight: 500 !important;
}

.page-link:hover {
	background-color: #f8f9fa !important;
	border-color: #667eea !important;
	transform: translateY(-2px) !important;
	box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3) !important;
}

.page-item.active .page-link {
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
	border-color: #667eea !important;
	color: white !important;
	box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4) !important;
}

.page-item.disabled .page-link {
	color: #cbd5e0 !important;
	background-color: #f8f9fa !important;
	border-color: #e2e8f0 !important;
	cursor: not-allowed !important;
}

.page-item:first-child .page-link {
	border-radius: 8px !important;
}

.page-item:last-child .page-link {
	border-radius: 8px !important;
}

/* =======================
   Dropdown Menu
======================= */
.dropdown-menu {
	border: none !important;
	box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
	border-radius: 12px !important;
	margin-top: 0.5rem !important;
	z-index: 1050 !important;
}

.dropdown-item {
	padding: 10px 20px !important;
	transition: all 0.3s ease !important;
}

.dropdown-item:hover {
	background-color: #f8f9fa !important;
	padding-left: 25px !important;
}

.dropdown-item i {
	width: 20px !important;
}

/* =======================
   Alert Container
======================= */
.alert-container {
	position: fixed !important;
	top: 80px !important;
	left: 50% !important;
	transform: translateX(-50%) !important;
	z-index: 9999 !important;
	width: 90% !important;
	max-width: 600px !important;
}

.alert-container .alert {
	border: none !important;
	border-radius: 12px !important;
	box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
	padding: 1rem 1.5rem !important;
	font-weight: 500 !important;
	opacity: 0 !important;
	transform: translateY(-20px) !important;
	transition: all 0.3s ease !important;
}

.alert-container .alert.show {
	opacity: 1 !important;
	transform: translateY(0) !important;
}

.alert-container .alert-success {
	background-color: #d4edda !important;
	color: #155724 !important;
	border-left: 4px solid #28a745 !important;
}

.alert-container .alert-success i {
	color: #28a745 !important;
}

.alert-container .alert-danger {
	background-color: #f8d7da !important;
	color: #721c24 !important;
	border-left: 4px solid #dc3545 !important;
}

.alert-container .alert-danger i {
	color: #dc3545 !important;
}

/* =======================
   Buttons
======================= */
.btn-primary {
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
	border: none !important;
	border-radius: 8px !important;
	padding: 10px 20px !important;
	font-weight: 500 !important;
	transition: all 0.3s ease !important;
}

.btn-primary:hover {
	opacity: 0.9 !important;
	transform: translateY(-2px) !important;
	box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4) !important;
}

.btn-outline-secondary {
	border-radius: 8px !important;
	transition: all 0.3s ease !important;
}

.btn-outline-secondary:hover {
	transform: translateY(-2px) !important;
}

/* =======================
   Form Controls
======================= */
.form-select:focus,
.form-control:focus {
	border-color: #667eea !important;
	box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25) !important;
}

.form-label {
	font-weight: 500 !important;
	color: #2d3748 !important;
}

/* =======================
   Scrollbar
======================= */
::-webkit-scrollbar {
	width: 8px !important;
	height: 8px !important;
}

::-webkit-scrollbar-track {
	background: #f1f1f1 !important;
}

::-webkit-scrollbar-thumb {
	background: #888 !important;
	border-radius: 4px !important;
}

::-webkit-scrollbar-thumb:hover {
	background: #555 !important;
}

/* =======================
   Spinner
======================= */
.spinner-border {
	width: 3rem !important;
	height: 3rem !important;
}

/* =======================
   Empty State
======================= */
.bi-inbox {
	opacity: 0.3 !important;
}

/* =======================
   Link Styles
======================= */
a {
	transition: all 0.2s ease !important;
}

a:hover {
	opacity: 0.8 !important;
}

/* =======================
   Responsive
======================= */
@media (max-width: 991px) {
	.search-card {
		position: static !important;
	}
}

@media (max-width: 767px) {
	.navbar-brand {
		font-size: 1.2rem !important;
	}
	.comment-card {
		margin-bottom: 1rem !important;
	}
	.comment-title {
		font-size: 1rem !important;
	}
	.comment-content {
		font-size: 0.9rem !important;
	}
}

@media (max-width: 576px) {
	.card-body {
		padding: 1rem !important;
	}
	.navbar-brand i {
		font-size: 1.5rem !important;
	}
	.btn-user i {
		font-size: 1.3rem !important;
	}
	.comment-avatar {
		font-size: 2rem !important;
	}
	.modal-dialog {
		margin: 0.5rem !important;
	}
}

/* =======================
   Upload File Styles
======================= */
.upload-container {
	border: 2px dashed #e2e8f0 !important;
	border-radius: 12px !important;
	padding: 1.5rem !important;
	text-align: center !important;
	background-color: #f8f9fa !important;
	transition: all 0.3s ease !important;
}

.upload-container:hover {
	border-color: #667eea !important;
	background-color: #f0f2ff !important;
}

.btn-upload {
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
	color: white !important;
	border: none !important;
	padding: 10px 24px !important;
	border-radius: 8px !important;
	font-weight: 600 !important;
	transition: all 0.3s ease !important;
	box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3) !important;
}

.btn-upload:hover {
	transform: translateY(-2px) !important;
	box-shadow: 0 4px 12px rgba(102, 126, 234, 0.5) !important;
}

.file-status {
	display: flex !important;
	align-items: center !important;
	justify-content: center !important;
	gap: 8px !important;
	font-size: 0.95rem !important;
	font-weight: 500 !important;
	padding: 8px !important;
}

.file-status i {
	font-size: 1.2rem !important;
}

.file-preview {
	max-width: 100% !important;
	border-radius: 12px !important;
	overflow: hidden !important;
	box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;
}

.preview-image,
.preview-video {
	width: 100% !important;
	max-height: 400px !important;
	object-fit: contain !important;
	border-radius: 12px !important;
}

/* Spinner for loading */
.spinner-border-sm {
	width: 1rem !important;
	height: 1rem !important;
	border-width: 0.15em !important;
}

/* Remove file button */
.btn-sm.btn-danger {
	padding: 6px 12px !important;
	font-size: 0.875rem !important;
	border-radius: 6px !important;
}

/* =======================
   Sticky Footer for Modals
======================= */
.sticky-footer {
	position: sticky !important;
	bottom: 0 !important;
	background: white !important;
	z-index: 10 !important;
	box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05) !important;
	margin: 0 !important;
	padding: 1rem 1.5rem !important;
}

.modal-body {
	padding-bottom: 1rem !important;
	max-height: calc(70vh - 120px) !important;
	overflow-y: auto !important;
}

/* Responsive cho mobile */
@media (max-width: 767px) {
	.upload-container {
		padding: 1rem !important;
	}
	
	.btn-upload {
		padding: 8px 20px !important;
		font-size: 0.9rem !important;
	}
	
	.preview-image,
	.preview-video {
		max-height: 300px !important;
	}
	
	.sticky-footer {
		padding: 0.75rem 1rem !important;
	}
	
	.sticky-footer .btn {
		padding: 8px 16px !important;
		font-size: 0.9rem !important;
	}
}
-------------
-> Yêu cầu: Làm tương tự với bài viết như trên - ở phần sửa của bài viết của tôi, bình luận, bình luận của tôi, nếu có đổi file mới thay cho file cũ thì khi nhấn cập nhật (xác nhận sửa) thì hãy xóa file cũ và lưu file mới ở cả 2 đường link. Tham khảo cách làm từ các file mẫu ở đầu. Không cần giải thích nữa, và ở phần thêm và xóa thì không cần chỉnh gì.